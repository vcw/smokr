/*! For license information please see LICENSES */
(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{254:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var r=n(85),o=n(171),c=n(173),h=n(118),i=n(255),f=n(172);var u=function(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}(o),a={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},l=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return r.__extends(e,t),e}(Error),d=new c.Logger("@firebase/firestore");function v(){return d.logLevel}function y(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(d.logLevel<=c.LogLevel.DEBUG){var n=e.map(w);d.debug.apply(d,r.__spreadArrays(["Firestore (7.23.0): "+t],n))}}function p(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(d.logLevel<=c.LogLevel.ERROR){var n=e.map(w);d.error.apply(d,r.__spreadArrays(["Firestore (7.23.0): "+t],n))}}function m(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(d.logLevel<=c.LogLevel.WARN){var n=e.map(w);d.warn.apply(d,r.__spreadArrays(["Firestore (7.23.0): "+t],n))}}function w(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function _(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (7.23.0) INTERNAL ASSERTION FAILED: "+t;throw p(e),new Error(e)}function g(t,e){t||_()}function I(t,e){return t}function E(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function T(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function b(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var N=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&_(),void 0===n?n=t.length-e:n>t.length-e&&_(),this.segments=t,this.offset=e,this.t=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.t},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.i(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach((function(t){n.push(t)})):n.push(e),this.o(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.u=function(t){return t=void 0===t?1:t,this.o(this.segments,this.offset+t,this.length-t)},t.prototype.h=function(){return this.o(this.segments,this.offset,this.length-1)},t.prototype.l=function(){return this.segments[this.offset]},t.prototype._=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.m=function(){return 0===this.length},t.prototype.T=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.I=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.A=function(){return this.segments.slice(this.offset,this.limit())},t.i=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),A=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r.__extends(e,t),e.prototype.o=function(t,n,r){return new e(t,n,r)},e.prototype.R=function(){return this.A().join("/")},e.prototype.toString=function(){return this.R()},e.P=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new l(a.INVALID_ARGUMENT,"Invalid segment ("+s+"). Paths must not contain // in them.");r.push.apply(r,s.split("/").filter((function(t){return t.length>0})))}return new e(r)},e.g=function(){return new e([])},e}(N),S=/^[_a-zA-Z][_a-zA-Z0-9]*$/,x=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r.__extends(e,t),e.prototype.o=function(t,n,r){return new e(t,n,r)},e.V=function(t){return S.test(t)},e.prototype.R=function(){return this.A().map((function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),e.V(t)||(t="`"+t+"`"),t})).join(".")},e.prototype.toString=function(){return this.R()},e.prototype.p=function(){return 1===this.length&&"__name__"===this.get(0)},e.v=function(){return new e(["__name__"])},e.S=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new l(a.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var u=t[i];if("\\"===u){if(i+1===t.length)throw new l(a.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var c=t[i+1];if("\\"!==c&&"."!==c&&"`"!==c)throw new l(a.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=c,i+=2}else"`"===u?(s=!s,i++):"."!==u||s?(r+=u,i++):(o(),i++)}if(o(),s)throw new l(a.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.g=function(){return new e([])},e}(N),D=function(){function t(t){this.path=t}return t.D=function(e){return new t(A.P(e))},t.C=function(e){return new t(A.P(e).u(5))},t.prototype.N=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===A.i(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.i=function(t,e){return A.i(t.path,e.path)},t.F=function(t){return t.length%2==0},t.$=function(e){return new t(new A(e.slice()))},t}();function k(t,e){if(0!==e.length)throw new l(a.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+H(e.length,"argument")+".")}function O(t,e,n){if(e.length!==n)throw new l(a.INVALID_ARGUMENT,"Function "+t+"() requires "+H(n,"argument")+", but was called with "+H(e.length,"argument")+".")}function R(t,e,n){if(e.length<n)throw new l(a.INVALID_ARGUMENT,"Function "+t+"() requires at least "+H(n,"argument")+", but was called with "+H(e.length,"argument")+".")}function L(t,e,n,r){if(e.length<n||e.length>r)throw new l(a.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+H(e.length,"argument")+".")}function C(t,e,n,r){F(t,e,Q(n)+" argument",r)}function P(t,e,n,r){void 0!==r&&C(t,e,n,r)}function V(t,e,n,r){F(t,e,n+" option",r)}function U(t,e,n,r){void 0!==r&&V(t,e,n,r)}function M(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){for(var o=[],s=0,u=i;s<u.length;s++){var c=u[s];if(c===r)return;o.push(G(c))}var h=G(r);throw new l(a.INVALID_ARGUMENT,"Invalid value "+h+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+o.join(", "))}(t,0,n,r,i)}function j(t,e,n,r){if(!e.some((function(t){return t===r})))throw new l(a.INVALID_ARGUMENT,"Invalid value "+G(r)+" provided to function "+t+"() for its "+Q(n)+" argument. Acceptable values: "+e.join(", "));return r}function F(t,e,n,r){if(!("object"===e?B(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=G(r);throw new l(a.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function B(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function G(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":_()}function q(t,e,n){if(void 0===n)throw new l(a.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+Q(e)+" argument, but it was undefined.")}function z(t,e,n){T(e,(function(e,r){if(n.indexOf(e)<0)throw new l(a.INVALID_ARGUMENT,"Unknown option '"+e+"' passed to function "+t+"(). Available options: "+n.join(", "))}))}function W(t,e,n,r){var i=G(r);return new l(a.INVALID_ARGUMENT,"Function "+t+"() requires its "+Q(n)+" argument to be a "+e+", but it was: "+i)}function K(t,e,n){if(n<=0)throw new l(a.INVALID_ARGUMENT,"Function "+t+"() requires its "+Q(e)+" argument to be a positive number, but it was: "+n+".")}function Q(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function H(t,e){return t+" "+e+(1===t?"":"s")}function X(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var Y=function(){function t(){}return t.k=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=X(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function $(t,e){return t<e?-1:t>e?1:0}function J(t,e,n){return t.length===e.length&&t.every((function(t,r){return n(t,e[r])}))}function Z(t){return t+"\0"}var tt=function(){function t(t){this.M=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return t=this.M,btoa(t);var t},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.M)},t.prototype.O=function(){return 2*this.M.length},t.prototype.L=function(t){return $(this.M,t.M)},t.prototype.isEqual=function(t){return this.M===t.M},t}();tt.B=new tt("");var et=function(){function t(t){this.q=t}return t.fromBase64String=function(e){try{return new t(tt.fromBase64String(e))}catch(e){throw new l(a.INVALID_ARGUMENT,"Failed to construct Bytes from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(tt.fromUint8Array(e))},t.prototype.toBase64=function(){return this.q.toBase64()},t.prototype.toUint8Array=function(){return this.q.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this.q.isEqual(t.q)},t}();function nt(){if("undefined"==typeof Uint8Array)throw new l(a.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function it(){if("undefined"==typeof atob)throw new l(a.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var ot=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r.__extends(e,t),e.fromBase64String=function(t){O("Blob.fromBase64String",arguments,1),C("Blob.fromBase64String","string",1,t),it();try{return new e(tt.fromBase64String(t))}catch(t){throw new l(a.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},e.fromUint8Array=function(t){if(O("Blob.fromUint8Array",arguments,1),nt(),!(t instanceof Uint8Array))throw W("Blob.fromUint8Array","Uint8Array",1,t);return new e(tt.fromUint8Array(t))},e.prototype.toBase64=function(){return O("Blob.toBase64",arguments,0),it(),t.prototype.toBase64.call(this)},e.prototype.toUint8Array=function(){return O("Blob.toUint8Array",arguments,0),nt(),t.prototype.toUint8Array.call(this)},e.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},e}(et),st=function(t,e,n,r,i){this.U=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i},rt=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"W",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t.prototype.L=function(t){return $(this.projectId,t.projectId)||$(this.database,t.database)},t}(),ut=function(){function t(t,e){this.j=t,this.K=e,this.G={}}return t.prototype.get=function(t){var e=this.j(t),n=this.G[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];if(this.K(s,t))return u}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.j(t),r=this.G[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.K(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.G[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.j(t),n=this.G[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.K(n[r][0],t))return 1===n.length?delete this.G[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){T(this.G,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];t(s,u)}}))},t.prototype.m=function(){return b(this.G)},t}(),at=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new l(a.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new l(a.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new l(a.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new l(a.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,1e6*(e-1e3*n))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype.H=function(t){return this.seconds===t.seconds?$(this.nanoseconds,t.nanoseconds):$(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),ct=function(){function t(t){this.timestamp=t}return t.Y=function(e){return new t(e)},t.min=function(){return new t(new at(0,0))},t.prototype.L=function(t){return this.timestamp.H(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.J=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.X=function(){return this.timestamp},t}();function ht(t){return null==t}function ft(t){return 0===t&&1/t==-1/0}function lt(t){return"number"==typeof t&&Number.isInteger(t)&&!ft(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var pt=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.Z=null};function vt(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new pt(t,e,n,r,i,o,s)}function yt(t){var e=I(t);if(null===e.Z){var n=e.path.R();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((function(t){return function(t){return t.field.R()+t.op.toString()+oe(t.value)}(t)})).join(","),n+="|ob:",n+=e.orderBy.map((function(t){return(e=t).field.R()+e.dir;var e})).join(","),ht(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=ar(e.startAt)),e.endAt&&(n+="|ub:",n+=ar(e.endAt)),e.Z=n}return e.Z}function gt(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!pr(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if(i=t.filters[r],o=e.filters[r],i.op!==o.op||!i.field.isEqual(o.field)||!ee(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!hr(t.startAt,e.startAt)&&hr(t.endAt,e.endAt)}function dt(t){return D.F(t.path)&&null===t.collectionGroup&&0===t.filters.length}var mt,wt,bt=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=ct.min()),void 0===o&&(o=ct.min()),void 0===s&&(s=tt.B),this.target=t,this.targetId=e,this.tt=n,this.sequenceNumber=r,this.et=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.nt=function(e){return new t(this.target,this.targetId,this.tt,e,this.et,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.st=function(e,n){return new t(this.target,this.targetId,this.tt,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.it=function(e){return new t(this.target,this.targetId,this.tt,this.sequenceNumber,this.et,e,this.resumeToken)},t}(),_t=function(t){this.count=t};function It(t){switch(t){case a.OK:return _();case a.CANCELLED:case a.UNKNOWN:case a.DEADLINE_EXCEEDED:case a.RESOURCE_EXHAUSTED:case a.INTERNAL:case a.UNAVAILABLE:case a.UNAUTHENTICATED:return!1;case a.INVALID_ARGUMENT:case a.NOT_FOUND:case a.ALREADY_EXISTS:case a.PERMISSION_DENIED:case a.FAILED_PRECONDITION:case a.ABORTED:case a.OUT_OF_RANGE:case a.UNIMPLEMENTED:case a.DATA_LOSS:return!0;default:return _()}}function Et(t){if(void 0===t)return p("GRPC error has no .code"),a.UNKNOWN;switch(t){case mt.OK:return a.OK;case mt.CANCELLED:return a.CANCELLED;case mt.UNKNOWN:return a.UNKNOWN;case mt.DEADLINE_EXCEEDED:return a.DEADLINE_EXCEEDED;case mt.RESOURCE_EXHAUSTED:return a.RESOURCE_EXHAUSTED;case mt.INTERNAL:return a.INTERNAL;case mt.UNAVAILABLE:return a.UNAVAILABLE;case mt.UNAUTHENTICATED:return a.UNAUTHENTICATED;case mt.INVALID_ARGUMENT:return a.INVALID_ARGUMENT;case mt.NOT_FOUND:return a.NOT_FOUND;case mt.ALREADY_EXISTS:return a.ALREADY_EXISTS;case mt.PERMISSION_DENIED:return a.PERMISSION_DENIED;case mt.FAILED_PRECONDITION:return a.FAILED_PRECONDITION;case mt.ABORTED:return a.ABORTED;case mt.OUT_OF_RANGE:return a.OUT_OF_RANGE;case mt.UNIMPLEMENTED:return a.UNIMPLEMENTED;case mt.DATA_LOSS:return a.DATA_LOSS;default:return _()}}(wt=mt||(mt={}))[wt.OK=0]="OK",wt[wt.CANCELLED=1]="CANCELLED",wt[wt.UNKNOWN=2]="UNKNOWN",wt[wt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",wt[wt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",wt[wt.NOT_FOUND=5]="NOT_FOUND",wt[wt.ALREADY_EXISTS=6]="ALREADY_EXISTS",wt[wt.PERMISSION_DENIED=7]="PERMISSION_DENIED",wt[wt.UNAUTHENTICATED=16]="UNAUTHENTICATED",wt[wt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",wt[wt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",wt[wt.ABORTED=10]="ABORTED",wt[wt.OUT_OF_RANGE=11]="OUT_OF_RANGE",wt[wt.UNIMPLEMENTED=12]="UNIMPLEMENTED",wt[wt.INTERNAL=13]="INTERNAL",wt[wt.UNAVAILABLE=14]="UNAVAILABLE",wt[wt.DATA_LOSS=15]="DATA_LOSS";var Tt=function(){function t(t,e){this.i=t,this.root=e||At.EMPTY}return t.prototype.rt=function(e,n){return new t(this.i,this.root.rt(e,n,this.i).copy(null,null,At.ot,null,null))},t.prototype.remove=function(e){return new t(this.i,this.root.remove(e,this.i).copy(null,null,At.ot,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.m();){var n=this.i(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.m();){var r=this.i(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.m=function(){return this.root.m()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.at=function(){return this.root.at()},t.prototype.ct=function(){return this.root.ct()},t.prototype.ut=function(t){return this.root.ut(t)},t.prototype.forEach=function(t){this.ut((function(e,n){return t(e,n),!1}))},t.prototype.toString=function(){var t=[];return this.ut((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},t.prototype.ht=function(t){return this.root.ht(t)},t.prototype.lt=function(){return new Nt(this.root,null,this.i,!1)},t.prototype._t=function(t){return new Nt(this.root,t,this.i,!1)},t.prototype.ft=function(){return new Nt(this.root,null,this.i,!0)},t.prototype.dt=function(t){return new Nt(this.root,t,this.i,!0)},t}(),Nt=function(){function t(t,e,n,r){this.wt=r,this.Tt=[];for(var i=1;!t.m();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.wt?t.left:t.right;else{if(0===i){this.Tt.push(t);break}this.Tt.push(t),t=this.wt?t.right:t.left}}return t.prototype.Et=function(){var t=this.Tt.pop(),e={key:t.key,value:t.value};if(this.wt)for(t=t.left;!t.m();)this.Tt.push(t),t=t.right;else for(t=t.right;!t.m();)this.Tt.push(t),t=t.left;return e},t.prototype.It=function(){return this.Tt.length>0},t.prototype.At=function(){if(0===this.Tt.length)return null;var t=this.Tt[this.Tt.length-1];return{key:t.key,value:t.value}},t}(),At=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.m=function(){return!1},t.prototype.ut=function(t){return this.left.ut(t)||t(this.key,this.value)||this.right.ut(t)},t.prototype.ht=function(t){return this.right.ht(t)||t(this.key,this.value)||this.left.ht(t)},t.prototype.min=function(){return this.left.m()?this:this.left.min()},t.prototype.at=function(){return this.min().key},t.prototype.ct=function(){return this.right.m()?this.key:this.right.ct()},t.prototype.rt=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.rt(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.rt(t,e,n))).Rt()},t.prototype.Pt=function(){if(this.left.m())return t.EMPTY;var e=this;return e.left.gt()||e.left.left.gt()||(e=e.yt()),(e=e.copy(null,null,null,e.left.Pt(),null)).Rt()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.m()||i.left.gt()||i.left.left.gt()||(i=i.yt()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.gt()&&(i=i.Vt()),i.right.m()||i.right.gt()||i.right.left.gt()||(i=i.bt()),0===n(e,i.key)){if(i.right.m())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.Pt())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.Rt()},t.prototype.gt=function(){return this.color},t.prototype.Rt=function(){var t=this;return t.right.gt()&&!t.left.gt()&&(t=t.vt()),t.left.gt()&&t.left.left.gt()&&(t=t.Vt()),t.left.gt()&&t.right.gt()&&(t=t.St()),t},t.prototype.yt=function(){var t=this.St();return t.right.left.gt()&&(t=(t=(t=t.copy(null,null,null,null,t.right.Vt())).vt()).St()),t},t.prototype.bt=function(){var t=this.St();return t.left.left.gt()&&(t=(t=t.Vt()).St()),t},t.prototype.vt=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.Vt=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.St=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.Dt=function(){var t=this.Ct();return Math.pow(2,t)<=this.size+1},t.prototype.Ct=function(){if(this.gt()&&this.left.gt())throw _();if(this.right.gt())throw _();var t=this.left.Ct();if(t!==this.right.Ct())throw _();return t+(this.gt()?0:1)},t}();At.EMPTY=null,At.RED=!0,At.ot=!1,At.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw _()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw _()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw _()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw _()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw _()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.rt=function(t,e,n){return new At(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.m=function(){return!0},t.prototype.ut=function(t){return!1},t.prototype.ht=function(t){return!1},t.prototype.at=function(){return null},t.prototype.ct=function(){return null},t.prototype.gt=function(){return!1},t.prototype.Dt=function(){return!0},t.prototype.Ct=function(){return 0},t}());var St=function(){function t(t){this.i=t,this.data=new Tt(this.i)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.at()},t.prototype.last=function(){return this.data.ct()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.ut((function(e,n){return t(e),!1}))},t.prototype.Nt=function(t,e){for(var n=this.data._t(t[0]);n.It();){var r=n.Et();if(this.i(r.key,t[1])>=0)return;e(r.key)}},t.prototype.Ft=function(t,e){var n;for(n=void 0!==e?this.data._t(e):this.data.lt();n.It();)if(!t(n.Et().key))return},t.prototype.$t=function(t){var e=this.data._t(t);return e.It()?e.Et().key:null},t.prototype.lt=function(){return new xt(this.data.lt())},t.prototype._t=function(t){return new xt(this.data._t(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).rt(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.m=function(){return this.data.m()},t.prototype.xt=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach((function(t){e=e.add(t)})),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.lt(),r=e.data.lt();n.It();){var i=n.Et().key,o=r.Et().key;if(0!==this.i(i,o))return!1}return!0},t.prototype.A=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},t.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.i);return n.data=e,n},t}(),xt=function(){function t(t){this.kt=t}return t.prototype.Et=function(){return this.kt.Et().key},t.prototype.It=function(){return this.kt.It()},t}(),Dt=new Tt(D.i);function kt(){return Dt}function Ot(){return kt()}var Rt=new Tt(D.i);function Lt(){return Rt}var Ct=new Tt(D.i),Pt=new St(D.i);function Vt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Pt,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Ut=new St($);function Mt(){return Ut}var jt=function(){function t(t){this.i=t?function(e,n){return t(e,n)||D.i(e.key,n.key)}:function(t,e){return D.i(t.key,e.key)},this.Mt=Lt(),this.Ot=new Tt(this.i)}return t.Lt=function(e){return new t(e.i)},t.prototype.has=function(t){return null!=this.Mt.get(t)},t.prototype.get=function(t){return this.Mt.get(t)},t.prototype.first=function(){return this.Ot.at()},t.prototype.last=function(){return this.Ot.ct()},t.prototype.m=function(){return this.Ot.m()},t.prototype.indexOf=function(t){var e=this.Mt.get(t);return e?this.Ot.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.Ot.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.Ot.ut((function(e,n){return t(e),!1}))},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.Mt.rt(t.key,t),e.Ot.rt(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.Mt.remove(t),this.Ot.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.Ot.lt(),r=e.Ot.lt();n.It();){var i=n.Et().key,o=r.Et().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.i=this.i,r.Mt=e,r.Ot=n,r},t}(),Ft=function(){function t(){this.Bt=new Tt(D.i)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Bt.get(e);n?0!==t.type&&3===n.type?this.Bt=this.Bt.rt(e,t):3===t.type&&1!==n.type?this.Bt=this.Bt.rt(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Bt=this.Bt.rt(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Bt=this.Bt.rt(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Bt=this.Bt.remove(e):1===t.type&&2===n.type?this.Bt=this.Bt.rt(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Bt=this.Bt.rt(e,{type:2,doc:t.doc}):_():this.Bt=this.Bt.rt(e,t)},t.prototype.qt=function(){var t=[];return this.Bt.ut((function(e,n){t.push(n)})),t},t}(),qt=function(){function t(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this.Ut=n,this.docChanges=r,this.Qt=i,this.fromCache=o,this.Wt=s,this.jt=u}return t.Kt=function(e,n,r,i){var o=[];return n.forEach((function(t){o.push({type:0,doc:t})})),new t(e,n,jt.Lt(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.Qt.m()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.Wt===t.Wt&&this.Qt.isEqual(t.Qt)&&Qn(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.Ut.isEqual(t.Ut)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),Bt=function(){function t(t,e,n,r,i){this.et=t,this.Gt=e,this.zt=n,this.Ht=r,this.Yt=i}return t.Jt=function(e,n){var r=new Map;return r.set(e,Gt.Xt(e,n)),new t(ct.min(),r,Mt(),kt(),Vt())},t}(),Gt=function(){function t(t,e,n,r,i){this.resumeToken=t,this.Zt=e,this.te=n,this.ee=r,this.ne=i}return t.Xt=function(e,n){return new t(tt.B,n,Vt(),Vt(),Vt())},t}(),zt=function(t,e,n,r){this.se=t,this.removedTargetIds=e,this.key=n,this.ie=r},Wt=function(t,e){this.targetId=t,this.re=e},Kt=function(t,e,n,r){void 0===n&&(n=tt.B),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},Qt=function(){function t(){this.oe=0,this.ae=Yt(),this.ce=tt.B,this.ue=!1,this.he=!0}return Object.defineProperty(t.prototype,"Zt",{get:function(){return this.ue},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.ce},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"le",{get:function(){return 0!==this.oe},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_e",{get:function(){return this.he},enumerable:!1,configurable:!0}),t.prototype.fe=function(t){t.O()>0&&(this.he=!0,this.ce=t)},t.prototype.de=function(){var t=Vt(),e=Vt(),n=Vt();return this.ae.forEach((function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:_()}})),new Gt(this.ce,this.ue,t,e,n)},t.prototype.we=function(){this.he=!1,this.ae=Yt()},t.prototype.me=function(t,e){this.he=!0,this.ae=this.ae.rt(t,e)},t.prototype.Te=function(t){this.he=!0,this.ae=this.ae.remove(t)},t.prototype.Ee=function(){this.oe+=1},t.prototype.Ie=function(){this.oe-=1},t.prototype.Ae=function(){this.he=!0,this.ue=!0},t}(),Ht=function(){function t(t){this.Re=t,this.Pe=new Map,this.ge=kt(),this.ye=Xt(),this.Ve=new St($)}return t.prototype.pe=function(t){for(var e=0,n=t.se;e<n.length;e++){var r=n[e];t.ie instanceof On?this.be(r,t.ie):t.ie instanceof Rn&&this.ve(r,t.key,t.ie)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){var s=o[i];this.ve(s,t.key,t.ie)}},t.prototype.Se=function(t){var e=this;this.De(t,(function(n){var r=e.Ce(n);switch(t.state){case 0:e.Ne(n)&&r.fe(t.resumeToken);break;case 1:r.Ie(),r.le||r.we(),r.fe(t.resumeToken);break;case 2:r.Ie(),r.le||e.removeTarget(n);break;case 3:e.Ne(n)&&(r.Ae(),r.fe(t.resumeToken));break;case 4:e.Ne(n)&&(e.Fe(n),r.fe(t.resumeToken));break;default:_()}}))},t.prototype.De=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.Pe.forEach((function(t,r){n.Ne(r)&&e(r)}))},t.prototype.$e=function(t){var e=t.targetId,n=t.re.count,r=this.xe(e);if(r){var i=r.target;if(dt(i))if(0===n){var o=new D(i.path);this.ve(e,o,new Rn(o,ct.min()))}else g(1===n);else this.ke(e)!==n&&(this.Fe(e),this.Ve=this.Ve.add(e))}},t.prototype.Me=function(t){var e=this,n=new Map;this.Pe.forEach((function(r,i){var o=e.xe(i);if(o){if(r.Zt&&dt(o.target)){var s=new D(o.target.path);null!==e.ge.get(s)||e.Oe(i,s)||e.ve(i,s,new Rn(s,t))}r._e&&(n.set(i,r.de()),r.we())}}));var r=Vt();this.ye.forEach((function(t,n){var i=!0;n.Ft((function(t){var n=e.xe(t);return!n||2===n.tt||(i=!1,!1)})),i&&(r=r.add(t))}));var i=new Bt(t,n,this.Ve,this.ge,r);return this.ge=kt(),this.ye=Xt(),this.Ve=new St($),i},t.prototype.be=function(t,e){if(this.Ne(t)){var n=this.Oe(t,e.key)?2:0;this.Ce(t).me(e.key,n),this.ge=this.ge.rt(e.key,e),this.ye=this.ye.rt(e.key,this.Le(e.key).add(t))}},t.prototype.ve=function(t,e,n){if(this.Ne(t)){var r=this.Ce(t);this.Oe(t,e)?r.me(e,1):r.Te(e),this.ye=this.ye.rt(e,this.Le(e).delete(t)),n&&(this.ge=this.ge.rt(e,n))}},t.prototype.removeTarget=function(t){this.Pe.delete(t)},t.prototype.ke=function(t){var e=this.Ce(t).de();return this.Re.Be(t).size+e.te.size-e.ne.size},t.prototype.Ee=function(t){this.Ce(t).Ee()},t.prototype.Ce=function(t){var e=this.Pe.get(t);return e||(e=new Qt,this.Pe.set(t,e)),e},t.prototype.Le=function(t){var e=this.ye.get(t);return e||(e=new St($),this.ye=this.ye.rt(t,e)),e},t.prototype.Ne=function(t){var e=null!==this.xe(t);return e||y("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.xe=function(t){var e=this.Pe.get(t);return e&&e.le?null:this.Re.qe(t)},t.prototype.Fe=function(t){var e=this;this.Pe.set(t,new Qt),this.Re.Be(t).forEach((function(n){e.ve(t,n,null)}))},t.prototype.Oe=function(t,e){return this.Re.Be(t).has(e)},t}();function Xt(){return new Tt(D.i)}function Yt(){return new Tt(D.i)}function $t(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Jt(t){var e=se(t.mapValue.fields.__local_write_time__.timestampValue);return new at(e.seconds,e.nanos)}var Zt=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function te(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?$t(t)?4:10:_()}function ee(t,e){var n=te(t);if(n!==te(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Jt(t).isEqual(Jt(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=se(t.timestampValue),r=se(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return ae(t.bytesValue).isEqual(ae(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return ue(t.geoPointValue.latitude)===ue(e.geoPointValue.latitude)&&ue(t.geoPointValue.longitude)===ue(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return ue(t.integerValue)===ue(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=ue(t.doubleValue),r=ue(e.doubleValue);return n===r?ft(n)===ft(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return J(t.arrayValue.values||[],e.arrayValue.values||[],ee);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(E(n)!==E(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!ee(n[i],r[i])))return!1;return!0}(t,e);default:return _()}}function ne(t,e){return void 0!==(t.values||[]).find((function(t){return ee(t,e)}))}function re(t,e){var n=te(t),r=te(e);if(n!==r)return $(n,r);switch(n){case 0:return 0;case 1:return $(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=ue(t.integerValue||t.doubleValue),r=ue(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return ie(t.timestampValue,e.timestampValue);case 4:return ie(Jt(t),Jt(e));case 5:return $(t.stringValue,e.stringValue);case 6:return function(t,e){var n=ae(t),r=ae(e);return n.L(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=$(n[i],r[i]);if(0!==o)return o}return $(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=$(ue(t.latitude),ue(e.latitude));return 0!==n?n:$(ue(t.longitude),ue(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=re(n[i],r[i]);if(o)return o}return $(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var u=$(r[s],o[s]);if(0!==u)return u;var a=re(n[r[s]],i[o[s]]);if(0!==a)return a}return $(r.length,o.length)}(t.mapValue,e.mapValue);default:throw _()}}function ie(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return $(t,e);var n=se(t),r=se(e),i=$(n.seconds,r.seconds);return 0!==i?i:$(n.nanos,r.nanos)}function oe(t){return function t(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(t){var e=se(t);return"time("+e.seconds+","+e.nanos+")"}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?ae(e.bytesValue).toBase64():"referenceValue"in e?(r=e.referenceValue,D.C(r).toString()):"geoPointValue"in e?"geo("+(n=e.geoPointValue).latitude+","+n.longitude+")":"arrayValue"in e?function(e){for(var n="[",r=!0,o=0,i=e.values||[];o<i.length;o++)r?r=!1:n+=",",n+=t(i[o]);return n+"]"}(e.arrayValue):"mapValue"in e?function(e){for(var n="{",r=!0,o=0,i=Object.keys(e.fields||{}).sort();o<i.length;o++){var c=i[o];r?r=!1:n+=",",n+=c+":"+t(e.fields[c])}return n+"}"}(e.mapValue):_();var n,r}(t)}function se(t){if(g(!!t),"string"==typeof t){var e=0,n=Zt.exec(t);if(g(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:ue(t.seconds),nanos:ue(t.nanos)}}function ue(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function ae(t){return"string"==typeof t?tt.fromBase64String(t):tt.fromUint8Array(t)}function ce(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.R()}}function he(t){return!!t&&"integerValue"in t}function fe(t){return!!t&&"arrayValue"in t}function le(t){return!!t&&"nullValue"in t}function pe(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function de(t){return!!t&&"mapValue"in t}var ve={asc:"ASCENDING",desc:"DESCENDING"},ye={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ge=function(t,e){this.U=t,this.Ue=e};function me(t){return{integerValue:""+t}}function we(t,e){if(t.Ue){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ft(e)?"-0":e}}function be(t,e){return lt(e)?me(e):we(t,e)}function _e(t,e){return t.Ue?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function Ie(t,e){return t.Ue?e.toBase64():e.toUint8Array()}function Ee(t,e){return _e(t,e.X())}function Te(t){return g(!!t),ct.Y(function(t){var e=se(t);return new at(e.seconds,e.nanos)}(t))}function Ne(t,e){return function(t){return new A(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).R()}function Ae(t){var e=A.P(t);return g(He(e)),e}function Se(t,e){return Ne(t.U,e.path)}function xe(t,e){var n=Ae(e);return g(n.get(1)===t.U.projectId),g(!n.get(3)&&!t.U.database||n.get(3)===t.U.database),new D(Re(n))}function De(t,e){return Ne(t.U,e)}function ke(t){var e=Ae(t);return 4===e.length?A.g():Re(e)}function Oe(t){return new A(["projects",t.U.projectId,"databases",t.U.database]).R()}function Re(t){return g(t.length>4&&"documents"===t.get(4)),t.u(5)}function Le(t,e,n){return{name:Se(t,e),fields:n.proto.mapValue.fields}}function Ce(t,e){var n;if(e instanceof wn)n={update:Le(t,e.key,e.value)};else if(e instanceof Nn)n={delete:Se(t,e.key)};else if(e instanceof bn)n={update:Le(t,e.key,e.data),updateMask:Qe(e.Qe)};else if(e instanceof In)n={transform:{document:Se(t,e.key),fieldTransforms:e.fieldTransforms.map((function(t){return function(t,e){var n=e.transform;if(n instanceof Ze)return{fieldPath:e.field.R(),setToServerValue:"REQUEST_TIME"};if(n instanceof tn)return{fieldPath:e.field.R(),appendMissingElements:{values:n.elements}};if(n instanceof nn)return{fieldPath:e.field.R(),removeAllFromArray:{values:n.elements}};if(n instanceof on)return{fieldPath:e.field.R(),increment:n.We};throw _()}(0,t)}))}};else{if(!(e instanceof An))return _();n={verify:Se(t,e.key)}}return e.Ke.je||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Ee(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:_()}(t,e.Ke)),n}function Pe(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?fn.updateTime(Te(t.updateTime)):void 0!==t.exists?fn.exists(t.exists):fn.Ge()}(e.currentDocument):fn.Ge();if(e.update){e.update.name;var r=xe(t,e.update.name),i=new Sn({mapValue:{fields:e.update.fields}});if(e.updateMask){var o=function(t){var e=t.fieldPaths||[];return new an(e.map((function(t){return x.S(t)})))}(e.updateMask);return new bn(r,i,o,n)}return new wn(r,i,n)}if(e.delete){var s=xe(t,e.delete);return new Nn(s,n)}if(e.transform){var u=xe(t,e.transform.document),a=e.transform.fieldTransforms.map((function(e){return function(t,e){var n=null;if("setToServerValue"in e)g("REQUEST_TIME"===e.setToServerValue),n=new Ze;else if("appendMissingElements"in e){var r=e.appendMissingElements.values||[];n=new tn(r)}else if("removeAllFromArray"in e){var i=e.removeAllFromArray.values||[];n=new nn(i)}else"increment"in e?n=new on(t,e.increment):_();var o=x.S(e.fieldPath);return new cn(o,n)}(t,e)}));return g(!0===n.exists),new In(u,a)}if(e.verify){var c=xe(t,e.verify);return new An(c,n)}return _()}function Ve(t,e){return{documents:[De(t,e.path)]}}function Ue(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=De(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=De(t,r.h()),n.structuredQuery.from=[{collectionId:r._()}]);var i=function(t){if(0!==t.length){var e=t.map((function(t){return function(t){if("=="===t.op){if(pe(t.value))return{unaryFilter:{field:Ge(t.field),op:"IS_NAN"}};if(le(t.value))return{unaryFilter:{field:Ge(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(pe(t.value))return{unaryFilter:{field:Ge(t.field),op:"IS_NOT_NAN"}};if(le(t.value))return{unaryFilter:{field:Ge(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ge(t.field),op:Be(t.op),value:t.value}}}(t)}));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map((function(t){return function(t){return{field:Ge(t.field),direction:qe(t.dir)}}(t)}))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.Ue||ht(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=je(e.startAt)),e.endAt&&(n.structuredQuery.endAt=je(e.endAt)),n}function Me(t){var e=ke(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){g(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=function t(e){return e?void 0!==e.unaryFilter?[Ke(e)]:void 0!==e.fieldFilter?[We(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map((function(e){return t(e)})).reduce((function(t,e){return t.concat(e)})):_():[]}(n.where));var u=[];n.orderBy&&(u=n.orderBy.map((function(t){return function(t){return new fr(ze(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)})));var a=null;n.limit&&(a=function(t){var e;return ht(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=Fe(n.startAt));var h=null;return n.endAt&&(h=Fe(n.endAt)),Gn(Pn(e,i,u,s,a,"F",c,h))}function je(t){return{before:t.before,values:t.position}}function Fe(t){var e=!!t.before,n=t.values||[];return new ur(n,e)}function qe(t){return ve[t]}function Be(t){return ye[t]}function Ge(t){return{fieldPath:t.R()}}function ze(t){return x.S(t.fieldPath)}function We(t){return Jn.create(ze(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return _()}}(t.fieldFilter.op),t.fieldFilter.value)}function Ke(t){switch(t.unaryFilter.op){case"IS_NAN":var e=ze(t.unaryFilter.field);return Jn.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=ze(t.unaryFilter.field);return Jn.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=ze(t.unaryFilter.field);return Jn.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=ze(t.unaryFilter.field);return Jn.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return _()}}function Qe(t){var e=[];return t.fields.forEach((function(t){return e.push(t.R())})),{fieldPaths:e}}function He(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}var Xe=function(){this.ze=void 0};function Ye(t,e,n){return t instanceof Ze?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof tn?en(t,e):t instanceof nn?rn(t,e):function(t,e){var n=Je(t,e),r=sn(n)+sn(t.We);return he(n)&&he(t.We)?me(r):we(t.serializer,r)}(t,e)}function $e(t,e,n){return t instanceof tn?en(t,e):t instanceof nn?rn(t,e):n}function Je(t,e){return t instanceof on?he(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var Ze=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r.__extends(e,t),e}(Xe),tn=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return r.__extends(e,t),e}(Xe);function en(t,e){for(var n=un(e),r=function(t){n.some((function(e){return ee(e,t)}))||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var nn=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return r.__extends(e,t),e}(Xe);function rn(t,e){for(var n=un(e),r=function(t){n=n.filter((function(e){return!ee(e,t)}))},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var on=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).serializer=e,r.We=n,r}return r.__extends(e,t),e}(Xe);function sn(t){return ue(t.integerValue||t.doubleValue)}function un(t){return fe(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var an=function(){function t(t){this.fields=t,t.sort(x.i)}return t.prototype.He=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].T(t))return!0;return!1},t.prototype.isEqual=function(t){return J(this.fields,t.fields,(function(t,e){return t.isEqual(e)}))},t}(),cn=function(t,e){this.field=t,this.transform=e},hn=function(t,e){this.version=t,this.transformResults=e},fn=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.Ge=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"je",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function ln(t,e){return void 0!==t.updateTime?e instanceof On&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof On}var pn=function(){};function dn(t,e,n){return t instanceof wn?function(t,e,n){return new On(t.key,n.version,t.value,{hasCommittedMutations:!0})}(t,0,n):t instanceof bn?function(t,e,n){if(!ln(t.Ke,e))return new Ln(t.key,n.version);var r=_n(t,e);return new On(t.key,n.version,r,{hasCommittedMutations:!0})}(t,e,n):t instanceof In?function(t,e,n){if(g(null!=n.transformResults),!ln(t.Ke,e))return new Ln(t.key,n.version);var r=En(t,e),i=function(t,e,n){var r=[];g(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,u=null;e instanceof On&&(u=e.field(o.field)),r.push($e(s,u,n[i]))}return r}(t.fieldTransforms,e,n.transformResults),o=n.version,s=Tn(t,r.data(),i);return new On(t.key,o,s,{hasCommittedMutations:!0})}(t,e,n):function(t,e,n){return new Rn(t.key,n.version,{hasCommittedMutations:!0})}(t,0,n)}function vn(t,e,n,r){return t instanceof wn?function(t,e){if(!ln(t.Ke,e))return e;var n=mn(e);return new On(t.key,n,t.value,{Ye:!0})}(t,e):t instanceof bn?function(t,e){if(!ln(t.Ke,e))return e;var n=mn(e),r=_n(t,e);return new On(t.key,n,r,{Ye:!0})}(t,e):t instanceof In?function(t,e,n,r){if(!ln(t.Ke,e))return e;var i=En(t,e),o=function(t,e,n,r){for(var i=[],o=0,s=t;o<s.length;o++){var u=s[o],a=u.transform,c=null;n instanceof On&&(c=n.field(u.field)),null===c&&r instanceof On&&(c=r.field(u.field)),i.push(Ye(a,c,e))}return i}(t.fieldTransforms,n,e,r),s=Tn(t,i.data(),o);return new On(t.key,i.version,s,{Ye:!0})}(t,e,r,n):function(t,e){return ln(t.Ke,e)?new Rn(t.key,ct.min()):e}(t,e)}function yn(t,e){return t instanceof In?function(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e instanceof On?e.field(o.field):void 0,u=Je(o.transform,s||null);null!=u&&(n=null==n?(new xn).set(o.field,u):n.set(o.field,u))}return n?n.Je():null}(t,e):null}function gn(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.Ke.isEqual(e.Ke)&&(0===t.type?t.value.isEqual(e.value):1===t.type?t.data.isEqual(e.data)&&t.Qe.isEqual(e.Qe):2!==t.type||J(t.fieldTransforms,t.fieldTransforms,(function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof tn&&e instanceof tn||t instanceof nn&&e instanceof nn?J(t.elements,e.elements,ee):t instanceof on&&e instanceof on?ee(t.We,e.We):t instanceof Ze&&e instanceof Ze}(t.transform,e.transform)}(t,e)})))}function mn(t){return t instanceof On?t.version:ct.min()}var wn=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).key=e,i.value=n,i.Ke=r,i.type=0,i}return r.__extends(e,t),e}(pn),bn=function(t){function e(e,n,r,i){var o=this;return(o=t.call(this)||this).key=e,o.data=n,o.Qe=r,o.Ke=i,o.type=1,o}return r.__extends(e,t),e}(pn);function _n(t,e){return function(t,e){var n=new xn(e);return t.Qe.fields.forEach((function(e){if(!e.m()){var r=t.data.field(e);null!==r?n.set(e,r):n.delete(e)}})),n.Je()}(t,e instanceof On?e.data():Sn.empty())}var In=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.fieldTransforms=n,r.type=2,r.Ke=fn.exists(!0),r}return r.__extends(e,t),e}(pn);function En(t,e){return e}function Tn(t,e,n){for(var r=new xn(e),i=0;i<t.fieldTransforms.length;i++){var o=t.fieldTransforms[i];r.set(o.field,n[i])}return r.Je()}var Nn=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.Ke=n,r.type=3,r}return r.__extends(e,t),e}(pn),An=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.Ke=n,r.type=4,r}return r.__extends(e,t),e}(pn),Sn=function(){function t(t){this.proto=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t.m())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!de(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t._()])||null},t.prototype.isEqual=function(t){return ee(this.proto,t.proto)},t}(),xn=function(){function t(t){void 0===t&&(t=Sn.empty()),this.Xe=t,this.Ze=new Map}return t.prototype.set=function(t,e){return this.tn(t,e),this},t.prototype.delete=function(t){return this.tn(t,null),this},t.prototype.tn=function(t,e){for(var n=this.Ze,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map?n=o:o&&10===te(o)?(o=new Map(Object.entries(o.mapValue.fields||{})),n.set(i,o),n=o):(o=new Map,n.set(i,o),n=o)}n.set(t._(),e)},t.prototype.Je=function(){var t=this.en(x.g(),this.Ze);return null!=t?new Sn(t):this.Xe},t.prototype.en=function(t,e){var n=this,r=!1,i=this.Xe.field(t),o=de(i)?Object.assign({},i.mapValue.fields):{};return e.forEach((function(e,i){if(e instanceof Map){var s=n.en(t.child(i),e);null!=s&&(o[i]=s,r=!0)}else null!==e?(o[i]=e,r=!0):o.hasOwnProperty(i)&&(delete o[i],r=!0)})),r?{mapValue:{fields:o}}:null},t}();function Dn(t){var e=[];return T(t.fields||{},(function(t,n){var r=new x([t]);if(de(n)){var i=Dn(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++){var u=s[o];e.push(r.child(u))}}else e.push(r)})),new an(e)}var kn=function(t,e){this.key=t,this.version=e},On=function(t){function e(e,n,r,i){var o=this;return(o=t.call(this,e,n)||this).nn=r,o.Ye=!!i.Ye,o.hasCommittedMutations=!!i.hasCommittedMutations,o}return r.__extends(e,t),e.prototype.field=function(t){return this.nn.field(t)},e.prototype.data=function(){return this.nn},e.prototype.sn=function(){return this.nn.proto},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.Ye===t.Ye&&this.hasCommittedMutations===t.hasCommittedMutations&&this.nn.isEqual(t.nn)},e.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.nn.toString()+", {hasLocalMutations: "+this.Ye+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.Ye||this.hasCommittedMutations},enumerable:!1,configurable:!0}),e}(kn),Rn=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n)||this).hasCommittedMutations=!(!r||!r.hasCommittedMutations),i}return r.__extends(e,t),e.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(kn),Ln=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r.__extends(e,t),e.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(kn),Cn=function(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.rn=n,this.filters=r,this.limit=i,this.on=o,this.startAt=s,this.endAt=u,this.an=null,this.cn=null,this.startAt,this.endAt};function Pn(t,e,n,r,i,o,s,u){return new Cn(t,e,n,r,i,o,s,u)}function Vn(t){return new Cn(t)}function Un(t){return!ht(t.limit)&&"F"===t.on}function Mn(t){return!ht(t.limit)&&"L"===t.on}function jn(t){return t.rn.length>0?t.rn[0].field:null}function Fn(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.un())return r.field}return null}function qn(t){return null!==t.collectionGroup}function Bn(t){var e=I(t);if(null===e.an){e.an=[];var n=Fn(e),r=jn(e);if(null!==n&&null===r)n.p()||e.an.push(new fr(n)),e.an.push(new fr(x.v(),"asc"));else{for(var i=!1,o=0,s=e.rn;o<s.length;o++){var u=s[o];e.an.push(u),u.field.p()&&(i=!0)}if(!i){var a=e.rn.length>0?e.rn[e.rn.length-1].dir:"asc";e.an.push(new fr(x.v(),a))}}}return e.an}function Gn(t){var e=I(t);if(!e.cn)if("F"===e.on)e.cn=vt(e.path,e.collectionGroup,Bn(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=Bn(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new fr(o.field,s))}var u=e.endAt?new ur(e.endAt.position,!e.endAt.before):null,a=e.startAt?new ur(e.startAt.position,!e.startAt.before):null;e.cn=vt(e.path,e.collectionGroup,n,e.filters,e.limit,u,a)}return e.cn}function zn(t,e,n){return new Cn(t.path,t.collectionGroup,t.rn.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Wn(t,e){return new Cn(t.path,t.collectionGroup,t.rn.slice(),t.filters.slice(),t.limit,t.on,e,t.endAt)}function Kn(t,e){return new Cn(t.path,t.collectionGroup,t.rn.slice(),t.filters.slice(),t.limit,t.on,t.startAt,e)}function Qn(t,e){return gt(Gn(t),Gn(e))&&t.on===e.on}function Hn(t){return yt(Gn(t))+"|lt:"+t.on}function Xn(t){return"Query(target="+function(t){var e=t.path.R();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map((function(t){return(e=t).field.R()+" "+e.op+" "+oe(e.value);var e})).join(", ")+"]"),ht(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map((function(t){return(e=t).field.R()+" ("+e.dir+")";var e})).join(", ")+"]"),t.startAt&&(e+=", startAt: "+ar(t.startAt)),t.endAt&&(e+=", endAt: "+ar(t.endAt)),"Target("+e+")"}(Gn(t))+"; limitType="+t.on+")"}function Yn(t,e){return function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.N(t.collectionGroup)&&t.path.T(n):D.F(t.path)?t.path.isEqual(n):t.path.I(n)}(t,e)&&function(t,e){for(var n=0,r=t.rn;n<r.length;n++){var i=r[n];if(!i.field.p()&&null===e.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!cr(t.startAt,Bn(t),e)||t.endAt&&cr(t.endAt,Bn(t),e))}(t,e)}function $n(t){return function(e,n){for(var r=!1,i=0,o=Bn(t);i<o.length;i++){var s=o[i],u=lr(s,e,n);if(0!==u)return u;r=r||s.field.p()}return 0}}var Jn=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return r.__extends(e,t),e.create=function(t,n,r){if(t.p())return"in"===n||"not-in"===n?this.hn(t,n,r):new Zn(t,n,r);if(le(r)){if("=="!==n&&"!="!==n)throw new l(a.INVALID_ARGUMENT,"Invalid query. Null only supports '==' and '!=' comparisons.");return new e(t,n,r)}if(pe(r)){if("=="!==n&&"!="!==n)throw new l(a.INVALID_ARGUMENT,"Invalid query. NaN only supports '==' and '!=' comparisons.");return new e(t,n,r)}return"array-contains"===n?new rr(t,r):"in"===n?new ir(t,r):"not-in"===n?new or(t,r):"array-contains-any"===n?new sr(t,r):new e(t,n,r)},e.hn=function(t,e,n){return"in"===e?new tr(t,n):new er(t,n)},e.prototype.matches=function(t){var e=t.field(this.field);return"!="===this.op?null!==e&&this.ln(re(e,this.value)):null!==e&&te(this.value)===te(e)&&this.ln(re(e,this.value))},e.prototype.ln=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return _()}},e.prototype.un=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},e}((function(){})),Zn=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=D.C(r.referenceValue),i}return r.__extends(e,t),e.prototype.matches=function(t){var e=D.i(t.key,this.key);return this.ln(e)},e}(Jn),tr=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=nr("in",n),r}return r.__extends(e,t),e.prototype.matches=function(t){return this.keys.some((function(e){return e.isEqual(t.key)}))},e}(Jn),er=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=nr("not-in",n),r}return r.__extends(e,t),e.prototype.matches=function(t){return!this.keys.some((function(e){return e.isEqual(t.key)}))},e}(Jn);function nr(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(t){return D.C(t.referenceValue)}))}var rr=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return r.__extends(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return fe(e)&&ne(e.arrayValue,this.value)},e}(Jn),ir=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return r.__extends(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&ne(this.value.arrayValue,e)},e}(Jn),or=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return r.__extends(e,t),e.prototype.matches=function(t){if(ne(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.field(this.field);return null!==e&&!ne(this.value.arrayValue,e)},e}(Jn),sr=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return r.__extends(e,t),e.prototype.matches=function(t){var e=this,n=t.field(this.field);return!(!fe(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(t){return ne(e.value.arrayValue,t)}))},e}(Jn),ur=function(t,e){this.position=t,this.before=e};function ar(t){return(t.before?"b":"a")+":"+t.position.map((function(t){return oe(t)})).join(",")}function cr(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.p()?D.i(D.C(s.referenceValue),n.key):re(s,n.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function hr(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!ee(t.position[n],e.position[n]))return!1;return!0}var fr=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function lr(t,e,n){var r=t.field.p()?D.i(e.key,n.key):function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?re(r,i):_()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return _()}}function pr(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}var dr=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))},vr=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this._n=t,this.fn=e,this.dn=n,this.wn=r,this.mn=i,this.Tn=0,this.En=null,this.In=Date.now(),this.reset()}return t.prototype.reset=function(){this.Tn=0},t.prototype.An=function(){this.Tn=this.mn},t.prototype.Rn=function(t){var e=this;this.cancel();var n=Math.floor(this.Tn+this.Pn()),r=Math.max(0,Date.now()-this.In),i=Math.max(0,n-r);i>0&&y("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.Tn+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.En=this._n.gn(this.fn,i,(function(){return e.In=Date.now(),t()})),this.Tn*=this.wn,this.Tn<this.dn&&(this.Tn=this.dn),this.Tn>this.mn&&(this.Tn=this.mn)},t.prototype.yn=function(){null!==this.En&&(this.En.Vn(),this.En=null)},t.prototype.cancel=function(){null!==this.En&&(this.En.cancel(),this.En=null)},t.prototype.Pn=function(){return(Math.random()-.5)*this.Tn},t}(),yr=function(){function t(t){var e=this;this.pn=null,this.bn=null,this.result=void 0,this.error=void 0,this.vn=!1,this.Sn=!1,t((function(t){e.vn=!0,e.result=t,e.pn&&e.pn(t)}),(function(t){e.vn=!0,e.error=t,e.bn&&e.bn(t)}))}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.Sn&&_(),this.Sn=!0,this.vn?this.error?this.Dn(n,this.error):this.Cn(e,this.result):new t((function(t,i){r.pn=function(n){r.Cn(e,n).next(t,i)},r.bn=function(e){r.Dn(n,e).next(t,i)}}))},t.prototype.Nn=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},t.prototype.Fn=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.Cn=function(e,n){return e?this.Fn((function(){return e(n)})):t.resolve(n)},t.prototype.Dn=function(e,n){return e?this.Fn((function(){return e(n)})):t.reject(n)},t.resolve=function(e){return new t((function(t,n){t(e)}))},t.reject=function(e){return new t((function(t,n){n(e)}))},t.$n=function(e){return new t((function(t,n){var r=0,i=0,o=!1;e.forEach((function(e){++r,e.next((function(){++i,o&&i===r&&t()}),(function(t){return n(t)}))})),o=!0,i===r&&t()}))},t.xn=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next((function(n){return n?t.resolve(n):e()}))},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.$n(r)},t}(),gr=function(){function e(t,n,i){this.name=t,this.version=n,this.kn=i,12.2===e.Mn(h.getUA())&&p("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return e.delete=function(t){return y("SimpleDb","Removing database:",t),Er(window.indexedDB.deleteDatabase(t)).Nn()},e.On=function(){if("undefined"==typeof indexedDB)return!1;if(e.Ln())return!0;var t=h.getUA(),n=e.Mn(t),i=0<n&&n<10,r=e.Bn(t),s=0<r&&r<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||i||s)},e.Ln=function(){var e;return void 0!==t&&"YES"===(null===(e=t.env)||void 0===e?void 0:e.qn)},e.Un=function(t,e){return t.store(e)},e.Mn=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},e.Bn=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},e.prototype.Qn=function(t){return r.__awaiter(this,void 0,void 0,(function(){var e,n=this;return r.__generator(this,(function(r){switch(r.label){case 0:return this.db?[3,2]:(y("SimpleDb","Opening database:",this.name),e=this,[4,new Promise((function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){var n=t.target.result;e(n)},i.onblocked=function(){r(new wr(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;"VersionError"===n.name?r(new l(a.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(new wr(t,n))},i.onupgradeneeded=function(t){y("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;n.kn.createOrUpgrade(e,i.transaction,t.oldVersion,n.version).next((function(){y("SimpleDb","Database upgrade to version "+n.version+" complete")}))}}))]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.Wn&&(this.db.onversionchange=function(t){return n.Wn(t)}),this.db)]}}))}))},e.prototype.jn=function(t){this.Wn=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},e.prototype.runTransaction=function(t,e,n,i){return r.__awaiter(this,void 0,void 0,(function(){var o,s,u,a,c;return r.__generator(this,(function(h){switch(h.label){case 0:o="readonly"===e,s=0,u=function(){var e,u,c,h,f;return r.__generator(this,(function(r){switch(r.label){case 0:++s,r.label=1;case 1:return r.trys.push([1,4,,5]),[4,a.Qn(t)];case 2:return a.db=r.sent(),e=br.open(a.db,t,o?"readonly":"readwrite",n),u=i(e).catch((function(t){return e.abort(t),yr.reject(t)})).Nn(),c={},u.catch((function(){})),[4,e.Kn];case 3:return[2,(c.value=(r.sent(),u),c)];case 4:return h=r.sent(),f="FirebaseError"!==h.name&&s<3,y("SimpleDb","Transaction failed with error:",h.message,"Retrying:",f),a.close(),f?[3,5]:[2,{value:Promise.reject(h)}];case 5:return[2]}}))},a=this,h.label=1;case 1:return[5,u()];case 2:if("object"==typeof(c=h.sent()))return[2,c.value];h.label=3;case 3:return[3,1];case 4:return[2]}}))}))},e.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},e}(),mr=function(){function t(t){this.Gn=t,this.zn=!1,this.Hn=null}return Object.defineProperty(t.prototype,"vn",{get:function(){return this.zn},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Yn",{get:function(){return this.Hn},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Gn=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.zn=!0},t.prototype.Jn=function(t){this.Hn=t},t.prototype.delete=function(){return Er(this.Gn.delete())},t}(),wr=function(t){function e(e,n){var r=this;return(r=t.call(this,a.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return r.__extends(e,t),e}(l);function _r(t){return"IndexedDbTransactionError"===t.name}var br=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.Xn=new dr,this.transaction.oncomplete=function(){n.Xn.resolve()},this.transaction.onabort=function(){e.error?n.Xn.reject(new wr(t,e.error)):n.Xn.resolve()},this.transaction.onerror=function(e){var r=Nr(e.target.error);n.Xn.reject(new wr(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new wr(n,e)}},Object.defineProperty(t.prototype,"Kn",{get:function(){return this.Xn.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.Xn.reject(t),this.aborted||(y("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new Ir(e)},t}(),Ir=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(y("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(y("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Er(n)},t.prototype.add=function(t){return y("SimpleDb","ADD",this.store.name,t,t),Er(this.store.add(t))},t.prototype.get=function(t){var e=this;return Er(this.store.get(t)).next((function(n){return void 0===n&&(n=null),y("SimpleDb","GET",e.store.name,t,n),n}))},t.prototype.delete=function(t){return y("SimpleDb","DELETE",this.store.name,t),Er(this.store.delete(t))},t.prototype.count=function(){return y("SimpleDb","COUNT",this.store.name),Er(this.store.count())},t.prototype.Zn=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.ts(n,(function(t,e){r.push(e)})).next((function(){return r}))},t.prototype.es=function(t,e){y("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.ns=!1;var r=this.cursor(n);return this.ts(r,(function(t,e,n){return n.delete()}))},t.prototype.ss=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.ts(r,e)},t.prototype.rs=function(t){var e=this.cursor({});return new yr((function(n,r){e.onerror=function(t){var e=Nr(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},t.prototype.ts=function(t,e){var n=[];return new yr((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new mr(i),s=e(i.primaryKey,i.value,o);if(s instanceof yr){var u=s.catch((function(t){return o.done(),yr.reject(t)}));n.push(u)}o.vn?r():null===o.Yn?i.continue():i.continue(o.Yn)}else r()}})).next((function(){return yr.$n(n)}))},t.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.ns?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function Er(t){return new yr((function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=Nr(t.target.error);n(e)}}))}var Tr=!1;function Nr(t){var e=gr.Mn(h.getUA());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var i=new l("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Tr||(Tr=!0,setTimeout((function(){throw i}),0)),i}}return t}function Ar(){return"undefined"!=typeof window?window:null}function Sr(){return"undefined"!=typeof document?document:null}var xr=function(){function t(t,e,n,r,i){this.os=t,this.fn=e,this.cs=n,this.op=r,this.us=i,this.hs=new dr,this.then=this.hs.promise.then.bind(this.hs.promise),this.hs.promise.catch((function(t){}))}return t.ls=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this._s=setTimeout((function(){return e.fs()}),t)},t.prototype.Vn=function(){return this.fs()},t.prototype.cancel=function(t){null!==this._s&&(this.clearTimeout(),this.hs.reject(new l(a.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.fs=function(){var t=this;this.os.ds((function(){return null!==t._s?(t.clearTimeout(),t.op().then((function(e){return t.hs.resolve(e)}))):Promise.resolve()}))},t.prototype.clearTimeout=function(){null!==this._s&&(this.us(this),clearTimeout(this._s),this._s=null)},t}(),Dr=function(){function t(){var t=this;this.ws=Promise.resolve(),this.Ts=[],this.Es=!1,this.Is=[],this.As=null,this.Rs=!1,this.Ps=[],this.gs=new vr(this,"async_queue_retry"),this.ys=function(){var e=Sr();e&&y("AsyncQueue","Visibility state changed to  ",e.visibilityState),t.gs.yn()};var e=Sr();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.ys)}return Object.defineProperty(t.prototype,"Vs",{get:function(){return this.Es},enumerable:!1,configurable:!0}),t.prototype.ds=function(t){this.enqueue(t)},t.prototype.ps=function(t){this.bs(),this.vs(t)},t.prototype.Ss=function(){if(!this.Es){this.Es=!0;var t=Sr();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.ys)}},t.prototype.enqueue=function(t){return this.bs(),this.Es?new Promise((function(t){})):this.vs(t)},t.prototype.Ds=function(t){var e=this;this.Ts.push(t),this.ds((function(){return e.Cs()}))},t.prototype.Cs=function(){return r.__awaiter(this,void 0,void 0,(function(){var t,e=this;return r.__generator(this,(function(n){switch(n.label){case 0:if(0===this.Ts.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.Ts[0]()];case 2:return n.sent(),this.Ts.shift(),this.gs.reset(),[3,4];case 3:if(!_r(t=n.sent()))throw t;return y("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.Ts.length>0&&this.gs.Rn((function(){return e.Cs()})),n.label=5;case 5:return[2]}}))}))},t.prototype.vs=function(t){var e=this,n=this.ws.then((function(){return e.Rs=!0,t().catch((function(t){throw e.As=t,e.Rs=!1,p("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t})).then((function(t){return e.Rs=!1,t}))}));return this.ws=n,n},t.prototype.gn=function(t,e,n){var r=this;this.bs(),this.Ps.indexOf(t)>-1&&(e=0);var i=xr.ls(this,t,e,n,(function(t){return r.Ns(t)}));return this.Is.push(i),i},t.prototype.bs=function(){this.As&&_()},t.prototype.Fs=function(){},t.prototype.$s=function(){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(e){switch(e.label){case 0:return[4,t=this.ws];case 1:e.sent(),e.label=2;case 2:if(t!==this.ws)return[3,0];e.label=3;case 3:return[2]}}))}))},t.prototype.xs=function(t){for(var e=0,n=this.Is;e<n.length;e++)if(n[e].fn===t)return!0;return!1},t.prototype.ks=function(t){var e=this;return this.$s().then((function(){e.Is.sort((function(t,e){return t.cs-e.cs}));for(var n=0,r=e.Is;n<r.length;n++){var i=r[n];if(i.Vn(),"all"!==t&&i.fn===t)break}return e.$s()}))},t.prototype.Ms=function(t){this.Ps.push(t)},t.prototype.Ns=function(t){var e=this.Is.indexOf(t);this.Is.splice(e,1)},t}();function kr(t,e){if(p("AsyncQueue",e+": "+t),_r(t))return new l(a.UNAVAILABLE,e+": "+t);throw t}var Or=function(){this.Os=void 0,this.listeners=[]},Rr=function(){this.Ls=new ut((function(t){return Hn(t)}),Qn),this.onlineState="Unknown",this.Bs=new Set};function Lr(t,e){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o,s,u,a,c;return r.__generator(this,(function(r){switch(r.label){case 0:if(n=I(t),i=e.query,o=!1,(s=n.Ls.get(i))||(o=!0,s=new Or),!o)return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),u=s,[4,n.qs(i)];case 2:return u.Os=r.sent(),[3,4];case 3:return a=r.sent(),c=kr(a,"Initialization of query '"+Xn(e.query)+"' failed"),[2,void e.onError(c)];case 4:return n.Ls.set(i,s),s.listeners.push(e),e.Us(n.onlineState),s.Os&&e.Qs(s.Os)&&Ur(n),[2]}}))}))}function Cr(t,e){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o,s,u;return r.__generator(this,(function(r){return n=I(t),i=e.query,o=!1,(s=n.Ls.get(i))&&(u=s.listeners.indexOf(e))>=0&&(s.listeners.splice(u,1),o=0===s.listeners.length),o?[2,(n.Ls.delete(i),n.Ws(i))]:[2]}))}))}function Pr(t,e){for(var n=I(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],u=s.query,a=n.Ls.get(u);if(a){for(var c=0,h=a.listeners;c<h.length;c++)h[c].Qs(s)&&(r=!0);a.Os=s}}r&&Ur(n)}function Vr(t,e,n){var r=I(t),i=r.Ls.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.Ls.delete(e)}function Ur(t){t.Bs.forEach((function(t){t.next()}))}var Mr=function(){function t(t,e,n){this.query=t,this.js=e,this.Ks=!1,this.Gs=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Qs=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new qt(t.query,t.docs,t.Ut,e,t.Qt,t.fromCache,t.Wt,!0)}var o=!1;return this.Ks?this.zs(t)&&(this.js.next(t),o=!0):this.Hs(t,this.onlineState)&&(this.Ys(t),o=!0),this.Gs=t,o},t.prototype.onError=function(t){this.js.error(t)},t.prototype.Us=function(t){this.onlineState=t;var e=!1;return this.Gs&&!this.Ks&&this.Hs(this.Gs,t)&&(this.Ys(this.Gs),e=!0),e},t.prototype.Hs=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.Js&&n||t.docs.m()&&"Offline"!==e)},t.prototype.zs=function(t){if(t.docChanges.length>0)return!0;var e=this.Gs&&this.Gs.hasPendingWrites!==t.hasPendingWrites;return!(!t.Wt&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.Ys=function(t){t=qt.Kt(t.query,t.docs,t.Qt,t.fromCache),this.Ks=!0,this.js.next(t)},t}(),jr=function(){function t(t){this.uid=t}return t.prototype.Xs=function(){return null!=this.uid},t.prototype.Zs=function(){return this.Xs()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();jr.UNAUTHENTICATED=new jr(null),jr.ti=new jr("google-credentials-uid"),jr.ei=new jr("first-party-uid");var Fr=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.ni=function(t){return n.si(t)},this.ii=function(t){return e.ri(t)})}return t.prototype.si=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.ii&&this.ii(t),t},t}();function qr(t,e){return"firestore_clients_"+t+"_"+e}function Br(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.Xs()&&(r+="_"+e.uid),r}function Gr(t,e){return"firestore_targets_"+t+"_"+e}Fr.oi=-1;var zr=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.ai=function(e,n,r){var i=JSON.parse(r),o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error),s=void 0;return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(s=new l(i.error.code,i.error.message)),o?new t(e,n,i.state,s):(p("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.ci=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Wr=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.ai=function(e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new l(r.error.code,r.error.message)),i?new t(e,r.state,o):(p("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.ci=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Kr=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.ai=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=Mt(),s=0;i&&s<r.activeTargetIds.length;++s)i=lt(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(p("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),Qr=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.ai=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(p("SharedClientState","Failed to parse online state: "+e),null)},t}(),Hr=function(){function t(){this.activeTargetIds=Mt()}return t.prototype.ui=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.hi=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.ci=function(){var t={activeTargetIds:this.activeTargetIds.A(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),Xr=function(){function t(t,e,n,r,i){this.window=t,this._n=e,this.persistenceKey=n,this.li=r,this._i=null,this.fi=null,this.ni=null,this.di=this.wi.bind(this),this.mi=new Tt($),this.Ti=!1,this.Ei=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ii=qr(this.persistenceKey,this.li),this.Ai=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.mi=this.mi.rt(this.li,new Hr),this.Ri=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Pi=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.gi=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.yi=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.di)}return t.On=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return r.__awaiter(this,void 0,void 0,(function(){var t,e,n,i,o,s,u,a,c,h,f,l=this;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this._i.Vi()];case 1:for(t=r.sent(),e=0,n=t;e<n.length;e++)(i=n[e])!==this.li&&(o=this.getItem(qr(this.persistenceKey,i)))&&(s=Kr.ai(i,o))&&(this.mi=this.mi.rt(s.clientId,s));for(this.pi(),(u=this.storage.getItem(this.yi))&&(a=this.bi(u))&&this.vi(a),c=0,h=this.Ei;c<h.length;c++)f=h[c],this.wi(f);return this.Ei=[],this.window.addEventListener("unload",(function(){return l.Si()})),this.Ti=!0,[2]}}))}))},t.prototype.ri=function(t){this.setItem(this.Ai,JSON.stringify(t))},t.prototype.Di=function(){return this.Ci(this.mi)},t.prototype.Ni=function(t){var e=!1;return this.mi.forEach((function(n,r){r.activeTargetIds.has(t)&&(e=!0)})),e},t.prototype.Fi=function(t){this.$i(t,"pending")},t.prototype.xi=function(t,e,n){this.$i(t,e,n),this.ki(t)},t.prototype.Mi=function(t){var e="not-current";if(this.Ni(t)){var n=this.storage.getItem(Gr(this.persistenceKey,t));if(n){var r=Wr.ai(t,n);r&&(e=r.state)}}return this.Oi.ui(t),this.pi(),e},t.prototype.Li=function(t){this.Oi.hi(t),this.pi()},t.prototype.Bi=function(t){return this.Oi.activeTargetIds.has(t)},t.prototype.qi=function(t){this.removeItem(Gr(this.persistenceKey,t))},t.prototype.Ui=function(t,e,n){this.Qi(t,e,n)},t.prototype.Wi=function(t,e,n){var r=this;e.forEach((function(t){r.ki(t)})),this.currentUser=t,n.forEach((function(t){r.Fi(t)}))},t.prototype.ji=function(t){this.Ki(t)},t.prototype.Si=function(){this.Ti&&(this.window.removeEventListener("storage",this.di),this.removeItem(this.Ii),this.Ti=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return y("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){y("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){y("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.wi=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(y("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Ii)return void p("Received WebStorage notification for local change. Another client might have garbage-collected our state");this._n.Ds((function(){return r.__awaiter(e,void 0,void 0,(function(){var t,e,i,o,s,u;return r.__generator(this,(function(r){if(this.Ti){if(null!==n.key)if(this.Ri.test(n.key)){if(null==n.newValue)return t=this.Gi(n.key),[2,this.zi(t,null)];if(e=this.Hi(n.key,n.newValue))return[2,this.zi(e.clientId,e)]}else if(this.Pi.test(n.key)){if(null!==n.newValue&&(i=this.Yi(n.key,n.newValue)))return[2,this.Ji(i)]}else if(this.gi.test(n.key)){if(null!==n.newValue&&(o=this.Xi(n.key,n.newValue)))return[2,this.Zi(o)]}else if(n.key===this.yi){if(null!==n.newValue&&(s=this.bi(n.newValue)))return[2,this.vi(s)]}else n.key===this.Ai&&(u=function(t){var e=Fr.oi;if(null!=t)try{var n=JSON.parse(t);g("number"==typeof n),e=n}catch(t){p("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==Fr.oi&&this.ni(u)}else this.Ei.push(n);return[2]}))}))}))}},Object.defineProperty(t.prototype,"Oi",{get:function(){return this.mi.get(this.li)},enumerable:!1,configurable:!0}),t.prototype.pi=function(){this.setItem(this.Ii,this.Oi.ci())},t.prototype.$i=function(t,e,n){var r=new zr(this.currentUser,t,e,n),i=Br(this.persistenceKey,this.currentUser,t);this.setItem(i,r.ci())},t.prototype.ki=function(t){var e=Br(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Ki=function(t){var e={clientId:this.li,onlineState:t};this.storage.setItem(this.yi,JSON.stringify(e))},t.prototype.Qi=function(t,e,n){var r=Gr(this.persistenceKey,t),i=new Wr(t,e,n);this.setItem(r,i.ci())},t.prototype.Gi=function(t){var e=this.Ri.exec(t);return e?e[1]:null},t.prototype.Hi=function(t,e){var n=this.Gi(t);return Kr.ai(n,e)},t.prototype.Yi=function(t,e){var n=this.Pi.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return zr.ai(new jr(i),r,e)},t.prototype.Xi=function(t,e){var n=this.gi.exec(t),r=Number(n[1]);return Wr.ai(r,e)},t.prototype.bi=function(t){return Qr.ai(t)},t.prototype.Ji=function(t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return t.user.uid===this.currentUser.uid?[2,this._i.tr(t.batchId,t.state,t.error)]:(y("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])}))}))},t.prototype.Zi=function(t){return this._i.er(t.targetId,t.state,t.error)},t.prototype.zi=function(t,e){var n=this,r=e?this.mi.rt(t,e):this.mi.remove(t),i=this.Ci(this.mi),o=this.Ci(r),s=[],u=[];return o.forEach((function(t){i.has(t)||s.push(t)})),i.forEach((function(t){o.has(t)||u.push(t)})),this._i.nr(s,u).then((function(){n.mi=r}))},t.prototype.vi=function(t){this.mi.get(t.clientId)&&this.fi(t.onlineState)},t.prototype.Ci=function(t){var e=Mt();return t.forEach((function(t,n){e=e.xt(n.activeTargetIds)})),e},t}(),Yr=function(){function t(){this.sr=new Hr,this.ir={},this.fi=null,this.ni=null}return t.prototype.Fi=function(t){},t.prototype.xi=function(t,e,n){},t.prototype.Mi=function(t){return this.sr.ui(t),this.ir[t]||"not-current"},t.prototype.Ui=function(t,e,n){this.ir[t]=e},t.prototype.Li=function(t){this.sr.hi(t)},t.prototype.Bi=function(t){return this.sr.activeTargetIds.has(t)},t.prototype.qi=function(t){delete this.ir[t]},t.prototype.Di=function(){return this.sr.activeTargetIds},t.prototype.Ni=function(t){return this.sr.activeTargetIds.has(t)},t.prototype.start=function(){return this.sr=new Hr,Promise.resolve()},t.prototype.Wi=function(t,e,n){},t.prototype.ji=function(t){},t.prototype.Si=function(){},t.prototype.ri=function(t){},t}(),$r=function(){function t(t,e,n,r){this.batchId=t,this.rr=e,this.baseMutations=n,this.mutations=r}return t.prototype.ar=function(t,e,n){for(var r=n.cr,i=0;i<this.mutations.length;i++){var o=this.mutations[i];o.key.isEqual(t)&&(e=dn(o,e,r[i]))}return e},t.prototype.ur=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++){var i=r[n];i.key.isEqual(t)&&(e=vn(i,e,e,this.rr))}for(var o=e,s=0,u=this.mutations;s<u.length;s++){var a=u[s];a.key.isEqual(t)&&(e=vn(a,e,o,this.rr))}return e},t.prototype.hr=function(t){var e=this,n=t;return this.mutations.forEach((function(r){var i=e.ur(r.key,t.get(r.key));i&&(n=n.rt(r.key,i))})),n},t.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),Vt())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&J(this.mutations,t.mutations,(function(t,e){return gn(t,e)}))&&J(this.baseMutations,t.baseMutations,(function(t,e){return gn(t,e)}))},t}(),Jr=function(){function t(t,e,n,r){this.batch=t,this.lr=e,this.cr=n,this._r=r}return t.from=function(e,n,r){g(e.mutations.length===r.length);for(var i=Ct,o=e.mutations,s=0;s<o.length;s++)i=i.rt(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),Zr=function(){function t(){this.dr=new ut((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),this.wr=!1}return Object.defineProperty(t.prototype,"readTime",{get:function(){return this.mr},set:function(t){this.mr=t},enumerable:!1,configurable:!0}),t.prototype.Tr=function(t,e){this.Er(),this.readTime=e,this.dr.set(t.key,t)},t.prototype.Ir=function(t,e){this.Er(),e&&(this.readTime=e),this.dr.set(t,null)},t.prototype.Ar=function(t,e){this.Er();var n=this.dr.get(e);return void 0!==n?yr.resolve(n):this.Rr(t,e)},t.prototype.getEntries=function(t,e){return this.Pr(t,e)},t.prototype.apply=function(t){return this.Er(),this.wr=!0,this.gr(t)},t.prototype.Er=function(){},t}(),ti="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",ei=function(){function t(){this.yr=[]}return t.prototype.Vr=function(t){this.yr.push(t)},t.prototype.pr=function(){this.yr.forEach((function(t){return t()}))},t}(),ni=function(){function t(t,e,n){this.br=t,this.vr=e,this.Sr=n}return t.prototype.Dr=function(t,e){var n=this;return this.vr.Cr(t,e).next((function(r){return n.Nr(t,e,r)}))},t.prototype.Nr=function(t,e,n){return this.br.Ar(t,e).next((function(t){for(var r=0,i=n;r<i.length;r++)t=i[r].ur(e,t);return t}))},t.prototype.Fr=function(t,e,n){var r=Ot();return e.forEach((function(t,e){for(var i=0,o=n;i<o.length;i++)e=o[i].ur(t,e);r=r.rt(t,e)})),r},t.prototype.$r=function(t,e){var n=this;return this.br.getEntries(t,e).next((function(e){return n.kr(t,e)}))},t.prototype.kr=function(t,e){var n=this;return this.vr.Mr(t,e).next((function(r){var i=n.Fr(t,e,r),o=kt();return i.forEach((function(t,e){e||(e=new Rn(t,ct.min())),o=o.rt(t,e)})),o}))},t.prototype.Or=function(t,e,n){return function(t){return D.F(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Lr(t,e.path):qn(e)?this.Br(t,e,n):this.qr(t,e,n)},t.prototype.Lr=function(t,e){return this.Dr(t,new D(e)).next((function(t){var e=Lt();return t instanceof On&&(e=e.rt(t.key,t)),e}))},t.prototype.Br=function(t,e,n){var r=this,i=e.collectionGroup,o=Lt();return this.Sr.Ur(t,i).next((function(s){return yr.forEach(s,(function(s){var u=function(t,e){return new Cn(e,null,t.rn.slice(),t.filters.slice(),t.limit,t.on,t.startAt,t.endAt)}(e,s.child(i));return r.qr(t,u,n).next((function(t){t.forEach((function(t,e){o=o.rt(t,e)}))}))})).next((function(){return o}))}))},t.prototype.qr=function(t,e,n){var r,i,o=this;return this.br.Or(t,e,n).next((function(n){return r=n,o.vr.Qr(t,e)})).next((function(e){return i=e,o.Wr(t,i,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,u=o.mutations;s<u.length;s++){var a=u[s],c=a.key,h=r.get(c),f=vn(a,h,h,o.rr);r=f instanceof On?r.rt(c,f):r.remove(c)}}))})).next((function(){return r.forEach((function(t,n){Yn(e,n)||(r=r.remove(t))})),r}))},t.prototype.Wr=function(t,e,n){for(var r=Vt(),i=0,o=e;i<o.length;i++)for(var s=0,u=o[i].mutations;s<u.length;s++){var a=u[s];a instanceof bn&&null===n.get(a.key)&&(r=r.add(a.key))}var c=n;return this.br.getEntries(t,r).next((function(t){return t.forEach((function(t,e){null!==e&&e instanceof On&&(c=c.rt(t,e))})),c}))},t}(),ri=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.jr=n,this.Kr=r}return t.Gr=function(e,n){for(var r=Vt(),i=Vt(),o=0,s=n.docChanges;o<s.length;o++){var u=s[o];switch(u.type){case 0:r=r.add(u.doc.key);break;case 1:i=i.add(u.doc.key)}}return new t(e,n.fromCache,r,i)},t}();function ii(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=$(n,i);return 0===s?$(r,o):s}var oi=function(){function t(t){this.zr=t,this.buffer=new St(ii),this.Hr=0}return t.prototype.Yr=function(){return++this.Hr},t.prototype.Jr=function(t){var e=[t,this.Yr()];if(this.buffer.size<this.zr)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();ii(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),si={Xr:!1,Zr:0,eo:0,no:0},ui=function(){function t(t,e,n){this.so=t,this.io=e,this.ro=n}return t.oo=function(e){return new t(e,t.ao,t.co)},t}();ui.uo=-1,ui.ho=1048576,ui.lo=41943040,ui.ao=10,ui.co=1e3,ui._o=new ui(ui.lo,ui.ao,ui.co),ui.fo=new ui(ui.uo,0,0);var ai=function(){function t(t,e){this.do=t,this.os=e,this.wo=!1,this.mo=null}return t.prototype.start=function(t){this.do.params.so!==ui.uo&&this.To(t)},t.prototype.stop=function(){this.mo&&(this.mo.cancel(),this.mo=null)},Object.defineProperty(t.prototype,"Ti",{get:function(){return null!==this.mo},enumerable:!1,configurable:!0}),t.prototype.To=function(t){var e=this,n=this.wo?3e5:6e4;y("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.mo=this.os.gn("lru_garbage_collection",n,(function(){return r.__awaiter(e,void 0,void 0,(function(){var e;return r.__generator(this,(function(n){switch(n.label){case 0:this.mo=null,this.wo=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.Eo(this.do)];case 2:return n.sent(),[3,7];case 3:return _r(e=n.sent())?(y("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,xo(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.To(t)];case 8:return n.sent(),[2]}}))}))}))},t}(),ci=function(){function t(t,e){this.Io=t,this.params=e}return t.prototype.Ao=function(t,e){return this.Io.Ro(t).next((function(t){return Math.floor(e/100*t)}))},t.prototype.Po=function(t,e){var n=this;if(0===e)return yr.resolve(Fr.oi);var r=new oi(e);return this.Io.De(t,(function(t){return r.Jr(t.sequenceNumber)})).next((function(){return n.Io.yo(t,(function(t){return r.Jr(t)}))})).next((function(){return r.maxValue}))},t.prototype.Vo=function(t,e,n){return this.Io.Vo(t,e,n)},t.prototype.po=function(t,e){return this.Io.po(t,e)},t.prototype.bo=function(t,e){var n=this;return this.params.so===ui.uo?(y("LruGarbageCollector","Garbage collection skipped; disabled"),yr.resolve(si)):this.vo(t).next((function(r){return r<n.params.so?(y("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.so),si):n.So(t,e)}))},t.prototype.vo=function(t){return this.Io.vo(t)},t.prototype.So=function(t,e){var n,i,r,s,u,a,o,h=this,p=Date.now();return this.Ao(t,this.params.io).next((function(e){return e>h.params.ro?(y("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.ro+" from "+e),i=h.params.ro):i=e,s=Date.now(),h.Po(t,i)})).next((function(r){return n=r,u=Date.now(),h.Vo(t,n,e)})).next((function(e){return r=e,a=Date.now(),h.po(t,n)})).next((function(t){return o=Date.now(),v()<=c.LogLevel.DEBUG&&y("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-p)+"ms\n\tDetermined least recently used "+i+" in "+(u-s)+"ms\n\tRemoved "+r+" targets in "+(a-u)+"ms\n\tRemoved "+t+" documents in "+(o-a)+"ms\nTotal Duration: "+(o-p)+"ms"),yr.resolve({Xr:!0,Zr:i,eo:r,no:t})}))},t}();function hi(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=li(e)),e=fi(t.get(n),e);return li(e)}function fi(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function li(t){return t+""}function pi(t){var e=t.length;if(g(e>=2),2===e)return g(""===t.charAt(0)&&""===t.charAt(1)),A.g();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||s>n)&&_(),t.charAt(s+1)){case"":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=""),r.push(a);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:_()}o=s+2}return new A(r)}var di=function(t){this.Do=t};function vi(t,e){if(e.document)return function(t,e,n){var r=xe(t,e.name),i=Te(e.updateTime),o=new Sn({mapValue:{fields:e.fields}});return new On(r,i,o,{hasCommittedMutations:!!n})}(t.Do,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=D.$(e.noDocument.path),r=bi(e.noDocument.readTime);return new Rn(n,r,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){var i=D.$(e.unknownDocument.path),o=bi(e.unknownDocument.version);return new Ln(i,o)}return _()}function yi(t,e,n){var r=gi(n),i=e.key.path.h().A();if(e instanceof On){var o=function(t,e){return{name:Se(t,e.key),fields:e.sn().mapValue.fields,updateTime:_e(t,e.version.X())}}(t.Do,e),s=e.hasCommittedMutations;return new Ki(null,null,o,s,r,i)}if(e instanceof Rn){var u=e.key.path.A(),a=wi(e.version),c=e.hasCommittedMutations;return new Ki(null,new zi(u,a),null,c,r,i)}if(e instanceof Ln){var h=e.key.path.A(),f=wi(e.version);return new Ki(new Wi(h,f),null,null,!0,r,i)}return _()}function gi(t){var e=t.X();return[e.seconds,e.nanoseconds]}function mi(t){var e=new at(t[0],t[1]);return ct.Y(e)}function wi(t){var e=t.X();return new ji(e.seconds,e.nanoseconds)}function bi(t){var e=new at(t.seconds,t.nanoseconds);return ct.Y(e)}function _i(t,e){var n=(e.baseMutations||[]).map((function(e){return Pe(t.Do,e)})),r=e.mutations.map((function(e){return Pe(t.Do,e)})),i=at.fromMillis(e.localWriteTimeMs);return new $r(e.batchId,i,n,r)}function Ii(t){var e,n,r=bi(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?bi(t.lastLimboFreeSnapshotVersion):ct.min();return void 0!==t.query.documents?(g(1===(n=t.query).documents.length),e=Gn(Vn(ke(n.documents[0])))):e=Me(t.query),new bt(e,t.targetId,0,t.lastListenSequenceNumber,r,i,tt.fromBase64String(t.resumeToken))}function Ei(t,e){var n,r=wi(e.et),i=wi(e.lastLimboFreeSnapshotVersion);n=dt(e.target)?Ve(t.Do,e.target):Ue(t.Do,e.target);var o=e.resumeToken.toBase64();return new Hi(e.targetId,yt(e.target),r,o,e.sequenceNumber,i,n)}var Ti=function(){function t(t,e,n,r){this.userId=t,this.serializer=e,this.Sr=n,this.Co=r,this.No={}}return t.Fo=function(e,n,r,i){return g(""!==e.uid),new t(e.Xs()?e.uid:"",n,r,i)},t.prototype.$o=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Si(t).ss({index:Bi.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},t.prototype.xo=function(t,e,n,r){var i=this,o=xi(t),s=Si(t);return s.add({}).next((function(u){g("number"==typeof u);for(var a=new $r(u,e,n,r),c=function(t,e,n){var r=n.baseMutations.map((function(e){return Ce(t.Do,e)})),i=n.mutations.map((function(e){return Ce(t.Do,e)}));return new Bi(e,n.batchId,n.rr.toMillis(),r,i)}(i.serializer,i.userId,a),h=[],f=new St((function(t,e){return $(t.R(),e.R())})),l=0,p=r;l<p.length;l++){var d=p[l],v=Gi.key(i.userId,d.key.path,u);f=f.add(d.key.path.h()),h.push(s.put(c)),h.push(o.put(v,Gi.PLACEHOLDER))}return f.forEach((function(e){h.push(i.Sr.ko(t,e))})),t.Vr((function(){i.No[u]=a.keys()})),yr.$n(h).next((function(){return a}))}))},t.prototype.Mo=function(t,e){var n=this;return Si(t).get(e).next((function(t){return t?(g(t.userId===n.userId),_i(n.serializer,t)):null}))},t.prototype.Oo=function(t,e){var n=this;return this.No[e]?yr.resolve(this.No[e]):this.Mo(t,e).next((function(t){if(t){var r=t.keys();return n.No[e]=r,r}return null}))},t.prototype.Lo=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return Si(t).ss({index:Bi.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(g(e.batchId>=r),o=_i(n.serializer,e)),i.done()})).next((function(){return o}))},t.prototype.Bo=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Si(t).ss({index:Bi.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},t.prototype.qo=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Si(t).Zn(Bi.userMutationsIndex,n).next((function(t){return t.map((function(t){return _i(e.serializer,t)}))}))},t.prototype.Cr=function(t,e){var n=this,r=Gi.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return xi(t).ss({range:i},(function(r,i,s){var u=r[0],a=r[1],c=r[2],h=pi(a);if(u===n.userId&&e.path.isEqual(h))return Si(t).get(c).next((function(t){if(!t)throw _();g(t.userId===n.userId),o.push(_i(n.serializer,t))}));s.done()})).next((function(){return o}))},t.prototype.Mr=function(t,e){var n=this,r=new St($),i=[];return e.forEach((function(e){var o=Gi.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),u=xi(t).ss({range:s},(function(t,i,o){var s=t[0],u=t[1],a=t[2],c=pi(u);s===n.userId&&e.path.isEqual(c)?r=r.add(a):o.done()}));i.push(u)})),yr.$n(i).next((function(){return n.Uo(t,r)}))},t.prototype.Qr=function(t,e){var n=this,r=e.path,i=r.length+1,o=Gi.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),u=new St($);return xi(t).ss({range:s},(function(t,e,o){var s=t[0],a=t[1],c=t[2],h=pi(a);s===n.userId&&r.T(h)?h.length===i&&(u=u.add(c)):o.done()})).next((function(){return n.Uo(t,u)}))},t.prototype.Uo=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(Si(t).get(e).next((function(t){if(null===t)throw _();g(t.userId===n.userId),r.push(_i(n.serializer,t))})))})),yr.$n(i).next((function(){return r}))},t.prototype.Qo=function(t,e){var n=this;return Ai(t.Wo,this.userId,e).next((function(r){return t.Vr((function(){n.jo(e.batchId)})),yr.forEach(r,(function(e){return n.Co.Ko(t,e)}))}))},t.prototype.jo=function(t){delete this.No[t]},t.prototype.Go=function(t){var e=this;return this.$o(t).next((function(n){if(!n)return yr.resolve();var r=IDBKeyRange.lowerBound(Gi.prefixForUser(e.userId)),i=[];return xi(t).ss({range:r},(function(t,n,r){if(t[0]===e.userId){var o=pi(t[1]);i.push(o)}else r.done()})).next((function(){g(0===i.length)}))}))},t.prototype.zo=function(t,e){return Ni(t,this.userId,e)},t.prototype.Ho=function(t){var e=this;return Di(t).get(this.userId).next((function(t){return t||new qi(e.userId,-1,"")}))},t}();function Ni(t,e,n){var r=Gi.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return xi(t).ss({range:o,ns:!0},(function(t,n,r){var o=t[0],u=t[1];t[2],o===e&&u===i&&(s=!0),r.done()})).next((function(){return s}))}function Ai(t,e,n){var r=t.store(Bi.store),i=t.store(Gi.store),o=[],s=IDBKeyRange.only(n.batchId),u=0,a=r.ss({range:s},(function(t,e,n){return u++,n.delete()}));o.push(a.next((function(){g(1===u)})));for(var c=[],h=0,f=n.mutations;h<f.length;h++){var l=f[h],p=Gi.key(e,l.key.path,n.batchId);o.push(i.delete(p)),c.push(l.key)}return yr.$n(o).next((function(){return c}))}function Si(t){return ho.Un(t,Bi.store)}function xi(t){return ho.Un(t,Gi.store)}function Di(t){return ho.Un(t,qi.store)}var ki=function(){function t(t,e){this.serializer=t,this.Sr=e}return t.prototype.Tr=function(t,e,n){return Li(t).put(Ci(e),n)},t.prototype.Ir=function(t,e){var n=Li(t),r=Ci(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.Yo(t,r)}))},t.prototype.Ar=function(t,e){var n=this;return Li(t).get(Ci(e)).next((function(t){return n.Jo(t)}))},t.prototype.Xo=function(t,e){var n=this;return Li(t).get(Ci(e)).next((function(t){var e=n.Jo(t);return e?{Zo:e,size:Pi(t)}:null}))},t.prototype.getEntries=function(t,e){var n=this,r=Ot();return this.ta(t,e,(function(t,e){var i=n.Jo(e);r=r.rt(t,i)})).next((function(){return r}))},t.prototype.ea=function(t,e){var n=this,r=Ot(),i=new Tt(D.i);return this.ta(t,e,(function(t,e){var o=n.Jo(e);o?(r=r.rt(t,o),i=i.rt(t,Pi(e))):(r=r.rt(t,null),i=i.rt(t,0))})).next((function(){return{na:r,sa:i}}))},t.prototype.ta=function(t,e,n){if(e.m())return yr.resolve();var r=IDBKeyRange.bound(e.first().path.A(),e.last().path.A()),i=e.lt(),o=i.Et();return Li(t).ss({range:r},(function(t,e,r){for(var s=D.$(t);o&&D.i(o,s)<0;)n(o,null),o=i.Et();o&&o.isEqual(s)&&(n(o,e),o=i.It()?i.Et():null),o?r.Jn(o.path.A()):r.done()})).next((function(){for(;o;)n(o,null),o=i.It()?i.Et():null}))},t.prototype.Or=function(t,e,n){var r=this,i=Lt(),o=e.path.length+1,s={};if(n.isEqual(ct.min())){var u=e.path.A();s.range=IDBKeyRange.lowerBound(u)}else{var a=e.path.A(),c=gi(n);s.range=IDBKeyRange.lowerBound([a,c],!0),s.index=Ki.collectionReadTimeIndex}return Li(t).ss(s,(function(t,n,s){if(t.length===o){var u=vi(r.serializer,n);e.path.T(u.key.path)?u instanceof On&&Yn(e,u)&&(i=i.rt(u.key,u)):s.done()}})).next((function(){return i}))},t.prototype.ia=function(t){return new Oi(this,!!t&&t.ra)},t.prototype.oa=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},t.prototype.getMetadata=function(t){return Ri(t).get(Qi.key).next((function(t){return g(!!t),t}))},t.prototype.Yo=function(t,e){return Ri(t).put(Qi.key,e)},t.prototype.Jo=function(t){if(t){var e=vi(this.serializer,t);return e instanceof Rn&&e.version.isEqual(ct.min())?null:e}return null},t}(),Oi=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).aa=e,r.ra=n,r.ca=new ut((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),r}return r.__extends(e,t),e.prototype.gr=function(t){var e=this,n=[],r=0,i=new St((function(t,e){return $(t.R(),e.R())}));return this.dr.forEach((function(o,s){var u=e.ca.get(o);if(s){var a=yi(e.aa.serializer,s,e.readTime);i=i.add(o.path.h());var c=Pi(a);r+=c-u,n.push(e.aa.Tr(t,o,a))}else if(r-=u,e.ra){var h=yi(e.aa.serializer,new Rn(o,ct.min()),e.readTime);n.push(e.aa.Tr(t,o,h))}else n.push(e.aa.Ir(t,o))})),i.forEach((function(r){n.push(e.aa.Sr.ko(t,r))})),n.push(this.aa.updateMetadata(t,r)),yr.$n(n)},e.prototype.Rr=function(t,e){var n=this;return this.aa.Xo(t,e).next((function(t){return null===t?(n.ca.set(e,0),null):(n.ca.set(e,t.size),t.Zo)}))},e.prototype.Pr=function(t,e){var n=this;return this.aa.ea(t,e).next((function(t){var e=t.na;return t.sa.forEach((function(t,e){n.ca.set(t,e)})),e}))},e}(Zr);function Ri(t){return ho.Un(t,Qi.store)}function Li(t){return ho.Un(t,Ki.store)}function Ci(t){return t.path.A()}function Pi(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw _();e=t.noDocument}return JSON.stringify(e).length}var Vi=function(){function t(){this.ua=new Ui}return t.prototype.ko=function(t,e){return this.ua.add(e),yr.resolve()},t.prototype.Ur=function(t,e){return yr.resolve(this.ua.getEntries(e))},t}(),Ui=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t._(),n=t.h(),r=this.index[e]||new St(A.i),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t._(),n=t.h(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new St(A.i)).A()},t}(),Mi=function(){function t(t){this.serializer=t}return t.prototype.createOrUpgrade=function(t,e,n,r){var i=this;g(n<r&&n>=0&&r<=10);var o=new br("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(Fi.store)}(t),function(t){t.createObjectStore(qi.store,{keyPath:qi.keyPath}),t.createObjectStore(Bi.store,{keyPath:Bi.keyPath,autoIncrement:!0}).createIndex(Bi.userMutationsIndex,Bi.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Gi.store)}(t),Ji(t),function(t){t.createObjectStore(Ki.store)}(t));var s=yr.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(Xi.store),t.deleteObjectStore(Hi.store),t.deleteObjectStore(Yi.store)}(t),Ji(t)),s=s.next((function(){return function(t){var e=t.store(Yi.store),n=new Yi(0,0,ct.min().X(),0);return e.put(Yi.key,n)}(o)}))),n<4&&r>=4&&(0!==n&&(s=s.next((function(){return function(t,e){return e.store(Bi.store).Zn().next((function(n){t.deleteObjectStore(Bi.store),t.createObjectStore(Bi.store,{keyPath:Bi.keyPath,autoIncrement:!0}).createIndex(Bi.userMutationsIndex,Bi.userMutationsKeyPath,{unique:!0});var r=e.store(Bi.store),i=n.map((function(t){return r.put(t)}));return yr.$n(i)}))}(t,o)}))),s=s.next((function(){!function(t){t.createObjectStore(Zi.store,{keyPath:Zi.keyPath})}(t)}))),n<5&&r>=5&&(s=s.next((function(){return i.removeAcknowledgedMutations(o)}))),n<6&&r>=6&&(s=s.next((function(){return function(t){t.createObjectStore(Qi.store)}(t),i.addDocumentGlobal(o)}))),n<7&&r>=7&&(s=s.next((function(){return i.ensureSequenceNumbers(o)}))),n<8&&r>=8&&(s=s.next((function(){return i.createCollectionParentIndex(t,o)}))),n<9&&r>=9&&(s=s.next((function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(Ki.store);e.createIndex(Ki.readTimeIndex,Ki.readTimeIndexPath,{unique:!1}),e.createIndex(Ki.collectionReadTimeIndex,Ki.collectionReadTimeIndexPath,{unique:!1})}(e)}))),n<10&&r>=10&&(s=s.next((function(){return i.rewriteCanonicalIds(o)}))),s},t.prototype.addDocumentGlobal=function(t){var e=0;return t.store(Ki.store).ss((function(t,n){e+=Pi(n)})).next((function(){var n=new Qi(e);return t.store(Qi.store).put(Qi.key,n)}))},t.prototype.removeAcknowledgedMutations=function(t){var e=this,n=t.store(qi.store),r=t.store(Bi.store);return n.Zn().next((function(n){return yr.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Zn(Bi.userMutationsIndex,i).next((function(r){return yr.forEach(r,(function(r){g(r.userId===n.userId);var i=_i(e.serializer,r);return Ai(t,n.userId,i).next((function(){}))}))}))}))}))},t.prototype.ensureSequenceNumbers=function(t){var e=t.store(Xi.store),n=t.store(Ki.store);return t.store(Yi.store).get(Yi.key).next((function(t){var r=[];return n.ss((function(n,i){var o=new A(n),s=function(t){return[0,hi(t)]}(o);r.push(e.get(s).next((function(n){return n?yr.resolve():function(n){return e.put(new Xi(0,hi(n),t.highestListenSequenceNumber))}(o)})))})).next((function(){return yr.$n(r)}))}))},t.prototype.createCollectionParentIndex=function(t,e){t.createObjectStore($i.store,{keyPath:$i.keyPath});var n=e.store($i.store),r=new Ui,i=function(t){if(r.add(t)){var e=t._(),i=t.h();return n.put({collectionId:e,parent:hi(i)})}};return e.store(Ki.store).ss({ns:!0},(function(t,e){var n=new A(t);return i(n.h())})).next((function(){return e.store(Gi.store).ss({ns:!0},(function(t,e){t[0];var n=t[1],r=(t[2],pi(n));return i(r.h())}))}))},t.prototype.rewriteCanonicalIds=function(t){var e=this,n=t.store(Hi.store);return n.ss((function(t,r){var i=Ii(r),o=Ei(e.serializer,i);return n.put(o)}))},t}(),ji=function(t,e){this.seconds=t,this.nanoseconds=e},Fi=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};Fi.store="owner",Fi.key="owner";var qi=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};qi.store="mutationQueues",qi.keyPath="userId";var Bi=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};Bi.store="mutations",Bi.keyPath="batchId",Bi.userMutationsIndex="userMutationsIndex",Bi.userMutationsKeyPath=["userId","batchId"];var Gi=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,hi(e)]},t.key=function(t,e,n){return[t,hi(e),n]},t}();Gi.store="documentMutations",Gi.PLACEHOLDER=new Gi;var zi=function(t,e){this.path=t,this.readTime=e},Wi=function(t,e){this.path=t,this.version=e},Ki=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Ki.store="remoteDocuments",Ki.readTimeIndex="readTimeIndex",Ki.readTimeIndexPath="readTime",Ki.collectionReadTimeIndex="collectionReadTimeIndex",Ki.collectionReadTimeIndexPath=["parentPath","readTime"];var Qi=function(t){this.byteSize=t};Qi.store="remoteDocumentGlobal",Qi.key="remoteDocumentGlobalKey";var Hi=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Hi.store="targets",Hi.keyPath="targetId",Hi.queryTargetsIndexName="queryTargetsIndex",Hi.queryTargetsKeyPath=["canonicalId","targetId"];var Xi=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Xi.store="targetDocuments",Xi.keyPath=["targetId","path"],Xi.documentTargetsIndex="documentTargetsIndex",Xi.documentTargetsKeyPath=["path","targetId"];var Yi=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Yi.key="targetGlobalKey",Yi.store="targetGlobal";var $i=function(t,e){this.collectionId=t,this.parent=e};function Ji(t){t.createObjectStore(Xi.store,{keyPath:Xi.keyPath}).createIndex(Xi.documentTargetsIndex,Xi.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Hi.store,{keyPath:Hi.keyPath}).createIndex(Hi.queryTargetsIndexName,Hi.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Yi.store)}$i.store="collectionParents",$i.keyPath=["collectionId","parent"];var Zi=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Zi.store="clientMetadata",Zi.keyPath="clientId";var to=r.__spreadArrays(r.__spreadArrays(r.__spreadArrays([qi.store,Bi.store,Gi.store,Ki.store,Hi.store,Fi.store,Yi.store,Xi.store],[Zi.store]),[Qi.store]),[$i.store]),eo=function(){function t(){this.ha=new Ui}return t.prototype.ko=function(t,e){var n=this;if(!this.ha.has(e)){var r=e._(),i=e.h();t.Vr((function(){n.ha.add(e)}));var o={collectionId:r,parent:hi(i)};return no(t).put(o)}return yr.resolve()},t.prototype.Ur=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[Z(e),""],!1,!0);return no(t).Zn(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(pi(o.parent))}return n}))},t}();function no(t){return ho.Un(t,$i.store)}var ro=function(){function t(t){this.la=t}return t.prototype.next=function(){return this.la+=2,this.la},t._a=function(){return new t(0)},t.fa=function(){return new t(-1)},t}(),io=function(){function t(t,e){this.Co=t,this.serializer=e}return t.prototype.da=function(t){var e=this;return this.wa(t).next((function(n){var r=new ro(n.highestTargetId);return n.highestTargetId=r.next(),e.ma(t,n).next((function(){return n.highestTargetId}))}))},t.prototype.Ta=function(t){return this.wa(t).next((function(t){return ct.Y(new at(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},t.prototype.Ea=function(t){return this.wa(t).next((function(t){return t.highestListenSequenceNumber}))},t.prototype.Ia=function(t,e,n){var r=this;return this.wa(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.X()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.ma(t,i)}))},t.prototype.Aa=function(t,e){var n=this;return this.Ra(t,e).next((function(){return n.wa(t).next((function(r){return r.targetCount+=1,n.Pa(e,r),n.ma(t,r)}))}))},t.prototype.ga=function(t,e){return this.Ra(t,e)},t.prototype.ya=function(t,e){var n=this;return this.Va(t,e.targetId).next((function(){return oo(t).delete(e.targetId)})).next((function(){return n.wa(t)})).next((function(e){return g(e.targetCount>0),e.targetCount-=1,n.ma(t,e)}))},t.prototype.Vo=function(t,e,n){var r=this,i=0,o=[];return oo(t).ss((function(s,u){var a=Ii(u);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(i++,o.push(r.ya(t,a)))})).next((function(){return yr.$n(o)})).next((function(){return i}))},t.prototype.De=function(t,e){return oo(t).ss((function(t,n){var r=Ii(n);e(r)}))},t.prototype.wa=function(t){return so(t).get(Yi.key).next((function(t){return g(null!==t),t}))},t.prototype.ma=function(t,e){return so(t).put(Yi.key,e)},t.prototype.Ra=function(t,e){return oo(t).put(Ei(this.serializer,e))},t.prototype.Pa=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.pa=function(t){return this.wa(t).next((function(t){return t.targetCount}))},t.prototype.ba=function(t,e){var n=yt(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return oo(t).ss({range:r,index:Hi.queryTargetsIndexName},(function(t,n,r){var o=Ii(n);gt(e,o.target)&&(i=o,r.done())})).next((function(){return i}))},t.prototype.va=function(t,e,n){var r=this,i=[],o=uo(t);return e.forEach((function(e){var s=hi(e.path);i.push(o.put(new Xi(n,s))),i.push(r.Co.Sa(t,n,e))})),yr.$n(i)},t.prototype.Da=function(t,e,n){var r=this,i=uo(t);return yr.forEach(e,(function(e){var o=hi(e.path);return yr.$n([i.delete([n,o]),r.Co.Ca(t,n,e)])}))},t.prototype.Va=function(t,e){var n=uo(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.Na=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=uo(t),i=Vt();return r.ss({range:n,ns:!0},(function(t,e,n){var r=pi(t[1]),o=new D(r);i=i.add(o)})).next((function(){return i}))},t.prototype.zo=function(t,e){var n=hi(e.path),r=IDBKeyRange.bound([n],[Z(n)],!1,!0),i=0;return uo(t).ss({index:Xi.documentTargetsIndex,ns:!0,range:r},(function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())})).next((function(){return i>0}))},t.prototype.qe=function(t,e){return oo(t).get(e).next((function(t){return t?Ii(t):null}))},t}();function oo(t){return ho.Un(t,Hi.store)}function so(t){return ho.Un(t,Yi.store)}function uo(t){return ho.Un(t,Xi.store)}var ao="Failed to obtain exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",co=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Wo=e,r.Fa=n,r}return r.__extends(e,t),e}(ei),ho=function(){function t(e,n,r,i,o,s,u,c,h,f){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this._n=o,this.window=s,this.document=u,this.$a=h,this.xa=f,this.ka=null,this.Ma=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Oa=null,this.inForeground=!1,this.La=null,this.Ba=null,this.qa=Number.NEGATIVE_INFINITY,this.Ua=function(t){return Promise.resolve()},!t.On())throw new l(a.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.Co=new po(this,i),this.Qa=n+"main",this.serializer=new di(c),this.Wa=new gr(this.Qa,10,new Mi(this.serializer)),this.ja=new io(this.Co,this.serializer),this.Sr=new eo,this.br=function(t,e){return new ki(t,e)}(this.serializer,this.Sr),this.window&&this.window.localStorage?this.Ka=this.window.localStorage:(this.Ka=null,!1===f&&p("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.Un=function(t,e){if(t instanceof co)return gr.Un(t.Wo,e);throw _()},t.prototype.start=function(){var t=this;return this.Ga().then((function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new l(a.FAILED_PRECONDITION,ao);return t.za(),t.Ha(),t.Ya(),t.runTransaction("getHighestListenSequenceNumber","readonly",(function(e){return t.ja.Ea(e)}))})).then((function(e){t.ka=new Fr(e,t.$a)})).then((function(){t.Ma=!0})).catch((function(e){return t.Wa&&t.Wa.close(),Promise.reject(e)}))},t.prototype.Ja=function(t){var e=this;return this.Ua=function(n){return r.__awaiter(e,void 0,void 0,(function(){return r.__generator(this,(function(e){return this.Ti?[2,t(n)]:[2]}))}))},t(this.isPrimary)},t.prototype.Xa=function(t){var e=this;this.Wa.jn((function(n){return r.__awaiter(e,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},t.prototype.Za=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this._n.ds((function(){return r.__awaiter(e,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return this.Ti?[4,this.Ga()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},t.prototype.Ga=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(e){return lo(e).put(new Zi(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.tc(e).next((function(e){e||(t.isPrimary=!1,t._n.Ds((function(){return t.Ua(!1)})))}))})).next((function(){return t.ec(e)})).next((function(n){return t.isPrimary&&!n?t.nc(e).next((function(){return!1})):!!n&&t.sc(e).next((function(){return!0}))}))})).catch((function(e){if(_r(e))return y("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return y("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((function(e){t.isPrimary!==e&&t._n.Ds((function(){return t.Ua(e)})),t.isPrimary=e}))},t.prototype.tc=function(t){var e=this;return fo(t).get(Fi.key).next((function(t){return yr.resolve(e.ic(t))}))},t.prototype.rc=function(t){return lo(t).delete(this.clientId)},t.prototype.oc=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,n,i,o,s=this;return r.__generator(this,(function(r){switch(r.label){case 0:return!this.isPrimary||this.ac(this.qa,18e5)?[3,2]:(this.qa=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(e){var n=t.Un(e,Zi.store);return n.Zn().next((function(t){var e=s.cc(t,18e5),r=t.filter((function(t){return-1===e.indexOf(t)}));return yr.forEach(r,(function(t){return n.delete(t.clientId)})).next((function(){return r}))}))})).catch((function(){return[]}))]);case 1:if(e=r.sent(),this.Ka)for(n=0,i=e;n<i.length;n++)o=i[n],this.Ka.removeItem(this.uc(o.clientId));r.label=2;case 2:return[2]}}))}))},t.prototype.Ya=function(){var t=this;this.Ba=this._n.gn("client_metadata_refresh",4e3,(function(){return t.Ga().then((function(){return t.oc()})).then((function(){return t.Ya()}))}))},t.prototype.ic=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.ec=function(t){var e=this;return this.xa?yr.resolve(!0):fo(t).get(Fi.key).next((function(n){if(null!==n&&e.ac(n.leaseTimestampMs,5e3)&&!e.hc(n.ownerId)){if(e.ic(n)&&e.networkEnabled)return!0;if(!e.ic(n)){if(!n.allowTabSynchronization)throw new l(a.FAILED_PRECONDITION,ao);return!1}}return!(!e.networkEnabled||!e.inForeground)||lo(t).Zn().next((function(t){return void 0===e.cc(t,5e3).find((function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1}))}))})).next((function(t){return e.isPrimary!==t&&y("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},t.prototype.Si=function(){return r.__awaiter(this,void 0,void 0,(function(){var t=this;return r.__generator(this,(function(e){switch(e.label){case 0:return this.Ma=!1,this.lc(),this.Ba&&(this.Ba.cancel(),this.Ba=null),this._c(),this.fc(),[4,this.Wa.runTransaction("shutdown","readwrite",[Fi.store,Zi.store],(function(e){var n=new co(e,Fr.oi);return t.nc(n).next((function(){return t.rc(n)}))}))];case 1:return e.sent(),this.Wa.close(),this.dc(),[2]}}))}))},t.prototype.cc=function(t,e){var n=this;return t.filter((function(t){return n.ac(t.updateTimeMs,e)&&!n.hc(t.clientId)}))},t.prototype.Vi=function(){var t=this;return this.runTransaction("getActiveClients","readonly",(function(e){return lo(e).Zn().next((function(e){return t.cc(e,18e5).map((function(t){return t.clientId}))}))}))},Object.defineProperty(t.prototype,"Ti",{get:function(){return this.Ma},enumerable:!1,configurable:!0}),t.prototype.wc=function(t){return Ti.Fo(t,this.serializer,this.Sr,this.Co)},t.prototype.mc=function(){return this.ja},t.prototype.Tc=function(){return this.br},t.prototype.Ec=function(){return this.Sr},t.prototype.runTransaction=function(t,e,n){var r=this;y("IndexedDbPersistence","Starting transaction:",t);var i,o="readonly"===e?"readonly":"readwrite";return this.Wa.runTransaction(t,o,to,(function(o){return i=new co(o,r.ka?r.ka.next():Fr.oi),"readwrite-primary"===e?r.tc(i).next((function(t){return!!t||r.ec(i)})).next((function(e){if(!e)throw p("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r._n.Ds((function(){return r.Ua(!1)})),new l(a.FAILED_PRECONDITION,ti);return n(i)})).next((function(t){return r.sc(i).next((function(){return t}))})):r.Ic(i).next((function(){return n(i)}))})).then((function(t){return i.pr(),t}))},t.prototype.Ic=function(t){var e=this;return fo(t).get(Fi.key).next((function(t){if(null!==t&&e.ac(t.leaseTimestampMs,5e3)&&!e.hc(t.ownerId)&&!e.ic(t)&&!(e.xa||e.allowTabSynchronization&&t.allowTabSynchronization))throw new l(a.FAILED_PRECONDITION,ao)}))},t.prototype.sc=function(t){var e=new Fi(this.clientId,this.allowTabSynchronization,Date.now());return fo(t).put(Fi.key,e)},t.On=function(){return gr.On()},t.prototype.nc=function(t){var e=this,n=fo(t);return n.get(Fi.key).next((function(t){return e.ic(t)?(y("IndexedDbPersistence","Releasing primary lease."),n.delete(Fi.key)):yr.resolve()}))},t.prototype.ac=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(p("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.za=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.La=function(){t._n.ds((function(){return t.inForeground="visible"===t.document.visibilityState,t.Ga()}))},this.document.addEventListener("visibilitychange",this.La),this.inForeground="visible"===this.document.visibilityState)},t.prototype._c=function(){this.La&&(this.document.removeEventListener("visibilitychange",this.La),this.La=null)},t.prototype.Ha=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Oa=function(){e.lc(),e._n.ds((function(){return e.Si()}))},this.window.addEventListener("unload",this.Oa))},t.prototype.fc=function(){this.Oa&&(this.window.removeEventListener("unload",this.Oa),this.Oa=null)},t.prototype.hc=function(t){var e;try{var n=null!==(null===(e=this.Ka)||void 0===e?void 0:e.getItem(this.uc(t)));return y("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return p("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.lc=function(){if(this.Ka)try{this.Ka.setItem(this.uc(this.clientId),String(Date.now()))}catch(t){p("Failed to set zombie client id.",t)}},t.prototype.dc=function(){if(this.Ka)try{this.Ka.removeItem(this.uc(this.clientId))}catch(t){}},t.prototype.uc=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function fo(t){return ho.Un(t,Fi.store)}function lo(t){return ho.Un(t,Zi.store)}var po=function(){function t(t,e){this.db=t,this.do=new ci(this,e)}return t.prototype.Ro=function(t){var e=this.Ac(t);return this.db.mc().pa(t).next((function(t){return e.next((function(e){return t+e}))}))},t.prototype.Ac=function(t){var e=0;return this.yo(t,(function(t){e++})).next((function(){return e}))},t.prototype.De=function(t,e){return this.db.mc().De(t,e)},t.prototype.yo=function(t,e){return this.Rc(t,(function(t,n){return e(n)}))},t.prototype.Sa=function(t,e,n){return vo(t,n)},t.prototype.Ca=function(t,e,n){return vo(t,n)},t.prototype.Vo=function(t,e,n){return this.db.mc().Vo(t,e,n)},t.prototype.Ko=function(t,e){return vo(t,e)},t.prototype.Pc=function(t,e){return function(t,e){var n=!1;return Di(t).rs((function(r){return Ni(t,r,e).next((function(t){return t&&(n=!0),yr.resolve(!t)}))})).next((function(){return n}))}(t,e)},t.prototype.po=function(t,e){var n=this,r=this.db.Tc().ia(),i=[],o=0;return this.Rc(t,(function(s,u){if(u<=e){var a=n.Pc(t,s).next((function(e){if(!e)return o++,r.Ar(t,s).next((function(){return r.Ir(s),uo(t).delete([0,hi(s.path)])}))}));i.push(a)}})).next((function(){return yr.$n(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},t.prototype.removeTarget=function(t,e){var n=e.nt(t.Fa);return this.db.mc().ga(t,n)},t.prototype.gc=function(t,e){return vo(t,e)},t.prototype.Rc=function(t,e){var n,r=uo(t),i=Fr.oi;return r.ss({index:Xi.documentTargetsIndex},(function(t,r){var o=t[0],s=(t[1],r.path),u=r.sequenceNumber;0===o?(i!==Fr.oi&&e(new D(pi(n)),i),i=u,n=s):i=Fr.oi})).next((function(){i!==Fr.oi&&e(new D(pi(n)),i)}))},t.prototype.vo=function(t){return this.db.Tc().oa(t)},t}();function vo(t,e){return uo(t).put(function(t,e){return new Xi(0,hi(t.path),e)}(e,t.Fa))}function yo(t,e){var n=t.projectId;return t.W||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var go=function(){function t(t,e,n){this.persistence=t,this.yc=e,this.Vc=new Tt($),this.bc=new ut((function(t){return yt(t)}),gt),this.vc=ct.min(),this.vr=t.wc(n),this.Sc=t.Tc(),this.ja=t.mc(),this.Dc=new ni(this.Sc,this.vr,this.persistence.Ec()),this.yc.Cc(this.Dc)}return t.prototype.Eo=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return t.bo(n,e.Vc)}))},t}();function mo(t,e){var n=I(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(t){var r=e.batch.keys(),i=n.Sc.ia({ra:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),s=yr.resolve();return o.forEach((function(t){s=s.next((function(){return r.Ar(e,t)})).next((function(e){var o=e,s=n._r.get(t);g(null!==s),(!o||o.version.L(s)<0)&&(o=i.ar(t,o,n))&&r.Tr(o,n.lr)}))})),s.next((function(){return t.vr.Qo(e,i)}))}(n,t,e,i).next((function(){return i.apply(t)})).next((function(){return n.vr.Go(t)})).next((function(){return n.Dc.$r(t,r)}))}))}function wo(t){var e=I(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(function(t){return e.ja.Ta(t)}))}function bo(t,e){var n=I(t),r=e.et,i=n.Vc;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(t){var o=n.Sc.ia({ra:!0});i=n.Vc;var s=[];e.Gt.forEach((function(e,o){var u=i.get(o);if(u){s.push(n.ja.Da(t,e.ne,o).next((function(){return n.ja.va(t,e.te,o)})));var a=e.resumeToken;if(a.O()>0){var c=u.st(a,r).nt(t.Fa);i=i.rt(o,c),function(t,e,n){return g(e.resumeToken.O()>0),0===t.resumeToken.O()||e.et.J()-t.et.J()>=3e8||n.te.size+n.ee.size+n.ne.size>0}(u,c,e)&&s.push(n.ja.ga(t,c))}}}));var u=kt(),a=Vt();if(e.Ht.forEach((function(t,e){a=a.add(t)})),s.push(o.getEntries(t,a).next((function(i){e.Ht.forEach((function(a,c){var h=i.get(a);c instanceof Rn&&c.version.isEqual(ct.min())?(o.Ir(a,r),u=u.rt(a,c)):null==h||c.version.L(h.version)>0||0===c.version.L(h.version)&&h.hasPendingWrites?(o.Tr(c,r),u=u.rt(a,c)):y("LocalStore","Ignoring outdated watch update for ",a,". Current version:",h.version," Watch version:",c.version),e.Yt.has(a)&&s.push(n.persistence.Co.gc(t,a))}))}))),!r.isEqual(ct.min())){var c=n.ja.Ta(t).next((function(e){return n.ja.Ia(t,t.Fa,r)}));s.push(c)}return yr.$n(s).next((function(){return o.apply(t)})).next((function(){return n.Dc.kr(t,u)}))})).then((function(t){return n.Vc=i,t}))}function _o(t,e){var n=I(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(function(t){return void 0===e&&(e=-1),n.vr.Lo(t,e)}))}function Io(t,e){var n=I(t);return n.persistence.runTransaction("Allocate target","readwrite",(function(t){var r;return n.ja.ba(t,e).next((function(i){return i?(r=i,yr.resolve(r)):n.ja.da(t).next((function(i){return r=new bt(e,i,0,t.Fa),n.ja.Aa(t,r).next((function(){return r}))}))}))})).then((function(t){var r=n.Vc.get(t.targetId);return(null===r||t.et.L(r.et)>0)&&(n.Vc=n.Vc.rt(t.targetId,t),n.bc.set(e,t.targetId)),t}))}function Eo(t,e,n){return r.__awaiter(this,void 0,void 0,(function(){var i,o,s,u;return r.__generator(this,(function(r){switch(r.label){case 0:i=I(t),o=i.Vc.get(e),s=n?"readwrite":"readwrite-primary",r.label=1;case 1:return r.trys.push([1,4,,5]),n?[3,3]:[4,i.persistence.runTransaction("Release target",s,(function(t){return i.persistence.Co.removeTarget(t,o)}))];case 2:r.sent(),r.label=3;case 3:return[3,5];case 4:if(!_r(u=r.sent()))throw u;return y("LocalStore","Failed to update sequence numbers for target "+e+": "+u),[3,5];case 5:return i.Vc=i.Vc.remove(e),i.bc.delete(o.target),[2]}}))}))}function To(t,e,n){var r=I(t),i=ct.min(),o=Vt();return r.persistence.runTransaction("Execute query","readonly",(function(t){return function(t,e,n){var r=I(t),i=r.bc.get(n);return void 0!==i?yr.resolve(r.Vc.get(i)):r.ja.ba(e,n)}(r,t,Gn(e)).next((function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.ja.Na(t,e.targetId).next((function(t){o=t}))})).next((function(){return r.yc.Or(t,e,n?i:ct.min(),n?o:Vt())})).next((function(t){return{documents:t,Nc:o}}))}))}function No(t,e){var n=I(t),r=I(n.ja),i=n.Vc.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(function(t){return r.qe(t,e).next((function(t){return t?t.target:null}))}))}function Ao(t){var e=I(t);return e.persistence.runTransaction("Get new document changes","readonly",(function(t){return function(t,e,n){var r=I(t),i=kt(),o=gi(n),s=Li(e),u=IDBKeyRange.lowerBound(o,!0);return s.ss({index:Ki.readTimeIndex,range:u},(function(t,e){var n=vi(r.serializer,e);i=i.rt(n.key,n),o=e.readTime})).next((function(){return{Fc:i,readTime:mi(o)}}))}(e.Sc,t,e.vc)})).then((function(t){var n=t.Fc,r=t.readTime;return e.vc=r,n}))}function So(t){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(n){return[2,(e=I(t)).persistence.runTransaction("Synchronize last document change read time","readonly",(function(t){return function(t){var e=Li(t),n=ct.min();return e.ss({index:Ki.readTimeIndex,reverse:!0},(function(t,e,r){e.readTime&&(n=mi(e.readTime)),r.done()})).next((function(){return n}))}(t)})).then((function(t){e.vc=t}))]}))}))}function xo(t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){if(t.code!==a.FAILED_PRECONDITION||t.message!==ti)throw t;return y("LocalStore","Unexpectedly lost primary lease"),[2]}))}))}var Do=function(){function t(){this.$c=new St(ko.xc),this.kc=new St(ko.Mc)}return t.prototype.m=function(){return this.$c.m()},t.prototype.Sa=function(t,e){var n=new ko(t,e);this.$c=this.$c.add(n),this.kc=this.kc.add(n)},t.prototype.Oc=function(t,e){var n=this;t.forEach((function(t){return n.Sa(t,e)}))},t.prototype.Ca=function(t,e){this.Lc(new ko(t,e))},t.prototype.Bc=function(t,e){var n=this;t.forEach((function(t){return n.Ca(t,e)}))},t.prototype.qc=function(t){var e=this,n=new D(new A([])),r=new ko(n,t),i=new ko(n,t+1),o=[];return this.kc.Nt([r,i],(function(t){e.Lc(t),o.push(t.key)})),o},t.prototype.Uc=function(){var t=this;this.$c.forEach((function(e){return t.Lc(e)}))},t.prototype.Lc=function(t){this.$c=this.$c.delete(t),this.kc=this.kc.delete(t)},t.prototype.Qc=function(t){var e=new D(new A([])),n=new ko(e,t),r=new ko(e,t+1),i=Vt();return this.kc.Nt([n,r],(function(t){i=i.add(t.key)})),i},t.prototype.zo=function(t){var e=new ko(t,0),n=this.$c.$t(e);return null!==n&&t.isEqual(n.key)},t}(),ko=function(){function t(t,e){this.key=t,this.Wc=e}return t.xc=function(t,e){return D.i(t.key,e.key)||$(t.Wc,e.Wc)},t.Mc=function(t,e){return $(t.Wc,e.Wc)||D.i(t.key,e.key)},t}(),Oo=function(t,e){this.user=e,this.type="OAuth",this.jc={},this.jc.Authorization="Bearer "+t},Ro=function(){function t(){this.Kc=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.Gc=function(){},t.prototype.zc=function(t){this.Kc=t,t(jr.UNAUTHENTICATED)},t.prototype.Hc=function(){this.Kc=null},t}(),Lo=function(){function t(t){var e=this;this.Yc=null,this.currentUser=jr.UNAUTHENTICATED,this.Jc=!1,this.Xc=0,this.Kc=null,this.forceRefresh=!1,this.Yc=function(){e.Xc++,e.currentUser=e.Zc(),e.Jc=!0,e.Kc&&e.Kc(e.currentUser)},this.Xc=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.Yc):(this.Yc(null),t.get().then((function(t){e.auth=t,e.Yc&&e.auth.addAuthTokenListener(e.Yc)}),(function(){})))}return t.prototype.getToken=function(){var t=this,e=this.Xc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return t.Xc!==e?(y("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(g("string"==typeof n.accessToken),new Oo(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},t.prototype.Gc=function(){this.forceRefresh=!0},t.prototype.zc=function(t){this.Kc=t,this.Jc&&t(this.currentUser)},t.prototype.Hc=function(){this.auth&&this.auth.removeAuthTokenListener(this.Yc),this.Yc=null,this.Kc=null},t.prototype.Zc=function(){var t=this.auth&&this.auth.getUid();return g(null===t||"string"==typeof t),new jr(t)},t}(),Co=function(){function t(t,e){this.tu=t,this.eu=e,this.type="FirstParty",this.user=jr.ei}return Object.defineProperty(t.prototype,"jc",{get:function(){var t={"X-Goog-AuthUser":this.eu},e=this.tu.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),t}(),Po=function(){function t(t,e){this.tu=t,this.eu=e}return t.prototype.getToken=function(){return Promise.resolve(new Co(this.tu,this.eu))},t.prototype.zc=function(t){t(jr.ei)},t.prototype.Hc=function(){},t.prototype.Gc=function(){},t}(),Vo=function(){function t(t,e,n,r,i,o){this._n=t,this.nu=n,this.su=r,this.iu=i,this.listener=o,this.state=0,this.ru=0,this.ou=null,this.stream=null,this.gs=new vr(t,e)}return t.prototype.au=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.cu=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.uu()},t.prototype.stop=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return this.au()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.hu=function(){this.state=0,this.gs.reset()},t.prototype.lu=function(){var t=this;this.cu()&&null===this.ou&&(this.ou=this._n.gn(this.nu,6e4,(function(){return t._u()})))},t.prototype.fu=function(t){this.du(),this.stream.send(t)},t.prototype._u=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){return this.cu()?[2,this.close(0)]:[2]}))}))},t.prototype.du=function(){this.ou&&(this.ou.cancel(),this.ou=null)},t.prototype.close=function(t,e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(n){switch(n.label){case 0:return this.du(),this.gs.cancel(),this.ru++,3!==t?this.gs.reset():e&&e.code===a.RESOURCE_EXHAUSTED?(p(e.toString()),p("Using maximum backoff delay to prevent overloading the backend."),this.gs.An()):e&&e.code===a.UNAUTHENTICATED&&this.iu.Gc(),null!==this.stream&&(this.wu(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.mu(e)];case 1:return n.sent(),[2]}}))}))},t.prototype.wu=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.Tu(this.ru),n=this.ru;this.iu.getToken().then((function(e){t.ru===n&&t.Eu(e)}),(function(n){e((function(){var e=new l(a.UNKNOWN,"Fetching auth token failed: "+n.message);return t.Iu(e)}))}))},t.prototype.Eu=function(t){var e=this,n=this.Tu(this.ru);this.stream=this.Au(t),this.stream.Ru((function(){n((function(){return e.state=2,e.listener.Ru()}))})),this.stream.mu((function(t){n((function(){return e.Iu(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},t.prototype.uu=function(){var t=this;this.state=4,this.gs.Rn((function(){return r.__awaiter(t,void 0,void 0,(function(){return r.__generator(this,(function(t){return this.state=0,this.start(),[2]}))}))}))},t.prototype.Iu=function(t){return y("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.Tu=function(t){var e=this;return function(n){e._n.ds((function(){return e.ru===t?n():(y("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},t}(),Uo=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).serializer=i,s}return r.__extends(e,t),e.prototype.Au=function(t){return this.su.Pu("Listen",t)},e.prototype.onMessage=function(t){this.gs.reset();var e=function(t,e){var n;if("targetChange"in e){e.targetChange;var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:_()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.Ue?(g(void 0===e||"string"==typeof e),tt.fromBase64String(e||"")):(g(void 0===e||e instanceof Uint8Array),tt.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=e.targetChange.cause,u=s&&function(t){var e=void 0===t.code?a.UNKNOWN:Et(t.code);return new l(e,t.message||"")}(s);n=new Kt(r,i,o,u||null)}else if("documentChange"in e){e.documentChange;var c=e.documentChange;c.document,c.document.name,c.document.updateTime;var h=xe(t,c.document.name),f=Te(c.document.updateTime),p=new Sn({mapValue:{fields:c.document.fields}}),d=new On(h,f,p,{}),v=c.targetIds||[],y=c.removedTargetIds||[];n=new zt(v,y,d.key,d)}else if("documentDelete"in e){e.documentDelete;var m=e.documentDelete;m.document;var w=xe(t,m.document),b=m.readTime?Te(m.readTime):ct.min(),I=new Rn(w,b),E=m.removedTargetIds||[];n=new zt([],E,I.key,I)}else if("documentRemove"in e){e.documentRemove;var T=e.documentRemove;T.document;var N=xe(t,T.document),A=T.removedTargetIds||[];n=new zt([],A,N,null)}else{if(!("filter"in e))return _();e.filter;var S=e.filter;S.targetId;var x=S.count||0,D=new _t(x),k=S.targetId;n=new Wt(k,D)}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return ct.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?ct.min():e.readTime?Te(e.readTime):ct.min()}(t);return this.listener.gu(e,n)},e.prototype.yu=function(t){var e={};e.database=Oe(this.serializer),e.addTarget=function(t,e){var n,r=e.target;return(n=dt(r)?{documents:Ve(t,r)}:{query:Ue(t,r)}).targetId=e.targetId,e.resumeToken.O()>0&&(n.resumeToken=Ie(t,e.resumeToken)),n}(this.serializer,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return _()}}(0,e.tt);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.fu(e)},e.prototype.Vu=function(t){var e={};e.database=Oe(this.serializer),e.removeTarget=t,this.fu(e)},e}(Vo),Mo=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).serializer=i,s.pu=!1,s}return r.__extends(e,t),Object.defineProperty(e.prototype,"bu",{get:function(){return this.pu},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.pu=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.wu=function(){this.pu&&this.vu([])},e.prototype.Au=function(t){return this.su.Pu("Write",t)},e.prototype.onMessage=function(t){if(g(!!t.streamToken),this.lastStreamToken=t.streamToken,this.pu){this.gs.reset();var e=function(t,e){return t&&t.length>0?(g(void 0!==e),t.map((function(t){return function(t,e){var n=t.updateTime?Te(t.updateTime):Te(e);n.isEqual(ct.min())&&(n=Te(e));var r=null;return t.transformResults&&t.transformResults.length>0&&(r=t.transformResults),new hn(n,r)}(t,e)}))):[]}(t.writeResults,t.commitTime),n=Te(t.commitTime);return this.listener.Su(n,e)}return g(!t.writeResults||0===t.writeResults.length),this.pu=!0,this.listener.Du()},e.prototype.Cu=function(){var t={};t.database=Oe(this.serializer),this.fu(t)},e.prototype.vu=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map((function(t){return Ce(e.serializer,t)}))};this.fu(n)},e}(Vo),jo=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.su=n,i.serializer=r,i.Nu=!1,i}return r.__extends(e,t),e.prototype.Fu=function(){if(this.Nu)throw new l(a.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.$u=function(t,e,n){var r=this;return this.Fu(),this.credentials.getToken().then((function(i){return r.su.$u(t,e,n,i)})).catch((function(t){throw t.code===a.UNAUTHENTICATED&&r.credentials.Gc(),t}))},e.prototype.xu=function(t,e,n){var r=this;return this.Fu(),this.credentials.getToken().then((function(i){return r.su.xu(t,e,n,i)})).catch((function(t){throw t.code===a.UNAUTHENTICATED&&r.credentials.Gc(),t}))},e.prototype.terminate=function(){this.Nu=!1},e}((function(){})),Fo=function(){function t(t,e){this.os=t,this.fi=e,this.state="Unknown",this.ku=0,this.Mu=null,this.Ou=!0}return t.prototype.Lu=function(){var t=this;0===this.ku&&(this.Bu("Unknown"),this.Mu=this.os.gn("online_state_timeout",1e4,(function(){return t.Mu=null,t.qu("Backend didn't respond within 10 seconds."),t.Bu("Offline"),Promise.resolve()})))},t.prototype.Uu=function(t){"Online"===this.state?this.Bu("Unknown"):(this.ku++,this.ku>=1&&(this.Qu(),this.qu("Connection failed 1 times. Most recent error: "+t.toString()),this.Bu("Offline")))},t.prototype.set=function(t){this.Qu(),this.ku=0,"Online"===t&&(this.Ou=!1),this.Bu(t)},t.prototype.Bu=function(t){t!==this.state&&(this.state=t,this.fi(t))},t.prototype.qu=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Ou?(p(e),this.Ou=!1):y("OnlineStateTracker",e)},t.prototype.Qu=function(){null!==this.Mu&&(this.Mu.cancel(),this.Mu=null)},t}(),qo=function(t,e,n,i,o){var s=this;this.Wu=t,this.ju=e,this.os=n,this.Ku={},this.Gu=[],this.zu=new Map,this.Hu=new Set,this.Yu=[],this.Ju=o,this.Ju.Xu((function(t){n.ds((function(){return r.__awaiter(s,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return $o(this)?(y("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(n){switch(n.label){case 0:return(e=I(t)).Hu.add(4),[4,Go(e)];case 1:return n.sent(),e.Zu.set("Unknown"),e.Hu.delete(4),[4,Bo(e)];case 2:return n.sent(),[2]}}))}))}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.Zu=new Fo(n,i)};function Bo(t){return r.__awaiter(this,void 0,void 0,(function(){var e,n;return r.__generator(this,(function(r){switch(r.label){case 0:if(!$o(t))return[3,4];e=0,n=t.Yu,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function Go(t){return r.__awaiter(this,void 0,void 0,(function(){var e,n;return r.__generator(this,(function(r){switch(r.label){case 0:e=0,n=t.Yu,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function zo(t){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(n){switch(n.label){case 0:return e=I(t),y("RemoteStore","RemoteStore shutting down."),e.Hu.add(5),[4,Go(e)];case 1:return n.sent(),e.Ju.Si(),e.Zu.set("Unknown"),[2]}}))}))}function Wo(t,e){var n=I(t);n.zu.has(e.targetId)||(n.zu.set(e.targetId,e),Yo(n)?Xo(n):ls(n).cu()&&Qo(n,e))}function Ko(t,e){var n=I(t),r=ls(n);n.zu.delete(e),r.cu()&&Ho(n,e),0===n.zu.size&&(r.cu()?r.lu():$o(n)&&n.Zu.set("Unknown"))}function Qo(t,e){t.th.Ee(e.targetId),ls(t).yu(e)}function Ho(t,e){t.th.Ee(e),ls(t).Vu(e)}function Xo(t){t.th=new Ht({Be:function(e){return t.Ku.Be(e)},qe:function(e){return t.zu.get(e)||null}}),ls(t).start(),t.Zu.Lu()}function Yo(t){return $o(t)&&!ls(t).au()&&t.zu.size>0}function $o(t){return 0===I(t).Hu.size}function Jo(t){t.th=void 0}function Zo(t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return t.zu.forEach((function(e,n){Qo(t,e)})),[2]}))}))}function ts(t,e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(n){return Jo(t),Yo(t)?(t.Zu.Uu(e),Xo(t)):t.Zu.set("Unknown"),[2]}))}))}function es(t,e,n){return r.__awaiter(this,void 0,void 0,(function(){var i,o,s;return r.__generator(this,(function(u){switch(u.label){case 0:if(t.Zu.set("Online"),!(e instanceof Kt&&2===e.state&&e.cause))return[3,6];u.label=1;case 1:return u.trys.push([1,3,,5]),[4,function(t,e){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o,s;return r.__generator(this,(function(r){switch(r.label){case 0:n=e.cause,i=0,o=e.targetIds,r.label=1;case 1:return i<o.length?(s=o[i],t.zu.has(s)?[4,t.Ku.eh(s,n)]:[3,3]):[3,5];case 2:r.sent(),t.zu.delete(s),t.th.removeTarget(s),r.label=3;case 3:r.label=4;case 4:return i++,[3,1];case 5:return[2]}}))}))}(t,e)];case 2:return u.sent(),[3,5];case 3:return i=u.sent(),y("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),i),[4,ns(t,i)];case 4:return u.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof zt?t.th.pe(e):e instanceof Wt?t.th.$e(e):t.th.Se(e),n.isEqual(ct.min()))return[3,13];u.label=7;case 7:return u.trys.push([7,11,,13]),[4,wo(t.Wu)];case 8:return o=u.sent(),n.L(o)>=0?[4,function(t,e){var n=t.th.Me(e);return n.Gt.forEach((function(n,r){if(n.resumeToken.O()>0){var i=t.zu.get(r);i&&t.zu.set(r,i.st(n.resumeToken,e))}})),n.zt.forEach((function(e){var n=t.zu.get(e);if(n){t.zu.set(e,n.st(tt.B,n.et)),Ho(t,e);var r=new bt(n.target,e,1,n.sequenceNumber);Qo(t,r)}})),t.Ku.nh(n)}(t,n)]:[3,10];case 9:u.sent(),u.label=10;case 10:return[3,13];case 11:return y("RemoteStore","Failed to raise snapshot:",s=u.sent()),[4,ns(t,s)];case 12:return u.sent(),[3,13];case 13:return[2]}}))}))}function ns(t,e,n){return r.__awaiter(this,void 0,void 0,(function(){var i=this;return r.__generator(this,(function(o){switch(o.label){case 0:if(!_r(e))throw e;return t.Hu.add(1),[4,Go(t)];case 1:return o.sent(),t.Zu.set("Offline"),n||(n=function(){return wo(t.Wu)}),t.os.Ds((function(){return r.__awaiter(i,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return y("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.Hu.delete(1),[4,Bo(t)];case 2:return e.sent(),[2]}}))}))})),[2]}}))}))}function rs(t,e){return e().catch((function(n){return ns(t,n,e)}))}function is(t){return r.__awaiter(this,void 0,void 0,(function(){var e,n,i,o,s;return r.__generator(this,(function(r){switch(r.label){case 0:e=I(t),n=ps(e),i=e.Gu.length>0?e.Gu[e.Gu.length-1].batchId:-1,r.label=1;case 1:if(!function(t){return $o(t)&&t.Gu.length<10}(e))return[3,7];r.label=2;case 2:return r.trys.push([2,4,,6]),[4,_o(e.Wu,i)];case 3:return null===(o=r.sent())?(0===e.Gu.length&&n.lu(),[3,7]):(i=o.batchId,function(t,e){t.Gu.push(e);var n=ps(t);n.cu()&&n.bu&&n.vu(e.mutations)}(e,o),[3,6]);case 4:return s=r.sent(),[4,ns(e,s)];case 5:return r.sent(),[3,6];case 6:return[3,1];case 7:return os(e)&&ss(e),[2]}}))}))}function os(t){return $o(t)&&!ps(t).au()&&t.Gu.length>0}function ss(t){ps(t).start()}function us(t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return ps(t).Cu(),[2]}))}))}function as(t){return r.__awaiter(this,void 0,void 0,(function(){var e,n,i,o;return r.__generator(this,(function(r){for(e=ps(t),n=0,i=t.Gu;n<i.length;n++)o=i[n],e.vu(o.mutations);return[2]}))}))}function cs(t,e,n){return r.__awaiter(this,void 0,void 0,(function(){var i,o;return r.__generator(this,(function(r){switch(r.label){case 0:return i=t.Gu.shift(),o=Jr.from(i,e,n),[4,rs(t,(function(){return t.Ku.sh(o)}))];case 1:return r.sent(),[4,is(t)];case 2:return r.sent(),[2]}}))}))}function hs(t,e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(n){switch(n.label){case 0:return e&&ps(t).bu?[4,function(t,e){return r.__awaiter(this,void 0,void 0,(function(){var n,i;return r.__generator(this,(function(r){switch(r.label){case 0:return It(i=e.code)&&i!==a.ABORTED?(n=t.Gu.shift(),ps(t).hu(),[4,rs(t,(function(){return t.Ku.ih(n.batchId,e)}))]):[3,3];case 1:return r.sent(),[4,is(t)];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return os(t)&&ss(t),[2]}}))}))}function fs(t,e){return r.__awaiter(this,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){switch(r.label){case 0:return n=I(t),e?(n.Hu.delete(2),[4,Bo(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.Hu.add(2),[4,Go(n)]);case 3:r.sent(),n.Zu.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}}))}))}function ls(t){var e=this;return t.rh||(t.rh=function(t,e,n){var r=I(t);return r.Fu(),new Uo(e,r.su,r.credentials,r.serializer,n)}(t.ju,t.os,{Ru:Zo.bind(null,t),mu:ts.bind(null,t),gu:es.bind(null,t)}),t.Yu.push((function(n){return r.__awaiter(e,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return n?(t.rh.hu(),Yo(t)?Xo(t):t.Zu.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.rh.stop()];case 2:e.sent(),Jo(t),e.label=3;case 3:return[2]}}))}))}))),t.rh}function ps(t){var e=this;return t.oh||(t.oh=function(t,e,n){var r=I(t);return r.Fu(),new Mo(e,r.su,r.credentials,r.serializer,n)}(t.ju,t.os,{Ru:us.bind(null,t),mu:hs.bind(null,t),Du:as.bind(null,t),Su:cs.bind(null,t)}),t.Yu.push((function(n){return r.__awaiter(e,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return n?(t.oh.hu(),[4,is(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.oh.stop()];case 3:e.sent(),t.Gu.length>0&&(y("RemoteStore","Stopping write stream with "+t.Gu.length+" pending writes"),t.Gu=[]),e.label=4;case 4:return[2]}}))}))}))),t.oh}var ds=function(t){this.key=t},vs=function(t){this.key=t},ys=function(){function t(t,e){this.query=t,this.ah=e,this.uh=null,this.Zt=!1,this.hh=Vt(),this.Qt=Vt(),this.lh=$n(t),this._h=new jt(this.lh)}return Object.defineProperty(t.prototype,"fh",{get:function(){return this.ah},enumerable:!1,configurable:!0}),t.prototype.dh=function(t,e){var n=this,r=e?e.wh:new Ft,i=e?e._h:this._h,o=e?e.Qt:this.Qt,s=i,u=!1,a=Un(this.query)&&i.size===this.query.limit?i.last():null,c=Mn(this.query)&&i.size===this.query.limit?i.first():null;if(t.ut((function(t,e){var h=i.get(t),f=e instanceof On?e:null;f&&(f=Yn(n.query,f)?f:null);var l=!!h&&n.Qt.has(h.key),p=!!f&&(f.Ye||n.Qt.has(f.key)&&f.hasCommittedMutations),d=!1;h&&f?h.data().isEqual(f.data())?l!==p&&(r.track({type:3,doc:f}),d=!0):n.mh(h,f)||(r.track({type:2,doc:f}),d=!0,(a&&n.lh(f,a)>0||c&&n.lh(f,c)<0)&&(u=!0)):!h&&f?(r.track({type:0,doc:f}),d=!0):h&&!f&&(r.track({type:1,doc:h}),d=!0,(a||c)&&(u=!0)),d&&(f?(s=s.add(f),o=p?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))})),Un(this.query)||Mn(this.query))for(;s.size>this.query.limit;){var h=Un(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{_h:s,wh:r,Th:u,Qt:o}},t.prototype.mh=function(t,e){return t.Ye&&e.hasCommittedMutations&&!e.Ye},t.prototype.gr=function(t,e,n){var r=this,i=this._h;this._h=t._h,this.Qt=t.Qt;var o=t.wh.qt();o.sort((function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return _()}};return n(t)-n(e)}(t.type,e.type)||r.lh(t.doc,e.doc)})),this.Eh(n);var s=e?this.Ih():[],u=0===this.hh.size&&this.Zt?1:0,a=u!==this.uh;return this.uh=u,0!==o.length||a?{snapshot:new qt(this.query,t._h,i,o,t.Qt,0===u,a,!1),Ah:s}:{Ah:s}},t.prototype.Us=function(t){return this.Zt&&"Offline"===t?(this.Zt=!1,this.gr({_h:this._h,wh:new Ft,Qt:this.Qt,Th:!1},!1)):{Ah:[]}},t.prototype.Rh=function(t){return!this.ah.has(t)&&!!this._h.has(t)&&!this._h.get(t).Ye},t.prototype.Eh=function(t){var e=this;t&&(t.te.forEach((function(t){return e.ah=e.ah.add(t)})),t.ee.forEach((function(t){})),t.ne.forEach((function(t){return e.ah=e.ah.delete(t)})),this.Zt=t.Zt)},t.prototype.Ih=function(){var t=this;if(!this.Zt)return[];var e=this.hh;this.hh=Vt(),this._h.forEach((function(e){t.Rh(e.key)&&(t.hh=t.hh.add(e.key))}));var n=[];return e.forEach((function(e){t.hh.has(e)||n.push(new vs(e))})),this.hh.forEach((function(t){e.has(t)||n.push(new ds(t))})),n},t.prototype.Ph=function(t){this.ah=t.Nc,this.hh=Vt();var e=this.dh(t.documents);return this.gr(e,!0)},t.prototype.gh=function(){return qt.Kt(this.query,this._h,this.Qt,0===this.uh)},t}(),gs=function(t,e,n){this.query=t,this.targetId=e,this.view=n},ms=function(t){this.key=t,this.yh=!1},ws=function(){function t(t,e,n,r,i,o){this.Wu=t,this.Vh=e,this.ph=n,this.bh=r,this.currentUser=i,this.Sh=o,this.Dh={},this.Ch=new ut((function(t){return Hn(t)}),Qn),this.Nh=new Map,this.Fh=[],this.$h=new Tt(D.i),this.xh=new Map,this.kh=new Do,this.Mh={},this.Oh=new Map,this.Lh=ro.fa(),this.onlineState="Unknown",this.Bh=void 0}return Object.defineProperty(t.prototype,"qh",{get:function(){return!0===this.Bh},enumerable:!1,configurable:!0}),t}();function bs(t,e){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o,s,u,a;return r.__generator(this,(function(r){switch(r.label){case 0:return n=Ks(t),(s=n.Ch.get(e))?(i=s.targetId,n.bh.Mi(i),o=s.view.gh(),[3,4]):[3,1];case 1:return[4,Io(n.Wu,Gn(e))];case 2:return u=r.sent(),a=n.bh.Mi(u.targetId),i=u.targetId,[4,_s(n,e,i,"current"===a)];case 3:o=r.sent(),n.qh&&Wo(n.Vh,u),r.label=4;case 4:return[2,o]}}))}))}function _s(t,e,n,i){return r.__awaiter(this,void 0,void 0,(function(){var o,s,u,a,c,h;return r.__generator(this,(function(f){switch(f.label){case 0:return t.Uh=function(e,n,i){return function(t,e,n,i){return r.__awaiter(this,void 0,void 0,(function(){var o,s,u;return r.__generator(this,(function(r){switch(r.label){case 0:return(o=e.view.dh(n)).Th?[4,To(t.Wu,e.query,!1).then((function(t){var n=t.documents;return e.view.dh(n,o)}))]:[3,2];case 1:o=r.sent(),r.label=2;case 2:return s=i&&i.Gt.get(e.targetId),u=e.view.gr(o,t.qh,s),[2,(Rs(t,e.targetId,u.Ah),u.snapshot)]}}))}))}(t,e,n,i)},[4,To(t.Wu,e,!0)];case 1:return o=f.sent(),s=new ys(e,o.Nc),u=s.dh(o.documents),a=Gt.Xt(n,i&&"Offline"!==t.onlineState),c=s.gr(u,t.qh,a),Rs(t,n,c.Ah),h=new gs(e,n,s),[2,(t.Ch.set(e,h),t.Nh.has(n)?t.Nh.get(n).push(e):t.Nh.set(n,[e]),c.snapshot)]}}))}))}function Is(t,e){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o;return r.__generator(this,(function(r){switch(r.label){case 0:return n=I(t),i=n.Ch.get(e),(o=n.Nh.get(i.targetId)).length>1?[2,(n.Nh.set(i.targetId,o.filter((function(t){return!Qn(t,e)}))),void n.Ch.delete(e))]:n.qh?(n.bh.Li(i.targetId),n.bh.Ni(i.targetId)?[3,2]:[4,Eo(n.Wu,i.targetId,!1).then((function(){n.bh.qi(i.targetId),Ko(n.Vh,i.targetId),ks(n,i.targetId)})).catch(xo)]):[3,3];case 1:r.sent(),r.label=2;case 2:return[3,5];case 3:return ks(n,i.targetId),[4,Eo(n.Wu,i.targetId,!0)];case 4:r.sent(),r.label=5;case 5:return[2]}}))}))}function Es(t,e){return r.__awaiter(this,void 0,void 0,(function(){var n,i;return r.__generator(this,(function(r){switch(r.label){case 0:n=I(t),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,bo(n.Wu,e)];case 2:return i=r.sent(),e.Gt.forEach((function(t,e){var r=n.xh.get(e);r&&(g(t.te.size+t.ee.size+t.ne.size<=1),t.te.size>0?r.yh=!0:t.ee.size>0?g(r.yh):t.ne.size>0&&(g(r.yh),r.yh=!1))})),[4,Ps(n,i,e)];case 3:return r.sent(),[3,6];case 4:return[4,xo(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))}function Ts(t,e,n){var r=I(t);if(r.qh&&0===n||!r.qh&&1===n){var i=[];r.Ch.forEach((function(t,n){var r=n.view.Us(e);r.snapshot&&i.push(r.snapshot)})),function(t,e){var n=I(t);n.onlineState=e;var r=!1;n.Ls.forEach((function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].Us(e)&&(r=!0)})),r&&Ur(n)}(r.ph,e),i.length&&r.Dh.gu(i),r.onlineState=e,r.qh&&r.bh.ji(e)}}function Ns(t,e,n){return r.__awaiter(this,void 0,void 0,(function(){var i,o,s,u,a,c;return r.__generator(this,(function(r){switch(r.label){case 0:return(i=I(t)).bh.Ui(e,"rejected",n),o=i.xh.get(e),(s=o&&o.key)?(u=(u=new Tt(D.i)).rt(s,new Rn(s,ct.min())),a=Vt().add(s),c=new Bt(ct.min(),new Map,new St($),u,a),[4,Es(i,c)]):[3,2];case 1:return r.sent(),i.$h=i.$h.remove(s),i.xh.delete(e),Cs(i),[3,4];case 2:return[4,Eo(i.Wu,e,!1).then((function(){return ks(i,e,n)})).catch(xo)];case 3:r.sent(),r.label=4;case 4:return[2]}}))}))}function As(t,e){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o;return r.__generator(this,(function(r){switch(r.label){case 0:n=I(t),i=e.batch.batchId,r.label=1;case 1:return r.trys.push([1,4,,6]),[4,mo(n.Wu,e)];case 2:return o=r.sent(),Ds(n,i,null),xs(n,i),n.bh.xi(i,"acknowledged"),[4,Ps(n,o)];case 3:return r.sent(),[3,6];case 4:return[4,xo(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))}function Ss(t,e,n){return r.__awaiter(this,void 0,void 0,(function(){var i,o;return r.__generator(this,(function(r){switch(r.label){case 0:i=I(t),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,function(t,e){var n=I(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(function(t){var r;return n.vr.Mo(t,e).next((function(e){return g(null!==e),r=e.keys(),n.vr.Qo(t,e)})).next((function(){return n.vr.Go(t)})).next((function(){return n.Dc.$r(t,r)}))}))}(i.Wu,e)];case 2:return o=r.sent(),Ds(i,e,n),xs(i,e),i.bh.xi(e,"rejected",n),[4,Ps(i,o)];case 3:return r.sent(),[3,6];case 4:return[4,xo(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))}function xs(t,e){(t.Oh.get(e)||[]).forEach((function(t){t.resolve()})),t.Oh.delete(e)}function Ds(t,e,n){var r=I(t),i=r.Mh[r.currentUser.Zs()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.Mh[r.currentUser.Zs()]=i}}function ks(t,e,n){void 0===n&&(n=null),t.bh.Li(e);for(var r=0,i=t.Nh.get(e);r<i.length;r++){var o=i[r];t.Ch.delete(o),n&&t.Dh.Qh(o,n)}t.Nh.delete(e),t.qh&&t.kh.qc(e).forEach((function(e){t.kh.zo(e)||Os(t,e)}))}function Os(t,e){var n=t.$h.get(e);null!==n&&(Ko(t.Vh,n),t.$h=t.$h.remove(e),t.xh.delete(n),Cs(t))}function Rs(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof ds?(t.kh.Sa(o.key,e),Ls(t,o)):o instanceof vs?(y("SyncEngine","Document no longer in limbo: "+o.key),t.kh.Ca(o.key,e),t.kh.zo(o.key)||Os(t,o.key)):_()}}function Ls(t,e){var n=e.key;t.$h.get(n)||(y("SyncEngine","New document in limbo: "+n),t.Fh.push(n),Cs(t))}function Cs(t){for(;t.Fh.length>0&&t.$h.size<t.Sh;){var e=t.Fh.shift(),n=t.Lh.next();t.xh.set(n,new ms(e)),t.$h=t.$h.rt(e,n),Wo(t.Vh,new bt(Gn(Vn(e.path)),n,2,Fr.oi))}}function Ps(t,e,n){return r.__awaiter(this,void 0,void 0,(function(){var i,o,s,u;return r.__generator(this,(function(a){switch(a.label){case 0:return i=I(t),o=[],s=[],u=[],i.Ch.m()?[3,3]:(i.Ch.forEach((function(t,r){u.push(i.Uh(r,e,n).then((function(t){if(t){i.qh&&i.bh.Ui(r.targetId,t.fromCache?"not-current":"current"),o.push(t);var e=ri.Gr(r.targetId,t);s.push(e)}})))})),[4,Promise.all(u)]);case 1:return a.sent(),i.Dh.gu(o),[4,function(t,e){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o,s,u,a,c,h,f;return r.__generator(this,(function(r){switch(r.label){case 0:n=I(t),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(t){return yr.forEach(e,(function(e){return yr.forEach(e.jr,(function(r){return n.persistence.Co.Sa(t,e.targetId,r)})).next((function(){return yr.forEach(e.Kr,(function(r){return n.persistence.Co.Ca(t,e.targetId,r)}))}))}))}))];case 2:return r.sent(),[3,4];case 3:if(!_r(i=r.sent()))throw i;return y("LocalStore","Failed to update sequence numbers: "+i),[3,4];case 4:for(o=0,s=e;o<s.length;o++)u=s[o],a=u.targetId,u.fromCache||(c=n.Vc.get(a),h=c.et,f=c.it(h),n.Vc=n.Vc.rt(a,f));return[2]}}))}))}(i.Wu,s)];case 2:a.sent(),a.label=3;case 3:return[2]}}))}))}function Vs(t,e){return r.__awaiter(this,void 0,void 0,(function(){var n,i;return r.__generator(this,(function(o){switch(o.label){case 0:return(n=I(t)).currentUser.isEqual(e)?[3,3]:(y("SyncEngine","User change. New user:",e.Zs()),[4,function(t,e){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o,s;return r.__generator(this,(function(r){switch(r.label){case 0:return n=I(t),i=n.vr,o=n.Dc,[4,n.persistence.runTransaction("Handle user change","readonly",(function(t){var r;return n.vr.qo(t).next((function(s){return r=s,i=n.persistence.wc(e),o=new ni(n.Sc,i,n.persistence.Ec()),i.qo(t)})).next((function(e){for(var n=[],i=[],s=Vt(),u=0,a=r;u<a.length;u++){var c=a[u];n.push(c.batchId);for(var h=0,f=c.mutations;h<f.length;h++){var l=f[h];s=s.add(l.key)}}for(var p=0,d=e;p<d.length;p++){var v=d[p];i.push(v.batchId);for(var y=0,g=v.mutations;y<g.length;y++){var m=g[y];s=s.add(m.key)}}return o.$r(t,s).next((function(t){return{Wh:t,jh:n,Kh:i}}))}))}))];case 1:return s=r.sent(),[2,(n.vr=i,n.Dc=o,n.yc.Cc(n.Dc),s)]}}))}))}(n.Wu,e)]);case 1:return i=o.sent(),n.currentUser=e,function(t,e){t.Oh.forEach((function(t){t.forEach((function(t){t.reject(new l(a.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.Oh.clear()}(n),n.bh.Wi(e,i.jh,i.Kh),[4,Ps(n,i.Wh)];case 2:o.sent(),o.label=3;case 3:return[2]}}))}))}function Us(t,e){var n=I(t),r=n.xh.get(e);if(r&&r.yh)return Vt().add(r.key);var i=Vt(),o=n.Nh.get(e);if(!o)return i;for(var s=0,u=o;s<u.length;s++){var a=u[s],c=n.Ch.get(a);i=i.xt(c.view.fh)}return i}function Ms(t,e){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,To((n=I(t)).Wu,e.query,!0)];case 1:return i=r.sent(),o=e.view.Ph(i),[2,(n.qh&&Rs(n,e.targetId,o.Ah),o)]}}))}))}function js(t,e,n,i){return r.__awaiter(this,void 0,void 0,(function(){var o,s;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,function(t,e){var n=I(t),r=I(n.vr);return n.persistence.runTransaction("Lookup mutation documents","readonly",(function(t){return r.Oo(t,e).next((function(e){return e?n.Dc.$r(t,e):yr.resolve(null)}))}))}((o=I(t)).Wu,e)];case 1:return null===(s=r.sent())?[3,6]:"pending"!==n?[3,3]:[4,is(o.Vh)];case 2:return r.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(Ds(o,e,i||null),xs(o,e),function(t,e){I(I(t).vr).jo(e)}(o.Wu,e)):_(),r.label=4;case 4:return[4,Ps(o,s)];case 5:return r.sent(),[3,7];case 6:y("SyncEngine","Cannot apply mutation batch with id: "+e),r.label=7;case 7:return[2]}}))}))}function Fs(t,e){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o,s,u,a,c,h;return r.__generator(this,(function(r){switch(r.label){case 0:return Ks(n=I(t)),Qs(n),!0!==e||!0===n.Bh?[3,3]:(i=n.bh.Di(),[4,qs(n,i.A())]);case 1:return o=r.sent(),n.Bh=!0,[4,fs(n.Vh,!0)];case 2:for(r.sent(),s=0,u=o;s<u.length;s++)a=u[s],Wo(n.Vh,a);return[3,7];case 3:return!1!==e||!1===n.Bh?[3,7]:(c=[],h=Promise.resolve(),n.Nh.forEach((function(t,e){n.bh.Bi(e)?c.push(e):h=h.then((function(){return ks(n,e),Eo(n.Wu,e,!0)})),Ko(n.Vh,e)})),[4,h]);case 4:return r.sent(),[4,qs(n,c)];case 5:return r.sent(),function(t){var e=I(t);e.xh.forEach((function(t,n){Ko(e.Vh,n)})),e.kh.Uc(),e.xh=new Map,e.$h=new Tt(D.i)}(n),n.Bh=!1,[4,fs(n.Vh,!1)];case 6:r.sent(),r.label=7;case 7:return[2]}}))}))}function qs(t,e,n){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o,s,u,a,c,h,f,l,p,d,v,y;return r.__generator(this,(function(r){switch(r.label){case 0:n=I(t),i=[],o=[],s=0,u=e,r.label=1;case 1:return s<u.length?(a=u[s],c=void 0,(h=n.Nh.get(a))&&0!==h.length?[4,Io(n.Wu,Gn(h[0]))]:[3,7]):[3,13];case 2:c=r.sent(),f=0,l=h,r.label=3;case 3:return f<l.length?(p=l[f],d=n.Ch.get(p),[4,Ms(n,d)]):[3,6];case 4:(v=r.sent()).snapshot&&o.push(v.snapshot),r.label=5;case 5:return f++,[3,3];case 6:return[3,11];case 7:return[4,No(n.Wu,a)];case 8:return y=r.sent(),[4,Io(n.Wu,y)];case 9:return c=r.sent(),[4,_s(n,Bs(y),a,!1)];case 10:r.sent(),r.label=11;case 11:i.push(c),r.label=12;case 12:return s++,[3,1];case 13:return[2,(n.Dh.gu(o),i)]}}))}))}function Bs(t){return Pn(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Gs(t){var e=I(t);return I(I(e.Wu).persistence).Vi()}function zs(t,e,n,i){return r.__awaiter(this,void 0,void 0,(function(){var o,s,u;return r.__generator(this,(function(r){switch(r.label){case 0:return(o=I(t)).Bh?(y("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!o.Nh.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,Ao(o.Wu)];case 3:return s=r.sent(),u=Bt.Jt(e,"current"===n),[4,Ps(o,s,u)];case 4:return r.sent(),[3,8];case 5:return[4,Eo(o.Wu,e,!0)];case 6:return r.sent(),ks(o,e,i),[3,8];case 7:_(),r.label=8;case 8:return[2]}}))}))}function Ws(t,e,n){return r.__awaiter(this,void 0,void 0,(function(){var i,o,s,u,a,c,h,f,p,l;return r.__generator(this,(function(d){switch(d.label){case 0:if(!(i=Ks(t)).Bh)return[3,10];o=0,s=e,d.label=1;case 1:return o<s.length?(u=s[o],i.Nh.has(u)?(y("SyncEngine","Adding an already active target "+u),[3,5]):[4,No(i.Wu,u)]):[3,6];case 2:return a=d.sent(),[4,Io(i.Wu,a)];case 3:return c=d.sent(),[4,_s(i,Bs(a),c.targetId,!1)];case 4:d.sent(),Wo(i.Vh,c),d.label=5;case 5:return o++,[3,1];case 6:h=function(t){return r.__generator(this,(function(e){switch(e.label){case 0:return i.Nh.has(t)?[4,Eo(i.Wu,t,!1).then((function(){Ko(i.Vh,t),ks(i,t)})).catch(xo)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))},f=0,p=n,d.label=7;case 7:return f<p.length?(l=p[f],[5,h(l)]):[3,10];case 8:d.sent(),d.label=9;case 9:return f++,[3,7];case 10:return[2]}}))}))}function Ks(t){var e=I(t);return e.Vh.Ku.nh=Es.bind(null,e),e.Vh.Ku.Be=Us.bind(null,e),e.Vh.Ku.eh=Ns.bind(null,e),e.Dh.gu=Pr.bind(null,e.ph),e.Dh.Qh=Vr.bind(null,e.ph),e}function Qs(t){var e=I(t);return e.Vh.Ku.sh=As.bind(null,e),e.Vh.Ku.ih=Ss.bind(null,e),e}var Hs=function(){function t(){}return t.prototype.Cc=function(t){this.Gh=t},t.prototype.Or=function(t,e,n,i){var r=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.rn.length||1===t.rn.length&&t.rn[0].field.p())}(e)||n.isEqual(ct.min())?this.zh(t,e):this.Gh.$r(t,i).next((function(s){var u=r.Hh(e,s);return(Un(e)||Mn(e))&&r.Th(e.on,u,i,n)?r.zh(t,e):(v()<=c.LogLevel.DEBUG&&y("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Xn(e)),r.Gh.Or(t,e,n).next((function(t){return u.forEach((function(e){t=t.rt(e.key,e)})),t})))}))},t.prototype.Hh=function(t,e){var n=new St($n(t));return e.forEach((function(e,r){r instanceof On&&Yn(t,r)&&(n=n.add(r))})),n},t.prototype.Th=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.L(r)>0)},t.prototype.zh=function(t,e){return v()<=c.LogLevel.DEBUG&&y("IndexFreeQueryEngine","Using full collection scan to execute query:",Xn(e)),this.Gh.Or(t,e,ct.min())},t}(),Xs=function(){function t(t,e){this.Sr=t,this.Co=e,this.vr=[],this.Yh=1,this.Jh=new St(ko.xc)}return t.prototype.$o=function(t){return yr.resolve(0===this.vr.length)},t.prototype.xo=function(t,e,n,r){var i=this.Yh;this.Yh++,this.vr.length>0&&this.vr[this.vr.length-1];var o=new $r(i,e,n,r);this.vr.push(o);for(var s=0,u=r;s<u.length;s++){var a=u[s];this.Jh=this.Jh.add(new ko(a.key,i)),this.Sr.ko(t,a.key.path.h())}return yr.resolve(o)},t.prototype.Mo=function(t,e){return yr.resolve(this.Xh(e))},t.prototype.Lo=function(t,e){var n=e+1,r=this.Zh(n),i=r<0?0:r;return yr.resolve(this.vr.length>i?this.vr[i]:null)},t.prototype.Bo=function(){return yr.resolve(0===this.vr.length?-1:this.Yh-1)},t.prototype.qo=function(t){return yr.resolve(this.vr.slice())},t.prototype.Cr=function(t,e){var n=this,r=new ko(e,0),i=new ko(e,Number.POSITIVE_INFINITY),o=[];return this.Jh.Nt([r,i],(function(t){var e=n.Xh(t.Wc);o.push(e)})),yr.resolve(o)},t.prototype.Mr=function(t,e){var n=this,r=new St($);return e.forEach((function(t){var e=new ko(t,0),i=new ko(t,Number.POSITIVE_INFINITY);n.Jh.Nt([e,i],(function(t){r=r.add(t.Wc)}))})),yr.resolve(this.tl(r))},t.prototype.Qr=function(t,e){var n=e.path,r=n.length+1,i=n;D.F(i)||(i=i.child(""));var o=new ko(new D(i),0),s=new St($);return this.Jh.Ft((function(t){var e=t.key.path;return!!n.T(e)&&(e.length===r&&(s=s.add(t.Wc)),!0)}),o),yr.resolve(this.tl(s))},t.prototype.tl=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.Xh(t);null!==r&&n.push(r)})),n},t.prototype.Qo=function(t,e){var n=this;g(0===this.el(e.batchId,"removed")),this.vr.shift();var r=this.Jh;return yr.forEach(e.mutations,(function(i){var o=new ko(i.key,e.batchId);return r=r.delete(o),n.Co.Ko(t,i.key)})).next((function(){n.Jh=r}))},t.prototype.jo=function(t){},t.prototype.zo=function(t,e){var n=new ko(e,0),r=this.Jh.$t(n);return yr.resolve(e.isEqual(r&&r.key))},t.prototype.Go=function(t){return this.vr.length,yr.resolve()},t.prototype.el=function(t,e){return this.Zh(t)},t.prototype.Zh=function(t){return 0===this.vr.length?0:t-this.vr[0].batchId},t.prototype.Xh=function(t){var e=this.Zh(t);return e<0||e>=this.vr.length?null:this.vr[e]},t}(),Ys=function(){function t(t,e){this.Sr=t,this.nl=e,this.docs=new Tt(D.i),this.size=0}return t.prototype.Tr=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.nl(e);return this.docs=this.docs.rt(r,{Zo:e,size:s,readTime:n}),this.size+=s-o,this.Sr.ko(t,r.path.h())},t.prototype.Ir=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.Ar=function(t,e){var n=this.docs.get(e);return yr.resolve(n?n.Zo:null)},t.prototype.getEntries=function(t,e){var n=this,r=Ot();return e.forEach((function(t){var e=n.docs.get(t);r=r.rt(t,e?e.Zo:null)})),yr.resolve(r)},t.prototype.Or=function(t,e,n){for(var r=Lt(),i=new D(e.path.child("")),o=this.docs._t(i);o.It();){var s=o.Et(),u=s.key,a=s.value,c=a.Zo,h=a.readTime;if(!e.path.T(u.path))break;h.L(n)<=0||c instanceof On&&Yn(e,c)&&(r=r.rt(c.key,c))}return yr.resolve(r)},t.prototype.sl=function(t,e){return yr.forEach(this.docs,(function(t){return e(t)}))},t.prototype.ia=function(t){return new $s(this)},t.prototype.oa=function(t){return yr.resolve(this.size)},t}(),$s=function(t){function e(e){var n=this;return(n=t.call(this)||this).aa=e,n}return r.__extends(e,t),e.prototype.gr=function(t){var e=this,n=[];return this.dr.forEach((function(r,i){i?n.push(e.aa.Tr(t,i,e.readTime)):e.aa.Ir(r)})),yr.$n(n)},e.prototype.Rr=function(t,e){return this.aa.Ar(t,e)},e.prototype.Pr=function(t,e){return this.aa.getEntries(t,e)},e}(Zr),Js=function(){function t(t){this.persistence=t,this.il=new ut((function(t){return yt(t)}),gt),this.lastRemoteSnapshotVersion=ct.min(),this.highestTargetId=0,this.rl=0,this.ol=new Do,this.targetCount=0,this.al=ro._a()}return t.prototype.De=function(t,e){return this.il.forEach((function(t,n){return e(n)})),yr.resolve()},t.prototype.Ta=function(t){return yr.resolve(this.lastRemoteSnapshotVersion)},t.prototype.Ea=function(t){return yr.resolve(this.rl)},t.prototype.da=function(t){return this.highestTargetId=this.al.next(),yr.resolve(this.highestTargetId)},t.prototype.Ia=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.rl&&(this.rl=e),yr.resolve()},t.prototype.Ra=function(t){this.il.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.al=new ro(e),this.highestTargetId=e),t.sequenceNumber>this.rl&&(this.rl=t.sequenceNumber)},t.prototype.Aa=function(t,e){return this.Ra(e),this.targetCount+=1,yr.resolve()},t.prototype.ga=function(t,e){return this.Ra(e),yr.resolve()},t.prototype.ya=function(t,e){return this.il.delete(e.target),this.ol.qc(e.targetId),this.targetCount-=1,yr.resolve()},t.prototype.Vo=function(t,e,n){var r=this,i=0,o=[];return this.il.forEach((function(s,u){u.sequenceNumber<=e&&null===n.get(u.targetId)&&(r.il.delete(s),o.push(r.Va(t,u.targetId)),i++)})),yr.$n(o).next((function(){return i}))},t.prototype.pa=function(t){return yr.resolve(this.targetCount)},t.prototype.ba=function(t,e){var n=this.il.get(e)||null;return yr.resolve(n)},t.prototype.va=function(t,e,n){return this.ol.Oc(e,n),yr.resolve()},t.prototype.Da=function(t,e,n){this.ol.Bc(e,n);var r=this.persistence.Co,i=[];return r&&e.forEach((function(e){i.push(r.Ko(t,e))})),yr.$n(i)},t.prototype.Va=function(t,e){return this.ol.qc(e),yr.resolve()},t.prototype.Na=function(t,e){var n=this.ol.Qc(e);return yr.resolve(n)},t.prototype.zo=function(t,e){return yr.resolve(this.ol.zo(e))},t}(),Zs=function(){function t(t){var e=this;this.cl={},this.ka=new Fr(0),this.Ma=!1,this.Ma=!0,this.Co=t(this),this.ja=new Js(this),this.Sr=new Vi,this.br=function(t,n){return new Ys(t,(function(t){return e.Co.ul(t)}))}(this.Sr)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.Si=function(){return this.Ma=!1,Promise.resolve()},Object.defineProperty(t.prototype,"Ti",{get:function(){return this.Ma},enumerable:!1,configurable:!0}),t.prototype.Xa=function(){},t.prototype.Za=function(){},t.prototype.Ec=function(){return this.Sr},t.prototype.wc=function(t){var e=this.cl[t.Zs()];return e||(e=new Xs(this.Sr,this.Co),this.cl[t.Zs()]=e),e},t.prototype.mc=function(){return this.ja},t.prototype.Tc=function(){return this.br},t.prototype.runTransaction=function(t,e,n){var r=this;y("MemoryPersistence","Starting transaction:",t);var i=new tu(this.ka.next());return this.Co.hl(),n(i).next((function(t){return r.Co.ll(i).next((function(){return t}))})).Nn().then((function(t){return i.pr(),t}))},t.prototype._l=function(t,e){return yr.xn(Object.values(this.cl).map((function(n){return function(){return n.zo(t,e)}})))},t}(),tu=function(t){function e(e){var n=this;return(n=t.call(this)||this).Fa=e,n}return r.__extends(e,t),e}(ei),eu=function(){function t(t){this.persistence=t,this.fl=new Do,this.dl=null}return t.wl=function(e){return new t(e)},Object.defineProperty(t.prototype,"ml",{get:function(){if(this.dl)return this.dl;throw _()},enumerable:!1,configurable:!0}),t.prototype.Sa=function(t,e,n){return this.fl.Sa(n,e),this.ml.delete(n.toString()),yr.resolve()},t.prototype.Ca=function(t,e,n){return this.fl.Ca(n,e),this.ml.add(n.toString()),yr.resolve()},t.prototype.Ko=function(t,e){return this.ml.add(e.toString()),yr.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.fl.qc(e.targetId).forEach((function(t){return n.ml.add(t.toString())}));var r=this.persistence.mc();return r.Na(t,e.targetId).next((function(t){t.forEach((function(t){return n.ml.add(t.toString())}))})).next((function(){return r.ya(t,e)}))},t.prototype.hl=function(){this.dl=new Set},t.prototype.ll=function(t){var e=this,n=this.persistence.Tc().ia();return yr.forEach(this.ml,(function(r){var i=D.D(r);return e.Tl(t,i).next((function(t){t||n.Ir(i)}))})).next((function(){return e.dl=null,n.apply(t)}))},t.prototype.gc=function(t,e){var n=this;return this.Tl(t,e).next((function(t){t?n.ml.delete(e.toString()):n.ml.add(e.toString())}))},t.prototype.ul=function(t){return 0},t.prototype.Tl=function(t,e){var n=this;return yr.xn([function(){return yr.resolve(n.fl.zo(e))},function(){return n.persistence.mc().zo(t,e)},function(){return n.persistence._l(t,e)}])},t}(),nu=function(){function t(t){this.El=t.El,this.Il=t.Il}return t.prototype.Ru=function(t){this.Al=t},t.prototype.mu=function(t){this.Rl=t},t.prototype.onMessage=function(t){this.Pl=t},t.prototype.close=function(){this.Il()},t.prototype.send=function(t){this.El(t)},t.prototype.gl=function(){this.Al()},t.prototype.yl=function(t){this.Rl(t)},t.prototype.Vl=function(t){this.Pl(t)},t}(),ru={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},iu=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n}return r.__extends(e,t),e.prototype.Cl=function(t,e,n,r){return new Promise((function(o,s){var u=new i.XhrIo;u.listenOnce(i.EventType.COMPLETE,(function(){try{switch(u.getLastErrorCode()){case i.ErrorCode.NO_ERROR:var e=u.getResponseJson();y("Connection","XHR received:",JSON.stringify(e)),o(e);break;case i.ErrorCode.TIMEOUT:y("Connection",'RPC "'+t+'" timed out'),s(new l(a.DEADLINE_EXCEEDED,"Request time out"));break;case i.ErrorCode.HTTP_ERROR:var n=u.getStatus();if(y("Connection",'RPC "'+t+'" failed with status:',n,"response text:",u.getResponseText()),n>0){var r=u.getResponseJson().error;if(r&&r.status&&r.message){var c=function(t){var e=t.toLowerCase().replace("_","-");return Object.values(a).indexOf(e)>=0?e:a.UNKNOWN}(r.status);s(new l(c,r.message))}else s(new l(a.UNKNOWN,"Server responded with status "+u.getStatus()))}else s(new l(a.UNAVAILABLE,"Connection failed."));break;default:_()}}finally{y("Connection",'RPC "'+t+'" completed.')}}));var c=JSON.stringify(r);u.send(e,"POST",c,n,15)}))},e.prototype.Pu=function(t,e){var n=[this.bl,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=i.createWebChannelTransport(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.U.projectId+"/databases/"+this.U.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.Dl(s.initMessageHeaders,e),h.isMobileCordova()||h.isReactNative()||h.isElectron()||h.isIE()||h.isUWP()||h.isBrowserExtension()||(s.httpHeadersOverwriteParam="$httpHeaders");var u=n.join("");y("Connection","Creating WebChannel: "+u,s);var o=r.createWebChannel(u,s),c=!1,p=!1,f=new nu({El:function(t){p?y("Connection","Not sending because WebChannel is closed:",t):(c||(y("Connection","Opening WebChannel transport."),o.open(),c=!0),y("Connection","WebChannel sending:",t),o.send(t))},Il:function(){return o.close()}}),d=function(t,e){o.listen(t,(function(t){try{e(t)}catch(t){setTimeout((function(){throw t}),0)}}))};return d(i.WebChannel.EventType.OPEN,(function(){p||y("Connection","WebChannel transport opened.")})),d(i.WebChannel.EventType.CLOSE,(function(){p||(p=!0,y("Connection","WebChannel transport closed"),f.yl())})),d(i.WebChannel.EventType.ERROR,(function(t){p||(p=!0,m("Connection","WebChannel transport errored:",t),f.yl(new l(a.UNAVAILABLE,"The operation could not be completed")))})),d(i.WebChannel.EventType.MESSAGE,(function(t){var e;if(!p){var n=t.data[0];g(!!n);var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){y("Connection","WebChannel received error:",i);var c=i.status,s=function(t){var e=mt[t];if(void 0!==e)return Et(e)}(c),u=i.message;void 0===s&&(s=a.INTERNAL,u="Unknown error status: "+c+" with message "+i.message),p=!0,f.yl(new l(s,u)),o.close()}else y("Connection","WebChannel received:",n),f.Vl(n)}})),setTimeout((function(){f.gl()}),0),f},e}(function(){function t(t){this.pl=t,this.U=t.U;var e=t.ssl?"https":"http";this.bl=e+"://"+t.host,this.vl="projects/"+this.U.projectId+"/databases/"+this.U.database+"/documents"}return t.prototype.$u=function(t,e,n,r){var i=this.Sl(t,e);y("RestConnection","Sending: ",i,n);var o={};return this.Dl(o,r),this.Cl(t,i,o,n).then((function(t){return y("RestConnection","Received: ",t),t}),(function(e){throw m("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e}))},t.prototype.xu=function(t,e,n,r){return this.$u(t,e,n,r)},t.prototype.Dl=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/7.23.0",t["Content-Type"]="text/plain",e)for(var n in e.jc)e.jc.hasOwnProperty(n)&&(t[n]=e.jc[n])},t.prototype.Sl=function(t,e){var n=ru[t];return this.bl+"/v1/"+e+":"+n},t}()),ou=function(){function t(){var t=this;this.Nl=function(){return t.Fl()},this.$l=function(){return t.xl()},this.kl=[],this.Ml()}return t.prototype.Xu=function(t){this.kl.push(t)},t.prototype.Si=function(){window.removeEventListener("online",this.Nl),window.removeEventListener("offline",this.$l)},t.prototype.Ml=function(){window.addEventListener("online",this.Nl),window.addEventListener("offline",this.$l)},t.prototype.Fl=function(){y("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.kl;t<e.length;t++)(0,e[t])(0)},t.prototype.xl=function(){y("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.kl;t<e.length;t++)(0,e[t])(1)},t.On=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),su=function(){function t(){}return t.prototype.Xu=function(t){},t.prototype.Si=function(){},t}();function uu(t){return new ge(t,!0)}var au="You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.",cu=function(){function t(){}return t.prototype.initialize=function(t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return this.bh=this.Ol(t),this.persistence=this.Ll(t),[4,this.persistence.start()];case 1:return e.sent(),this.Bl=this.ql(t),this.Wu=this.Ul(t),[2]}}))}))},t.prototype.ql=function(t){return null},t.prototype.Ul=function(t){return e=this.persistence,n=new Hs,r=t.Ql,new go(e,n,r);var e,n,r},t.prototype.Ll=function(t){if(t.persistenceSettings.Wl)throw new l(a.FAILED_PRECONDITION,au);return new Zs(eu.wl)},t.prototype.Ol=function(t){return new Yr},t.prototype.terminate=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return this.Bl&&this.Bl.stop(),[4,this.bh.Si()];case 1:return t.sent(),[4,this.persistence.Si()];case 2:return t.sent(),[2]}}))}))},t.prototype.clearPersistence=function(t,e){throw new l(a.FAILED_PRECONDITION,au)},t}(),hu=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r.__extends(e,t),e.prototype.initialize=function(e){return r.__awaiter(this,void 0,void 0,(function(){var n,i=this;return r.__generator(this,(function(o){switch(o.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return o.sent(),n=this.jl._i,this.bh instanceof Xr?(this.bh._i={tr:js.bind(null,n),er:zs.bind(null,n),nr:Ws.bind(null,n),Vi:Gs.bind(null,n)},[4,this.bh.start()]):[3,3];case 2:o.sent(),o.label=3;case 3:return[4,this.persistence.Ja((function(t){return r.__awaiter(i,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return[4,Fs(this.jl._i,t)];case 1:return e.sent(),this.Bl&&(t&&!this.Bl.Ti?this.Bl.start(this.Wu):t||this.Bl.stop()),[2]}}))}))}))];case 4:return o.sent(),[2]}}))}))},e.prototype.Ol=function(t){if(t.persistenceSettings.Wl&&t.persistenceSettings.synchronizeTabs){var e=Ar();if(!Xr.On(e))throw new l(a.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=yo(t.pl.U,t.pl.persistenceKey);return new Xr(e,t.os,n,t.clientId,t.Ql)}return new Yr},e}(function(t){function e(e){var n=this;return(n=t.call(this)||this).jl=e,n}return r.__extends(e,t),e.prototype.initialize=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(n){switch(n.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return n.sent(),[4,So(this.Wu)];case 2:return n.sent(),[4,this.jl.initialize(this,e)];case 3:return n.sent(),[4,Qs(this.jl._i)];case 4:return n.sent(),[4,is(this.jl.Vh)];case 5:return n.sent(),[2]}}))}))},e.prototype.ql=function(t){var e=this.persistence.Co.do;return new ai(e,t.os)},e.prototype.Ll=function(t){var e=yo(t.pl.U,t.pl.persistenceKey),n=uu(t.pl.U);return new ho(t.persistenceSettings.synchronizeTabs,e,t.clientId,ui.oo(t.persistenceSettings.cacheSizeBytes),t.os,Ar(),Sr(),n,this.bh,t.persistenceSettings.xa)},e.prototype.Ol=function(t){return new Yr},e.prototype.clearPersistence=function(t,e){return function(t){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(n){switch(n.label){case 0:return gr.On()?(e=t+"main",[4,gr.delete(e)]):[2,Promise.resolve()];case 1:return n.sent(),[2]}}))}))}(yo(t,e))},e}(cu)),fu=function(){function t(){}return t.prototype.initialize=function(t,e){return r.__awaiter(this,void 0,void 0,(function(){var n=this;return r.__generator(this,(function(r){switch(r.label){case 0:return this.Wu?[3,2]:(this.Wu=t.Wu,this.bh=t.bh,this.ju=this.Kl(e),this.Vh=this.Gl(e),this.ph=this.zl(e),this._i=this.Hl(e),this.bh.fi=function(t){return Ts(n._i,t,1)},this.Vh.Ku.Yl=Vs.bind(null,this._i),[4,fs(this.Vh,this._i.qh)]);case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},t.prototype.zl=function(t){return new Rr},t.prototype.Kl=function(t){var e,n=uu(t.pl.U),r=(e=t.pl,new iu(e));return function(t,e,n){return new jo(t,e,n)}(t.credentials,r,n)},t.prototype.Gl=function(t){var e,n,r,i,o,s=this;return e=this.Wu,n=this.ju,r=t.os,i=function(t){return Ts(s._i,t,0)},o=ou.On()?new ou:new su,new qo(e,n,r,i,o)},t.prototype.Hl=function(t){return function(t,e,n,r,i,o,s){var u=new ws(t,e,n,r,i,o);return s&&(u.Bh=!0),u}(this.Wu,this.Vh,this.ph,this.bh,t.Ql,t.Sh,!t.persistenceSettings.Wl||!t.persistenceSettings.synchronizeTabs)},t.prototype.terminate=function(){return zo(this.Vh)},t}(),lu=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.Jl(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.Jl(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Xl=function(){this.muted=!0},t.prototype.Jl=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},t}(),pu=function(t){!function(t,e,n,r){if(!(e instanceof Array)||e.length<1)throw new l(a.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least "+H(1,"element")+".")}(0,t);for(var e=0;e<t.length;++e)if(C("FieldPath","string",e,t[e]),0===t[e].length)throw new l(a.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.Zl=new x(t)},du=function(t){function e(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.call(this,e)||this}return r.__extends(e,t),e.documentId=function(){return new e(x.v().R())},e.prototype.isEqual=function(t){if(!(t instanceof e))throw W("isEqual","FieldPath",1,t);return this.Zl.isEqual(t.Zl)},e}(pu),vu=new RegExp("[~\\*/\\[\\]]"),yu=function(t){this.t_=t},gu=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r.__extends(e,t),e.prototype.e_=function(t){if(2!==t.n_)throw 1===t.n_?t.s_(this.t_+"() can only appear at the top level of your update data"):t.s_(this.t_+"() cannot be used with set() unless you pass {merge:true}");return t.Qe.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(yu);function mu(t,e,n){return new ku({n_:3,i_:e.settings.i_,methodName:t.t_,r_:n},e.U,e.serializer,e.ignoreUndefinedProperties)}var wu=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r.__extends(e,t),e.prototype.e_=function(t){return new cn(t.path,new Ze)},e.prototype.isEqual=function(t){return t instanceof e},e}(yu),bu=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).o_=n,r}return r.__extends(e,t),e.prototype.e_=function(t){var e=mu(this,t,!0),n=this.o_.map((function(t){return Vu(t,e)})),r=new tn(n);return new cn(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(yu),_u=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).o_=n,r}return r.__extends(e,t),e.prototype.e_=function(t){var e=mu(this,t,!0),n=this.o_.map((function(t){return Vu(t,e)})),r=new nn(n);return new cn(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(yu),Iu=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).a_=n,r}return r.__extends(e,t),e.prototype.e_=function(t){var e=new on(t.serializer,be(t.serializer,this.a_));return new cn(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(yu),Eu=function(){function t(t,e){if(O("GeoPoint",arguments,2),C("GeoPoint","number",1,t),C("GeoPoint","number",2,e),!isFinite(t)||t<-90||t>90)throw new l(a.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new l(a.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.c_=t,this.u_=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this.c_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this.u_},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.c_===t.c_&&this.u_===t.u_},t.prototype.toJSON=function(){return{latitude:this.c_,longitude:this.u_}},t.prototype.H=function(t){return $(this.c_,t.c_)||$(this.u_,t.u_)},t}(),Tu=function(t){this.h_=t},Nu=/^__.*__$/,Au=function(t,e,n){this.l_=t,this.__=e,this.f_=n},Su=function(){function t(t,e,n){this.data=t,this.Qe=e,this.fieldTransforms=n}return t.prototype.d_=function(t,e){var n=[];return null!==this.Qe?n.push(new bn(t,this.data,this.Qe,e)):n.push(new wn(t,this.data,e)),this.fieldTransforms.length>0&&n.push(new In(t,this.fieldTransforms)),n},t}(),xu=function(){function t(t,e,n){this.data=t,this.Qe=e,this.fieldTransforms=n}return t.prototype.d_=function(t,e){var n=[new bn(t,this.data,this.Qe,e)];return this.fieldTransforms.length>0&&n.push(new In(t,this.fieldTransforms)),n},t}();function Du(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw _()}}var ku=function(){function t(t,e,n,r,i,o){this.settings=t,this.U=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.w_(),this.fieldTransforms=i||[],this.Qe=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"n_",{get:function(){return this.settings.n_},enumerable:!1,configurable:!0}),t.prototype.m_=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.U,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.Qe)},t.prototype.T_=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.m_({path:n,r_:!1});return r.E_(t),r},t.prototype.I_=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.m_({path:n,r_:!1});return r.w_(),r},t.prototype.A_=function(t){return this.m_({path:void 0,r_:!0})},t.prototype.s_=function(t){return Bu(t,this.settings.methodName,this.settings.R_||!1,this.path,this.settings.i_)},t.prototype.contains=function(t){return void 0!==this.Qe.find((function(e){return t.T(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.T(e.field)}))},t.prototype.w_=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.E_(this.path.get(t))},t.prototype.E_=function(t){if(0===t.length)throw this.s_("Document fields must not be empty");if(Du(this.n_)&&Nu.test(t))throw this.s_('Document fields cannot begin and end with "__"')},t}(),Ou=function(){function t(t,e,n){this.U=t,this.ignoreUndefinedProperties=e,this.serializer=n||uu(t)}return t.prototype.P_=function(t,e,n,r){return void 0===r&&(r=!1),new ku({n_:t,methodName:e,i_:n,path:x.g(),r_:!1,R_:r},this.U,this.serializer,this.ignoreUndefinedProperties)},t}();function Ru(t,e,n,r,i,o){void 0===o&&(o={});var s=t.P_(o.merge||o.mergeFields?2:0,e,n,i);ju("Data must be an object, but it was:",s,r);var u,c,h=Uu(r,s);if(o.merge)u=new an(s.Qe),c=s.fieldTransforms;else if(o.mergeFields){for(var f=[],p=0,d=o.mergeFields;p<d.length;p++){var v=d[p],g=void 0;if(v instanceof pu)g=v.Zl;else{if("string"!=typeof v)throw _();g=qu(e,v,n)}if(!s.contains(g))throw new l(a.INVALID_ARGUMENT,"Field '"+g+"' is specified in your field mask but missing from your input data.");Gu(f,g)||f.push(g)}u=new an(f),c=s.fieldTransforms.filter((function(t){return u.He(t.field)}))}else u=null,c=s.fieldTransforms;return new Su(new Sn(h),u,c)}function Lu(t,e,n,r){var i=t.P_(1,e,n);ju("Data must be an object, but it was:",i,r);var o=[],s=new xn;T(r,(function(t,r){var u=qu(e,t,n),a=i.I_(u);if(r instanceof gu||r instanceof Tu&&r.h_ instanceof gu)o.push(u);else{var c=Vu(r,a);null!=c&&(o.push(u),s.set(u,c))}}));var u=new an(o);return new xu(s.Je(),u,i.fieldTransforms)}function Cu(t,e,n,r,i,o){var s=t.P_(1,e,n),u=[Fu(e,r,n)],c=[i];if(o.length%2!=0)throw new l(a.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var h=0;h<o.length;h+=2)u.push(Fu(e,o[h])),c.push(o[h+1]);for(var f=[],p=new xn,d=u.length-1;d>=0;--d)if(!Gu(f,u[d])){var v=u[d],y=c[d],g=s.I_(v);if(y instanceof gu||y instanceof Tu&&y.h_ instanceof gu)f.push(v);else{var m=Vu(y,g);null!=m&&(f.push(v),p.set(v,m))}}var w=new an(f);return new xu(p.Je(),w,s.fieldTransforms)}function Pu(t,e,n,r){return void 0===r&&(r=!1),Vu(n,t.P_(r?4:3,e))}function Vu(t,e){if(t instanceof Tu&&(t=t.h_),Mu(t))return ju("Unsupported field value:",e,t),Uu(t,e);if(t instanceof yu)return function(t,e){if(!Du(e.n_))throw e.s_(t.t_+"() can only be used with update() and set()");if(!e.path)throw e.s_(t.t_+"() is not currently supported inside arrays");var n=t.e_(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(e.path&&e.Qe.push(e.path),t instanceof Array){if(e.settings.r_&&4!==e.n_)throw e.s_("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=Vu(o[i],e.A_(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return be(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=at.fromDate(t);return{timestampValue:_e(e.serializer,n)}}if(t instanceof at){var r=new at(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:_e(e.serializer,r)}}if(t instanceof Eu)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof et)return{bytesValue:Ie(e.serializer,t.q)};if(t instanceof Au){var i=e.U,o=t.l_;if(!o.isEqual(i))throw e.s_("Document reference is for database "+o.projectId+"/"+o.database+" but should be for database "+i.projectId+"/"+i.database);return{referenceValue:Ne(t.l_||e.U,t.__.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.s_("Unsupported field value: "+G(t))}(t,e)}function Uu(t,e){var n={};return b(t)?e.path&&e.path.length>0&&e.Qe.push(e.path):T(t,(function(t,r){var i=Vu(r,e.T_(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function Mu(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof at||t instanceof Eu||t instanceof et||t instanceof Au||t instanceof yu)}function ju(t,e,n){if(!Mu(n)||!B(n)){var r=G(n);throw"an object"===r?e.s_(t+" a custom object"):e.s_(t+" "+r)}}function Fu(t,e,n){if(e instanceof pu)return e.Zl;if("string"==typeof e)return qu(t,e);throw Bu("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}function qu(t,e,n){try{return function(t){if(t.search(vu)>=0)throw new l(a.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(du.bind.apply(du,r.__spreadArrays([void 0],t.split("."))))}catch(e){throw new l(a.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e).Zl}catch(e){throw Bu((i=e)instanceof Error?i.message:i.toString(),t,!1,void 0,n)}var i}function Bu(t,e,n,r,i){var o=r&&!r.m(),s=void 0!==i,u="Function "+e+"() called with invalid data";n&&(u+=" (via `toFirestore()`)");var c="";return(o||s)&&(c+=" (found",o&&(c+=" in field "+r),s&&(c+=" in document "+i),c+=")"),new l(a.INVALID_ARGUMENT,(u+=". ")+t+c)}function Gu(t,e){return t.some((function(t){return t.isEqual(e)}))}var zu=function(){function t(t){this.ju=t,this.g_=new Map,this.mutations=[],this.y_=!1,this.V_=null,this.p_=new Set}return t.prototype.b_=function(t){return r.__awaiter(this,void 0,void 0,(function(){var e,n=this;return r.__generator(this,(function(i){switch(i.label){case 0:if(this.v_(),this.mutations.length>0)throw new l(a.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o,s,u,a;return r.__generator(this,(function(r){switch(r.label){case 0:return n=I(t),i=Oe(n.serializer)+"/documents",o={documents:e.map((function(t){return Se(n.serializer,t)}))},[4,n.xu("BatchGetDocuments",i,o)];case 1:return s=r.sent(),u=new Map,s.forEach((function(t){var e=function(t,e){return"found"in e?function(t,e){g(!!e.found),e.found.name,e.found.updateTime;var n=xe(t,e.found.name),r=Te(e.found.updateTime),i=new Sn({mapValue:{fields:e.found.fields}});return new On(n,r,i,{})}(t,e):"missing"in e?function(t,e){g(!!e.missing),g(!!e.readTime);var n=xe(t,e.missing),r=Te(e.readTime);return new Rn(n,r)}(t,e):_()}(n.serializer,t);u.set(e.key.toString(),e)})),a=[],[2,(e.forEach((function(t){var e=u.get(t.toString());g(!!e),a.push(e)})),a)]}}))}))}(this.ju,t)];case 1:return[2,((e=i.sent()).forEach((function(t){t instanceof Rn||t instanceof On?n.S_(t):_()})),e)]}}))}))},t.prototype.set=function(t,e){this.write(e.d_(t,this.Ke(t))),this.p_.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.d_(t,this.D_(t)))}catch(t){this.V_=t}this.p_.add(t.toString())},t.prototype.delete=function(t){this.write([new Nn(t,this.Ke(t))]),this.p_.add(t.toString())},t.prototype.commit=function(){return r.__awaiter(this,void 0,void 0,(function(){var t,e=this;return r.__generator(this,(function(n){switch(n.label){case 0:if(this.v_(),this.V_)throw this.V_;return t=this.g_,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(t,n){var r=D.D(n);e.mutations.push(new An(r,e.Ke(r)))})),[4,function(t,e){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o;return r.__generator(this,(function(r){switch(r.label){case 0:return n=I(t),i=Oe(n.serializer)+"/documents",o={writes:e.map((function(t){return Ce(n.serializer,t)}))},[4,n.$u("Commit",i,o)];case 1:return r.sent(),[2]}}))}))}(this.ju,this.mutations)];case 1:return n.sent(),this.y_=!0,[2]}}))}))},t.prototype.S_=function(t){var e;if(t instanceof On)e=t.version;else{if(!(t instanceof Rn))throw _();e=ct.min()}var n=this.g_.get(t.key.toString());if(n){if(!e.isEqual(n))throw new l(a.ABORTED,"Document version changed between two reads.")}else this.g_.set(t.key.toString(),e)},t.prototype.Ke=function(t){var e=this.g_.get(t.toString());return!this.p_.has(t.toString())&&e?fn.updateTime(e):fn.Ge()},t.prototype.D_=function(t){var e=this.g_.get(t.toString());if(!this.p_.has(t.toString())&&e){if(e.isEqual(ct.min()))throw new l(a.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return fn.updateTime(e)}return fn.exists(!0)},t.prototype.write=function(t){this.v_(),this.mutations=this.mutations.concat(t)},t.prototype.v_=function(){},t}(),Wu=function(){function t(t,e,n,r){this.os=t,this.ju=e,this.updateFunction=n,this.hs=r,this.C_=5,this.gs=new vr(this.os,"transaction_retry")}return t.prototype.run=function(){this.N_()},t.prototype.N_=function(){var t=this;this.gs.Rn((function(){return r.__awaiter(t,void 0,void 0,(function(){var t,e,n=this;return r.__generator(this,(function(r){return t=new zu(this.ju),(e=this.F_(t))&&e.then((function(e){n.os.ds((function(){return t.commit().then((function(){n.hs.resolve(e)})).catch((function(t){n.x_(t)}))}))})).catch((function(t){n.x_(t)})),[2]}))}))}))},t.prototype.F_=function(t){try{var e=this.updateFunction(t);return!ht(e)&&e.catch&&e.then?e:(this.hs.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.hs.reject(t),null}},t.prototype.x_=function(t){var e=this;this.C_>0&&this.k_(t)?(this.C_-=1,this.os.ds((function(){return e.N_(),Promise.resolve()}))):this.hs.reject(t)},t.prototype.k_=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!It(e)}return!1},t}(),Ku=function(){function t(t,e){this.credentials=t,this.os=e,this.clientId=Y.k(),this.M_=new dr}return t.prototype.start=function(t,e,n,i){var o=this;this.O_(),this.pl=t;var s=new dr,u=!1;return this.credentials.zc((function(t){if(!u)return u=!0,y("FirestoreClient","Initializing. user=",t.uid),o.L_(e,n,i,t,s).then(o.M_.resolve,o.M_.reject);o.os.Ds((function(){return function(t,e){return r.__awaiter(this,void 0,void 0,(function(){var n,i;return r.__generator(this,(function(r){switch(r.label){case 0:return(n=I(t)).os.Fs(),y("RemoteStore","RemoteStore received new credentials"),i=$o(n),n.Hu.add(3),[4,Go(n)];case 1:return r.sent(),i&&n.Zu.set("Unknown"),[4,n.Ku.Yl(e)];case 2:return r.sent(),n.Hu.delete(3),[4,Bo(n)];case 3:return r.sent(),[2]}}))}))}(o.Vh,t)}))})),this.os.ds((function(){return o.M_.promise})),s.promise},t.prototype.enableNetwork=function(){var t=this;return this.O_(),this.os.enqueue((function(){return t.persistence.Za(!0),function(t){var e=I(t);return e.Hu.delete(0),Bo(e)}(t.Vh)}))},t.prototype.L_=function(t,e,n,i,o){return r.__awaiter(this,void 0,void 0,(function(){var s,u,a=this;return r.__generator(this,(function(c){switch(c.label){case 0:return c.trys.push([0,3,,4]),s={os:this.os,pl:this.pl,clientId:this.clientId,credentials:this.credentials,Ql:i,Sh:100,persistenceSettings:n},[4,t.initialize(s)];case 1:return c.sent(),[4,e.initialize(t,s)];case 2:return c.sent(),this.persistence=t.persistence,this.bh=t.bh,this.Wu=t.Wu,this.Bl=t.Bl,this.ju=e.ju,this.Vh=e.Vh,this._i=e._i,this.B_=e.ph,this.B_.qs=bs.bind(null,this._i),this.B_.Ws=Is.bind(null,this._i),this.persistence.Xa((function(){return r.__awaiter(a,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}}))}))})),o.resolve(),[3,4];case 3:if(u=c.sent(),o.reject(u),!this.q_(u))throw u;return[2,(console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+u),this.L_(new cu,new fu,{Wl:!1},i,o))];case 4:return[2]}}))}))},t.prototype.q_=function(t){return"FirebaseError"===t.name?t.code===a.FAILED_PRECONDITION||t.code===a.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},t.prototype.O_=function(){if(this.os.Vs)throw new l(a.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.disableNetwork=function(){var t=this;return this.O_(),this.os.enqueue((function(){return t.persistence.Za(!1),function(t){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(n){switch(n.label){case 0:return(e=I(t)).Hu.add(0),[4,Go(e)];case 1:return n.sent(),e.Zu.set("Offline"),[2]}}))}))}(t.Vh)}))},t.prototype.terminate=function(){var t=this;this.os.Ss();var e=new dr;return this.os.ps((function(){return r.__awaiter(t,void 0,void 0,(function(){var t,n;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,4,,5]),this.Bl&&this.Bl.stop(),[4,zo(this.Vh)];case 1:return r.sent(),[4,this.bh.Si()];case 2:return r.sent(),[4,this.persistence.Si()];case 3:return r.sent(),this.credentials.Hc(),e.resolve(),[3,5];case 4:return t=r.sent(),n=kr(t,"Failed to shutdown persistence"),e.reject(n),[3,5];case 5:return[2]}}))}))})),e.promise},t.prototype.waitForPendingWrites=function(){var t=this;this.O_();var e=new dr;return this.os.ds((function(){return function(t,e){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o,s,u;return r.__generator(this,(function(r){switch(r.label){case 0:$o((n=I(t)).Vh)||y("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,function(t){var e=I(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(t){return e.vr.Bo(t)}))}(n.Wu)];case 2:return-1===(i=r.sent())?[2,void e.resolve()]:((o=n.Oh.get(i)||[]).push(e),n.Oh.set(i,o),[3,4]);case 3:return s=r.sent(),u=kr(s,"Initialization of waitForPendingWrites() operation failed"),e.reject(u),[3,4];case 4:return[2]}}))}))}(t._i,e)})),e.promise},t.prototype.listen=function(t,e,n){var r=this;this.O_();var i=new lu(n),o=new Mr(t,i,e);return this.os.ds((function(){return Lr(r.B_,o)})),function(){i.Xl(),r.os.ds((function(){return Cr(r.B_,o)}))}},t.prototype.U_=function(t){return r.__awaiter(this,void 0,void 0,(function(){var e,n=this;return r.__generator(this,(function(i){switch(i.label){case 0:return this.O_(),[4,this.M_.promise];case 1:return i.sent(),e=new dr,[2,(this.os.ds((function(){return function(t,e,n){return r.__awaiter(this,void 0,void 0,(function(){var i,o,s;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t,e){var n=I(t);return n.persistence.runTransaction("read document","readonly",(function(t){return n.Dc.Dr(t,e)}))}(t,e)];case 1:return(i=r.sent())instanceof On?n.resolve(i):i instanceof Rn?n.resolve(null):n.reject(new l(a.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return o=r.sent(),s=kr(o,"Failed to get document '"+e+" from cache"),n.reject(s),[3,3];case 3:return[2]}}))}))}(n.Wu,t,e)})),e.promise)]}}))}))},t.prototype.Q_=function(t,e){return void 0===e&&(e={}),r.__awaiter(this,void 0,void 0,(function(){var n,i=this;return r.__generator(this,(function(r){switch(r.label){case 0:return this.O_(),[4,this.M_.promise];case 1:return r.sent(),n=new dr,[2,(this.os.ds((function(){return function(t,e,n,r,i){var o=new lu({next:function(o){e.ds((function(){return Cr(t,s)}));var u=o.docs.has(n);!u&&o.fromCache?i.reject(new l(a.UNAVAILABLE,"Failed to get document because the client is offline.")):u&&o.fromCache&&r&&"server"===r.source?i.reject(new l(a.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new Mr(Vn(n.path),o,{includeMetadataChanges:!0,Js:!0});return Lr(t,s)}(i.B_,i.os,t,e,n)})),n.promise)]}}))}))},t.prototype.W_=function(t){return r.__awaiter(this,void 0,void 0,(function(){var e,n=this;return r.__generator(this,(function(i){switch(i.label){case 0:return this.O_(),[4,this.M_.promise];case 1:return i.sent(),e=new dr,[2,(this.os.ds((function(){return function(t,e,n){return r.__awaiter(this,void 0,void 0,(function(){var i,o,s,u,a,c;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,To(t,e,!0)];case 1:return i=r.sent(),o=new ys(e,i.Nc),s=o.dh(i.documents),u=o.gr(s,!1),n.resolve(u.snapshot),[3,3];case 2:return a=r.sent(),c=kr(a,"Failed to execute query '"+e+" against cache"),n.reject(c),[3,3];case 3:return[2]}}))}))}(n.Wu,t,e)})),e.promise)]}}))}))},t.prototype.j_=function(t,e){return void 0===e&&(e={}),r.__awaiter(this,void 0,void 0,(function(){var n,i=this;return r.__generator(this,(function(r){switch(r.label){case 0:return this.O_(),[4,this.M_.promise];case 1:return r.sent(),n=new dr,[2,(this.os.ds((function(){return function(t,e,n,r,i){var o=new lu({next:function(n){e.ds((function(){return Cr(t,s)})),n.fromCache&&"server"===r.source?i.reject(new l(a.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new Mr(n,o,{includeMetadataChanges:!0,Js:!0});return Lr(t,s)}(i.B_,i.os,t,e,n)})),n.promise)]}}))}))},t.prototype.write=function(t){var e=this;this.O_();var n=new dr;return this.os.ds((function(){return function(t,e,n){return r.__awaiter(this,void 0,void 0,(function(){var i,o,s,u;return r.__generator(this,(function(r){switch(r.label){case 0:i=Qs(t),r.label=1;case 1:return r.trys.push([1,5,,6]),[4,function(t,e){var n,r=I(t),i=at.now(),o=e.reduce((function(t,e){return t.add(e.key)}),Vt());return r.persistence.runTransaction("Locally write mutations","readwrite",(function(t){return r.Dc.$r(t,o).next((function(o){n=o;for(var s=[],u=0,a=e;u<a.length;u++){var c=a[u],h=yn(c,n.get(c.key));null!=h&&s.push(new bn(c.key,h,Dn(h.proto.mapValue),fn.exists(!0)))}return r.vr.xo(t,i,s,e)}))})).then((function(t){var e=t.hr(n);return{batchId:t.batchId,dr:e}}))}(i.Wu,e)];case 2:return o=r.sent(),i.bh.Fi(o.batchId),function(t,e,n){var r=t.Mh[t.currentUser.Zs()];r||(r=new Tt($)),r=r.rt(e,n),t.Mh[t.currentUser.Zs()]=r}(i,o.batchId,n),[4,Ps(i,o.dr)];case 3:return r.sent(),[4,is(i.Vh)];case 4:return r.sent(),[3,6];case 5:return s=r.sent(),u=kr(s,"Failed to persist write"),n.reject(u),[3,6];case 6:return[2]}}))}))}(e._i,t,n)})),n.promise},t.prototype.U=function(){return this.pl.U},t.prototype.K_=function(t){var e=this;this.O_();var n=new lu(t);return this.os.ds((function(){return r.__awaiter(e,void 0,void 0,(function(){return r.__generator(this,(function(t){return[2,function(t,e){I(t).Bs.add(e),e.next()}(this.B_,n)]}))}))})),function(){n.Xl(),e.os.ds((function(){return r.__awaiter(e,void 0,void 0,(function(){return r.__generator(this,(function(t){return[2,function(t,e){I(t).Bs.delete(e)}(this.B_,n)]}))}))}))}},Object.defineProperty(t.prototype,"G_",{get:function(){return this.os.Vs},enumerable:!1,configurable:!0}),t.prototype.transaction=function(t){var e=this;this.O_();var n=new dr;return this.os.ds((function(){return new Wu(e.os,e.ju,t,n).run(),Promise.resolve()})),n.promise},t}();function Qu(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}var Hu=function(){function t(t,e,n,r,i){this.U=t,this.timestampsInSnapshots=e,this.z_=n,this.H_=r,this.Y_=i}return t.prototype.J_=function(t){switch(te(t)){case 0:return null;case 1:return t.booleanValue;case 2:return ue(t.integerValue||t.doubleValue);case 3:return this.X_(t.timestampValue);case 4:return this.Z_(t);case 5:return t.stringValue;case 6:return this.Y_(ae(t.bytesValue));case 7:return this.tf(t.referenceValue);case 8:return this.ef(t.geoPointValue);case 9:return this.nf(t.arrayValue);case 10:return this.sf(t.mapValue);default:throw _()}},t.prototype.sf=function(t){var e=this,n={};return T(t.fields||{},(function(t,r){n[t]=e.J_(r)})),n},t.prototype.ef=function(t){return new Eu(ue(t.latitude),ue(t.longitude))},t.prototype.nf=function(t){var e=this;return(t.values||[]).map((function(t){return e.J_(t)}))},t.prototype.Z_=function(t){switch(this.z_){case"previous":var e=function t(e){var n=e.mapValue.fields.__previous_value__;return $t(n)?t(n):n}(t);return null==e?null:this.J_(e);case"estimate":return this.X_(Jt(t));default:return null}},t.prototype.X_=function(t){var e=se(t),n=new at(e.seconds,e.nanos);return this.timestampsInSnapshots?n:n.toDate()},t.prototype.tf=function(t){var e=A.P(t);g(He(e));var n=new rt(e.get(1),e.get(3)),r=new D(e.u(5));return n.isEqual(this.U)||p("Document "+r+" contains a document reference within a different database ("+n.projectId+"/"+n.database+") which is not supported. It will be treated as a reference in the current database ("+this.U.projectId+"/"+this.U.database+") instead."),this.H_(r)},t}(),Xu=ui.uo,Yu=function(){function t(t){var e,n,r,i;if(void 0===t.host){if(void 0!==t.ssl)throw new l(a.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else V("settings","non-empty string","host",t.host),this.host=t.host,U("settings","boolean","ssl",t.ssl),this.ssl=null===(e=t.ssl)||void 0===e||e;if(z("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling","ignoreUndefinedProperties"]),U("settings","object","credentials",t.credentials),this.credentials=t.credentials,U("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),U("settings","boolean","ignoreUndefinedProperties",t.ignoreUndefinedProperties),!0===t.timestampsInSnapshots?p("The setting 'timestampsInSnapshots: true' is no longer required and should be removed."):!1===t.timestampsInSnapshots&&p("Support for 'timestampsInSnapshots: false' will be removed soon. You must update your code to handle Timestamp objects."),this.timestampsInSnapshots=null===(n=t.timestampsInSnapshots)||void 0===n||n,this.ignoreUndefinedProperties=null!==(r=t.ignoreUndefinedProperties)&&void 0!==r&&r,U("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=ui.lo;else{if(t.cacheSizeBytes!==Xu&&t.cacheSizeBytes<ui.ho)throw new l(a.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+ui.ho);this.cacheSizeBytes=t.cacheSizeBytes}U("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.experimentalForceLongPolling=null!==(i=t.experimentalForceLongPolling)&&void 0!==i&&i}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},t}(),$u=function(){function t(e,n,i,o){var s=this;if(void 0===i&&(i=new cu),void 0===o&&(o=new fu),this.if=i,this.rf=o,this.af=null,this.cf=new Dr,this.INTERNAL={delete:function(){return r.__awaiter(s,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return this.uf(),[4,this.hf.terminate()];case 1:return t.sent(),[2]}}))}))}},"object"==typeof e.options){var u=e;this.af=u,this.l_=t.lf(u),this._f=u.name,this.ff=new Lo(n)}else{var c=e;if(!c.projectId)throw new l(a.INVALID_ARGUMENT,"Must provide projectId");this.l_=new rt(c.projectId,c.database),this._f="[DEFAULT]",this.ff=new Ro}this.df=new Yu({})}return Object.defineProperty(t.prototype,"wf",{get:function(){return this.mf||(this.mf=new Ou(this.l_,this.df.ignoreUndefinedProperties)),this.mf},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){O("Firestore.settings",arguments,1),C("Firestore.settings","object",1,t),t.merge&&delete(t=Object.assign(Object.assign({},this.df),t)).merge;var e=new Yu(t);if(this.hf&&!this.df.isEqual(e))throw new l(a.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");this.df=e,void 0!==e.credentials&&(this.ff=function(t){if(!t)return new Ro;switch(t.type){case"gapi":var e=t.client;return g(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Po(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new l(a.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},t.prototype.enableNetwork=function(){return this.uf(),this.hf.enableNetwork()},t.prototype.disableNetwork=function(){return this.uf(),this.hf.disableNetwork()},t.prototype.enablePersistence=function(t){var e,n;if(this.hf)throw new l(a.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var r=!1,i=!1;if(t&&(void 0!==t.experimentalTabSynchronization&&p("The 'experimentalTabSynchronization' setting will be removed. Use 'synchronizeTabs' instead."),r=null!==(n=null!==(e=t.synchronizeTabs)&&void 0!==e?e:t.experimentalTabSynchronization)&&void 0!==n&&n,i=!!t.experimentalForceOwningTab&&t.experimentalForceOwningTab,r&&i))throw new l(a.INVALID_ARGUMENT,"The 'experimentalForceOwningTab' setting cannot be used with 'synchronizeTabs'.");return this.Tf(this.if,this.rf,{Wl:!0,cacheSizeBytes:this.df.cacheSizeBytes,synchronizeTabs:r,xa:i})},t.prototype.clearPersistence=function(){return r.__awaiter(this,void 0,void 0,(function(){var t,e=this;return r.__generator(this,(function(n){if(void 0!==this.hf&&!this.hf.G_)throw new l(a.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");return t=new dr,[2,(this.cf.ps((function(){return r.__awaiter(e,void 0,void 0,(function(){var e;return r.__generator(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.if.clearPersistence(this.l_,this._f)];case 1:return n.sent(),t.resolve(),[3,3];case 2:return e=n.sent(),t.reject(e),[3,3];case 3:return[2]}}))}))})),t.promise)]}))}))},t.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(t.prototype,"Ef",{get:function(){return this.uf(),this.hf.G_},enumerable:!1,configurable:!0}),t.prototype.waitForPendingWrites=function(){return this.uf(),this.hf.waitForPendingWrites()},t.prototype.onSnapshotsInSync=function(t){if(this.uf(),Qu(t))return this.hf.K_(t);C("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return this.hf.K_(e)},t.prototype.uf=function(){return this.hf||this.Tf(new cu,new fu,{Wl:!1}),this.hf},t.prototype.If=function(){return new st(this.l_,this._f,this.df.host,this.df.ssl,this.df.experimentalForceLongPolling)},t.prototype.Tf=function(t,e,n){var r=this.If();return this.hf=new Ku(this.ff,this.cf),this.hf.start(r,t,e,n)},t.lf=function(t){if(e=t.options,!Object.prototype.hasOwnProperty.call(e,"projectId"))throw new l(a.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var e,n=t.options.projectId;if(!n||"string"!=typeof n)throw new l(a.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new rt(n)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.af)throw new l(a.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.af},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){return O("Firestore.collection",arguments,1),C("Firestore.collection","non-empty string",1,t),this.uf(),new la(A.P(t),this,null)},t.prototype.doc=function(t){return O("Firestore.doc",arguments,1),C("Firestore.doc","non-empty string",1,t),this.uf(),ta.Af(A.P(t),this,null)},t.prototype.collectionGroup=function(t){if(O("Firestore.collectionGroup",arguments,1),C("Firestore.collectionGroup","non-empty string",1,t),t.indexOf("/")>=0)throw new l(a.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.uf(),new ha(function(t){return new Cn(A.g(),t)}(t),this,null)},t.prototype.runTransaction=function(t){var e=this;return O("Firestore.runTransaction",arguments,1),C("Firestore.runTransaction","function",1,t),this.uf().transaction((function(n){return t(new Ju(e,n))}))},t.prototype.batch=function(){return this.uf(),new Zu(this)},Object.defineProperty(t,"logLevel",{get:function(){switch(v()){case c.LogLevel.DEBUG:return"debug";case c.LogLevel.ERROR:return"error";case c.LogLevel.SILENT:return"silent";case c.LogLevel.WARN:return"warn";case c.LogLevel.INFO:return"info";case c.LogLevel.VERBOSE:return"verbose";default:return"error"}},enumerable:!1,configurable:!0}),t.setLogLevel=function(t){var e;O("Firestore.setLogLevel",arguments,1),j("setLogLevel",["debug","error","silent","warn","info","verbose"],1,t),e=t,d.setLogLevel(e)},t.prototype.Rf=function(){return this.df.timestampsInSnapshots},t.prototype.Pf=function(){return this.df},t}(),Ju=function(){function t(t,e){this.gf=t,this.yf=e}return t.prototype.get=function(t){var e=this;O("Transaction.get",arguments,1);var n=ya("Transaction.get",t,this.gf);return this.yf.b_([n.__]).then((function(t){if(!t||1!==t.length)return _();var r=t[0];if(r instanceof Rn)return new na(e.gf,n.__,null,!1,!1,n.f_);if(r instanceof On)return new na(e.gf,n.__,r,!1,!1,n.f_);throw _()}))},t.prototype.set=function(t,e,n){L("Transaction.set",arguments,2,3);var r=ya("Transaction.set",t,this.gf);n=pa("Transaction.set",n);var i=ma(r.f_,e,n),o=Ru(this.gf.wf,"Transaction.set",r.__,i,null!==r.f_,n);return this.yf.set(r.__,o),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return"string"==typeof e||e instanceof du?(R("Transaction.update",arguments,3),r=ya("Transaction.update",t,this.gf),i=Cu(this.gf.wf,"Transaction.update",r.__,e,n,o)):(O("Transaction.update",arguments,2),r=ya("Transaction.update",t,this.gf),i=Lu(this.gf.wf,"Transaction.update",r.__,e)),this.yf.update(r.__,i),this},t.prototype.delete=function(t){O("Transaction.delete",arguments,1);var e=ya("Transaction.delete",t,this.gf);return this.yf.delete(e.__),this},t}(),Zu=function(){function t(t){this.gf=t,this.Vf=[],this.pf=!1}return t.prototype.set=function(t,e,n){L("WriteBatch.set",arguments,2,3),this.bf();var r=ya("WriteBatch.set",t,this.gf);n=pa("WriteBatch.set",n);var i=ma(r.f_,e,n),o=Ru(this.gf.wf,"WriteBatch.set",r.__,i,null!==r.f_,n);return this.Vf=this.Vf.concat(o.d_(r.__,fn.Ge())),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return this.bf(),"string"==typeof e||e instanceof du?(R("WriteBatch.update",arguments,3),r=ya("WriteBatch.update",t,this.gf),i=Cu(this.gf.wf,"WriteBatch.update",r.__,e,n,o)):(O("WriteBatch.update",arguments,2),r=ya("WriteBatch.update",t,this.gf),i=Lu(this.gf.wf,"WriteBatch.update",r.__,e)),this.Vf=this.Vf.concat(i.d_(r.__,fn.exists(!0))),this},t.prototype.delete=function(t){O("WriteBatch.delete",arguments,1),this.bf();var e=ya("WriteBatch.delete",t,this.gf);return this.Vf=this.Vf.concat(new Nn(e.__,fn.Ge())),this},t.prototype.commit=function(){return this.bf(),this.pf=!0,this.Vf.length>0?this.gf.uf().write(this.Vf):Promise.resolve()},t.prototype.bf=function(){if(this.pf)throw new l(a.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}(),ta=function(t){function e(e,n,r){var i=this;return(i=t.call(this,n.l_,e,r)||this).__=e,i.firestore=n,i.f_=r,i.hf=i.firestore.uf(),i}return r.__extends(e,t),e.Af=function(t,n,r){if(t.length%2!=0)throw new l(a.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.R()+" has "+t.length);return new e(new D(t),n,r)},Object.defineProperty(e.prototype,"id",{get:function(){return this.__.path._()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return new la(this.__.path.h(),this.firestore,this.f_)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this.__.path.R()},enumerable:!1,configurable:!0}),e.prototype.collection=function(t){if(O("DocumentReference.collection",arguments,1),C("DocumentReference.collection","non-empty string",1,t),!t)throw new l(a.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=A.P(t);return new la(this.__.path.child(e),this.firestore,null)},e.prototype.isEqual=function(t){if(!(t instanceof e))throw W("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this.__.isEqual(t.__)&&this.f_===t.f_},e.prototype.set=function(t,e){L("DocumentReference.set",arguments,1,2),e=pa("DocumentReference.set",e);var n=ma(this.f_,t,e),r=Ru(this.firestore.wf,"DocumentReference.set",this.__,n,null!==this.f_,e);return this.hf.write(r.d_(this.__,fn.Ge()))},e.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return"string"==typeof t||t instanceof du?(R("DocumentReference.update",arguments,2),n=Cu(this.firestore.wf,"DocumentReference.update",this.__,t,e,r)):(O("DocumentReference.update",arguments,1),n=Lu(this.firestore.wf,"DocumentReference.update",this.__,t)),this.hf.write(n.d_(this.__,fn.exists(!0)))},e.prototype.delete=function(){return O("DocumentReference.delete",arguments,0),this.hf.write([new Nn(this.__,fn.Ge())])},e.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];L("DocumentReference.onSnapshot",arguments,1,4);var s={includeMetadataChanges:!1},u=0;"object"!=typeof i[u]||Qu(i[u])||(z("DocumentReference.onSnapshot",s=i[u],["includeMetadataChanges"]),U("DocumentReference.onSnapshot","boolean","includeMetadataChanges",s.includeMetadataChanges),u++);var a={includeMetadataChanges:s.includeMetadataChanges};if(Qu(i[u])){var c=i[u];i[u]=null===(t=c.next)||void 0===t?void 0:t.bind(c),i[u+1]=null===(e=c.error)||void 0===e?void 0:e.bind(c),i[u+2]=null===(n=c.complete)||void 0===n?void 0:n.bind(c)}else C("DocumentReference.onSnapshot","function",u,i[u]),P("DocumentReference.onSnapshot","function",u+1,i[u+1]),P("DocumentReference.onSnapshot","function",u+2,i[u+2]);var h={next:function(t){i[u]&&i[u](r.vf(t))},error:i[u+1],complete:i[u+2]};return this.hf.listen(Vn(this.__.path),a,h)},e.prototype.get=function(t){var e=this;L("DocumentReference.get",arguments,0,1),va("DocumentReference.get",t);var n=this.firestore.uf();return t&&"cache"===t.source?n.U_(this.__).then((function(t){return new na(e.firestore,e.__,t,!0,t instanceof On&&t.Ye,e.f_)})):n.Q_(this.__,t).then((function(t){return e.vf(t)}))},e.prototype.withConverter=function(t){return new e(this.__,this.firestore,t)},e.prototype.vf=function(t){var e=t.docs.get(this.__);return new na(this.firestore,this.__,e,t.fromCache,t.hasPendingWrites,this.f_)},e}(Au),ea=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),na=function(){function t(t,e,n,r,i,o){this.gf=t,this.__=e,this.Sf=n,this.Df=r,this.Cf=i,this.f_=o}return t.prototype.data=function(t){var e=this;if(L("DocumentSnapshot.data",arguments,0,1),t=da("DocumentSnapshot.data",t),this.Sf){if(this.f_){var n=new ra(this.gf,this.__,this.Sf,this.Df,this.Cf,null);return this.f_.fromFirestore(n,t)}return new Hu(this.gf.l_,this.gf.Rf(),t.serverTimestamps||"none",(function(t){return new ta(t,e.gf,null)}),(function(t){return new ot(t)})).J_(this.Sf.sn())}},t.prototype.get=function(t,e){var n=this;if(L("DocumentSnapshot.get",arguments,1,2),e=da("DocumentSnapshot.get",e),this.Sf){var r=this.Sf.data().field(Fu("DocumentSnapshot.get",t,this.__));if(null!==r)return new Hu(this.gf.l_,this.gf.Rf(),e.serverTimestamps||"none",(function(t){return new ta(t,n.gf,n.f_)}),(function(t){return new ot(t)})).J_(r)}},Object.defineProperty(t.prototype,"id",{get:function(){return this.__.path._()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new ta(this.__,this.gf,this.f_)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return null!==this.Sf},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return new ea(this.Cf,this.Df)},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){if(!(e instanceof t))throw W("isEqual","DocumentSnapshot",1,e);return this.gf===e.gf&&this.Df===e.Df&&this.__.isEqual(e.__)&&(null===this.Sf?null===e.Sf:this.Sf.isEqual(e.Sf))&&this.f_===e.f_},t}(),ra=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r.__extends(e,t),e.prototype.data=function(e){return t.prototype.data.call(this,e)},e}(na);function ia(t,e,n,r,i,o,s){var u;if(i.p()){if("array-contains"===o||"array-contains-any"===o)throw new l(a.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){ua(s,o);for(var c=[],h=0,f=s;h<f.length;h++){var p=f[h];c.push(sa(r,t,p))}u={arrayValue:{values:c}}}else u=sa(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||ua(s,o),u=Pu(n,e,s,"in"===o||"not-in"===o);var d=Jn.create(i,o,u);return function(t,e){if(e.un()){var n=Fn(t);if(null!==n&&!n.isEqual(e.field))throw new l(a.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=jn(t);null!==r&&aa(t,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw i===e.op?new l(a.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new l(a.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,d),d}function oa(t,e,n){if(null!==t.startAt)throw new l(a.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new l(a.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new fr(e,n);return function(t,e){if(null===jn(t)){var n=Fn(t);null!==n&&aa(t,n,e.field)}}(t,r),r}function sa(t,e,n){if("string"==typeof n){if(""===n)throw new l(a.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!qn(e)&&-1!==n.indexOf("/"))throw new l(a.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(A.P(n));if(!D.F(r))throw new l(a.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return ce(t,new D(r))}if(n instanceof Au)return ce(t,n.__);throw new l(a.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+G(n)+".")}function ua(t,e){if(!Array.isArray(t)||0===t.length)throw new l(a.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new l(a.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if("in"===e||"array-contains-any"===e){if(t.indexOf(null)>=0)throw new l(a.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(t.filter((function(t){return Number.isNaN(t)})).length>0)throw new l(a.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")}}function aa(t,e,n){if(!n.isEqual(e))throw new l(a.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}function ca(t){if(Mn(t)&&0===t.rn.length)throw new l(a.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var ha=function(){function t(t,e,n){this.Nf=t,this.firestore=e,this.f_=n}return t.prototype.where=function(e,n,r){O("Query.where",arguments,3),q("Query.where",3,r);var i=j("Query.where",["<","<=","==","!=",">=",">","array-contains","in","array-contains-any","not-in"],2,n),o=Fu("Query.where",e),s=ia(this.Nf,"Query.where",this.firestore.wf,this.firestore.l_,o,i,r);return new t(function(t,e){var n=t.filters.concat([e]);return new Cn(t.path,t.collectionGroup,t.rn.slice(),n,t.limit,t.on,t.startAt,t.endAt)}(this.Nf,s),this.firestore,this.f_)},t.prototype.orderBy=function(e,n){var r;if(L("Query.orderBy",arguments,1,2),P("Query.orderBy","non-empty string",2,n),void 0===n||"asc"===n)r="asc";else{if("desc"!==n)throw new l(a.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+n+"', expected 'asc' or 'desc'.");r="desc"}var i=Fu("Query.orderBy",e),o=oa(this.Nf,i,r);return new t(function(t,e){var n=t.rn.concat([e]);return new Cn(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.on,t.startAt,t.endAt)}(this.Nf,o),this.firestore,this.f_)},t.prototype.limit=function(e){return O("Query.limit",arguments,1),C("Query.limit","number",1,e),K("Query.limit",1,e),new t(zn(this.Nf,e,"F"),this.firestore,this.f_)},t.prototype.limitToLast=function(e){return O("Query.limitToLast",arguments,1),C("Query.limitToLast","number",1,e),K("Query.limitToLast",1,e),new t(zn(this.Nf,e,"L"),this.firestore,this.f_)},t.prototype.startAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];R("Query.startAt",arguments,1);var i=this.Ff("Query.startAt",e,n,!0);return new t(Wn(this.Nf,i),this.firestore,this.f_)},t.prototype.startAfter=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];R("Query.startAfter",arguments,1);var i=this.Ff("Query.startAfter",e,n,!1);return new t(Wn(this.Nf,i),this.firestore,this.f_)},t.prototype.endBefore=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];R("Query.endBefore",arguments,1);var i=this.Ff("Query.endBefore",e,n,!0);return new t(Kn(this.Nf,i),this.firestore,this.f_)},t.prototype.endAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];R("Query.endAt",arguments,1);var i=this.Ff("Query.endAt",e,n,!1);return new t(Kn(this.Nf,i),this.firestore,this.f_)},t.prototype.isEqual=function(e){if(!(e instanceof t))throw W("isEqual","Query",1,e);return this.firestore===e.firestore&&Qn(this.Nf,e.Nf)&&this.f_===e.f_},t.prototype.withConverter=function(e){return new t(this.Nf,this.firestore,e)},t.prototype.Ff=function(t,e,n,i){if(q(t,1,e),e instanceof na)return O(t,r.__spreadArrays([e],n),1),function(t,e,n,r,i){if(!r)throw new l(a.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,u=Bn(t);s<u.length;s++){var c=u[s];if(c.field.p())o.push(ce(e,r.key));else{var h=r.field(c.field);if($t(h))throw new l(a.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+c.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===h){var f=c.field.R();throw new l(a.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+f+"' (used as the orderBy) does not exist.")}o.push(h)}}return new ur(o,i)}(this.Nf,this.firestore.l_,t,e.Sf,i);var o=[e].concat(n);return function(t,e,n,r,i,o){var s=t.rn;if(i.length>s.length)throw new l(a.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var u=[],c=0;c<i.length;c++){var h=i[c];if(s[c].field.p()){if("string"!=typeof h)throw new l(a.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof h);if(!qn(t)&&-1!==h.indexOf("/"))throw new l(a.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+h+"' contains a slash.");var f=t.path.child(A.P(h));if(!D.F(f))throw new l(a.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+f+"' is not because it contains an odd number of segments.");var p=new D(f);u.push(ce(e,p))}else{var d=Pu(n,r,h);u.push(d)}}return new ur(u,o)}(this.Nf,this.firestore.l_,this.firestore.wf,t,o,i)},t.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];L("Query.onSnapshot",arguments,1,4);var s={},u=0;if("object"!=typeof i[u]||Qu(i[u])||(z("Query.onSnapshot",s=i[u],["includeMetadataChanges"]),U("Query.onSnapshot","boolean","includeMetadataChanges",s.includeMetadataChanges),u++),Qu(i[u])){var a=i[u];i[u]=null===(t=a.next)||void 0===t?void 0:t.bind(a),i[u+1]=null===(e=a.error)||void 0===e?void 0:e.bind(a),i[u+2]=null===(n=a.complete)||void 0===n?void 0:n.bind(a)}else C("Query.onSnapshot","function",u,i[u]),P("Query.onSnapshot","function",u+1,i[u+1]),P("Query.onSnapshot","function",u+2,i[u+2]);var c={next:function(t){i[u]&&i[u](new fa(r.firestore,r.Nf,t,r.f_))},error:i[u+1],complete:i[u+2]};return ca(this.Nf),this.firestore.uf().listen(this.Nf,s,c)},t.prototype.get=function(t){var e=this;L("Query.get",arguments,0,1),va("Query.get",t),ca(this.Nf);var n=this.firestore.uf();return(t&&"cache"===t.source?n.W_(this.Nf):n.j_(this.Nf,t)).then((function(t){return new fa(e.firestore,e.Nf,t,e.f_)}))},t}(),fa=function(){function t(t,e,n,r){this.gf=t,this.$f=e,this.xf=n,this.f_=r,this.kf=null,this.Mf=null,this.metadata=new ea(n.hasPendingWrites,n.fromCache)}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this.xf.docs.m()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this.xf.docs.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;L("QuerySnapshot.forEach",arguments,1,2),C("QuerySnapshot.forEach","function",1,t),this.xf.docs.forEach((function(r){t.call(e,n.Of(r,n.metadata.fromCache,n.xf.Qt.has(r.key)))}))},Object.defineProperty(t.prototype,"query",{get:function(){return new ha(this.$f,this.gf,this.f_)},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){t&&(z("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),U("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this.xf.jt)throw new l(a.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.kf&&this.Mf===e||(this.kf=function(t,e,n){if(t.Ut.m()){var r=0;return t.docChanges.map((function(e){var i=n(e.doc,t.fromCache,t.Qt.has(e.doc.key));return e.doc,{type:"added",doc:i,oldIndex:-1,newIndex:r++}}))}var i=t.Ut;return t.docChanges.filter((function(t){return e||3!==t.type})).map((function(e){var r=n(e.doc,t.fromCache,t.Qt.has(e.doc.key)),o=-1,s=-1;return 0!==e.type&&(o=i.indexOf(e.doc.key),i=i.delete(e.doc.key)),1!==e.type&&(s=(i=i.add(e.doc)).indexOf(e.doc.key)),{type:ga(e.type),doc:r,oldIndex:o,newIndex:s}}))}(this.xf,e,this.Of.bind(this)),this.Mf=e),this.kf},t.prototype.isEqual=function(e){if(!(e instanceof t))throw W("isEqual","QuerySnapshot",1,e);return this.gf===e.gf&&Qn(this.$f,e.$f)&&this.xf.isEqual(e.xf)&&this.f_===e.f_},t.prototype.Of=function(t,e,n){return new ra(this.gf,t.key,t,e,n,this.f_)},t}(),la=function(t){function e(e,n,r){var i=this;if((i=t.call(this,Vn(e),n,r)||this).Lf=e,e.length%2!=1)throw new l(a.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+e.R()+" has "+e.length);return i}return r.__extends(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this.Nf.path._()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this.Nf.path.h();return t.m()?null:new ta(new D(t),this.firestore,null)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this.Nf.path.R()},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){L("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=Y.k()),C("CollectionReference.doc","non-empty string",1,t);var e=A.P(t);return ta.Af(this.Nf.path.child(e),this.firestore,this.f_)},e.prototype.add=function(t){O("CollectionReference.add",arguments,1);var e=this.f_?this.f_.toFirestore(t):t;C("CollectionReference.add","object",1,e);var n=this.doc();return new ta(n.__,this.firestore,null).set(e).then((function(){return n}))},e.prototype.withConverter=function(t){return new e(this.Lf,this.firestore,t)},e}(ha);function pa(t,e){if(void 0===e)return{merge:!1};if(z(t,e,["merge","mergeFields"]),U(t,"boolean","merge",e.merge),function(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new l(a.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+G(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new l(a.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be a string or a FieldPath, but the value at index "+o+" was: "+G(r[o]))}(t,"mergeFields",0,r,(function(t){return"string"==typeof t||t instanceof du}))}(t,0,0,e.mergeFields),void 0!==e.mergeFields&&void 0!==e.merge)throw new l(a.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function da(t,e){return void 0===e?{}:(z(t,e,["serverTimestamps"]),M(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function va(t,e){P(t,"object",1,e),e&&(z(t,e,["source"]),M(t,0,"source",e.source,["default","server","cache"]))}function ya(t,e,n){if(e instanceof Au){if(e.firestore!==n)throw new l(a.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw W(t,"DocumentReference",1,e)}function ga(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return _()}}function ma(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var wa=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r.__extends(e,t),e.serverTimestamp=function(){k("FieldValue.serverTimestamp",arguments);var t=new wu("serverTimestamp");return t.t_="FieldValue.serverTimestamp",new e(t)},e.delete=function(){k("FieldValue.delete",arguments);var t=new gu("deleteField");return t.t_="FieldValue.delete",new e(t)},e.arrayUnion=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];R("FieldValue.arrayUnion",arguments,1);var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return R("arrayUnion()",arguments,1),new bu("arrayUnion",t)}.apply(void 0,t);return r.t_="FieldValue.arrayUnion",new e(r)},e.arrayRemove=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];R("FieldValue.arrayRemove",arguments,1);var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return R("arrayRemove()",arguments,1),new _u("arrayRemove",t)}.apply(void 0,t);return r.t_="FieldValue.arrayRemove",new e(r)},e.increment=function(t){C("FieldValue.increment","number",1,t),O("FieldValue.increment",arguments,1);var n=function(t){return new Iu("increment",t)}(t);return n.t_="FieldValue.increment",new e(n)},e.prototype.isEqual=function(t){return this.h_.isEqual(t.h_)},e}(Tu),ba={Firestore:$u,GeoPoint:Eu,Timestamp:at,Blob:ot,Transaction:Ju,WriteBatch:Zu,DocumentReference:ta,DocumentSnapshot:na,Query:ha,QueryDocumentSnapshot:ra,QuerySnapshot:fa,CollectionReference:la,FieldPath:du,FieldValue:wa,setLogLevel:$u.setLogLevel,CACHE_SIZE_UNLIMITED:Xu};function _a(t){!function(t,e){t.INTERNAL.registerComponent(new f.Component("firestore",(function(t){return function(t,e){var n=new fu,r=new hu(n);return new $u(t,e,r,n)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))}),"PUBLIC").setServiceProps(Object.assign({},ba)))}(t),t.registerVersion("@firebase/firestore","1.17.3")}_a(u.default),e.__PRIVATE_registerFirestore=_a}).call(this,n(117))},255:function(t,e,n){"use strict";n.r(e),function(t){n.d(e,"ErrorCode",(function(){return sr})),n.d(e,"EventType",(function(){return ur})),n.d(e,"WebChannel",(function(){return ar})),n.d(e,"XhrIo",(function(){return cr})),n.d(e,"createWebChannelTransport",(function(){return or}));var r=function(t,b){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,b){t.__proto__=b}||function(t,b){for(var p in b)b.hasOwnProperty(p)&&(t[p]=b[p])})(t,b)};function o(t){var s="function"==typeof Symbol&&Symbol.iterator,e=s&&t[s],i=0;if(e)return e.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")}var g,c="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},h=h||{},f=c||self;function l(){}function d(a){var b=typeof a;return"object"!=b?b:a?Array.isArray(a)?"array":b:"null"}function v(a){var b=d(a);return"array"==b||"object"==b&&"number"==typeof a.length}function y(a){var b=typeof a;return"object"==b&&null!=a||"function"==b}var m="closure_uid_"+(1e9*Math.random()>>>0),w=0;function _(a,b,t){return a.call.apply(a.bind,arguments)}function I(a,b,t){if(!a)throw Error();if(2<arguments.length){var e=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,e),a.apply(b,t)}}return function(){return a.apply(b,arguments)}}function p(a,b,t){return(p=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?_:I).apply(null,arguments)}function E(a,b){var t=Array.prototype.slice.call(arguments,1);return function(){var e=t.slice();return e.push.apply(e,arguments),a.apply(this,e)}}var q=Date.now;function T(a,b){function t(){}t.prototype=b.prototype,a.S=b.prototype,a.prototype=new t,a.prototype.constructor=a}function u(){this.j=this.j,this.i=this.i}u.prototype.j=!1,u.prototype.ja=function(){if(!this.j&&(this.j=!0,this.G(),0))(function(a){Object.prototype.hasOwnProperty.call(a,m)&&a[m]||(a[m]=++w)})(this)},u.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var N=Array.prototype.indexOf?function(a,b){return Array.prototype.indexOf.call(a,b,void 0)}:function(a,b){if("string"==typeof a)return"string"!=typeof b||1!=b.length?-1:a.indexOf(b,0);for(var t=0;t<a.length;t++)if(t in a&&a[t]===b)return t;return-1},A=Array.prototype.forEach?function(a,b,t){Array.prototype.forEach.call(a,b,t)}:function(a,b,t){for(var e=a.length,n="string"==typeof a?a.split(""):a,r=0;r<e;r++)r in n&&b.call(t,n[r],r,a)};function S(a){return Array.prototype.concat.apply([],arguments)}function x(a){var b=a.length;if(0<b){for(var t=Array(b),e=0;e<b;e++)t[e]=a[e];return t}return[]}function D(a){return/^[\s\xa0]*$/.test(a)}var k,O=String.prototype.trim?function(a){return a.trim()}:function(a){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(a)[1]};function R(a,b){return-1!=a.indexOf(b)}function L(a,b){return a<b?-1:a>b?1:0}t:{var C=f.navigator;if(C){var P=C.userAgent;if(P){k=P;break t}}k=""}function V(a,b,t){for(var e in a)b.call(t,a[e],e,a)}function U(a){var b={};for(var t in a)b[t]=a[t];return b}var M="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function j(a,b){for(var t,e,n=1;n<arguments.length;n++){for(t in e=arguments[n])a[t]=e[t];for(var r=0;r<M.length;r++)t=M[r],Object.prototype.hasOwnProperty.call(e,t)&&(a[t]=e[t])}}function F(a){return F[" "](a),a}F[" "]=l;var B,a,G=R(k,"Opera"),z=R(k,"Trident")||R(k,"MSIE"),W=R(k,"Edge"),K=W||z,Q=R(k,"Gecko")&&!(R(k.toLowerCase(),"webkit")&&!R(k,"Edge"))&&!(R(k,"Trident")||R(k,"MSIE"))&&!R(k,"Edge"),H=R(k.toLowerCase(),"webkit")&&!R(k,"Edge");function X(){var a=f.document;return a?a.documentMode:void 0}t:{var Y="",$=(a=k,Q?/rv:([^\);]+)(\)|;)/.exec(a):W?/Edge\/([\d\.]+)/.exec(a):z?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a):H?/WebKit\/(\S+)/.exec(a):G?/(?:Version)[ \/]?(\S+)/.exec(a):void 0);if($&&(Y=$?$[1]:""),z){var J=X();if(null!=J&&J>parseFloat(Y)){B=String(J);break t}}B=Y}var Z,tt={};function et(a){return function(a,b){var t=tt;return Object.prototype.hasOwnProperty.call(t,a)?t[a]:t[a]=b(a)}(a,(function(){for(var b=0,t=O(String(B)).split("."),e=O(String(a)).split("."),n=Math.max(t.length,e.length),r=0;0==b&&r<n;r++){var o=t[r]||"",c=e[r]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],c=/(\d*)(\D*)(.*)/.exec(c)||["","","",""],0==o[0].length&&0==c[0].length)break;b=L(0==o[1].length?0:parseInt(o[1],10),0==c[1].length?0:parseInt(c[1],10))||L(0==o[2].length,0==c[2].length)||L(o[2],c[2]),o=o[3],c=c[3]}while(0==b)}return 0<=b}))}if(f.document&&z){var nt=X();Z=nt||(parseInt(B,10)||void 0)}else Z=void 0;var it=Z,ot=!z||9<=Number(it),st=z&&!et("9"),ut=function(){if(!f.addEventListener||!Object.defineProperty)return!1;var a=!1,b=Object.defineProperty({},"passive",{get:function(){a=!0}});try{f.addEventListener("test",l,b),f.removeEventListener("test",l,b)}catch(t){}return a}();function at(a,b){this.type=a,this.a=this.target=b,this.defaultPrevented=!1}function ct(a,b){if(at.call(this,a?a.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,a){var t=this.type=a.type,e=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.a=b,b=a.relatedTarget){if(Q){t:{try{F(b.nodeName);var n=!0;break t}catch(t){}n=!1}n||(b=null)}}else"mouseover"==t?b=a.fromElement:"mouseout"==t&&(b=a.toElement);this.relatedTarget=b,e?(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0):(this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType="string"==typeof a.pointerType?a.pointerType:ht[a.pointerType]||"",this.c=a,a.defaultPrevented&&this.b()}}at.prototype.b=function(){this.defaultPrevented=!0},T(ct,at);var ht={2:"touch",3:"pen",4:"mouse"};ct.prototype.b=function(){ct.S.b.call(this);var a=this.c;if(a.preventDefault)a.preventDefault();else if(a.returnValue=!1,st)try{(a.ctrlKey||112<=a.keyCode&&123>=a.keyCode)&&(a.keyCode=-1)}catch(t){}};var ft="closure_listenable_"+(1e6*Math.random()|0),lt=0;function pt(a,b,t,e,n){this.listener=a,this.proxy=null,this.src=b,this.type=t,this.capture=!!e,this.ca=n,this.key=++lt,this.Y=this.Z=!1}function vt(a){a.Y=!0,a.listener=null,a.proxy=null,a.src=null,a.ca=null}function yt(a){this.src=a,this.a={},this.b=0}function gt(a,b){var t=b.type;if(t in a.a){var e,n=a.a[t],r=N(n,b);(e=0<=r)&&Array.prototype.splice.call(n,r,1),e&&(vt(b),0==a.a[t].length&&(delete a.a[t],a.b--))}}function mt(a,b,t,e){for(var n=0;n<a.length;++n){var r=a[n];if(!r.Y&&r.listener==b&&r.capture==!!t&&r.ca==e)return n}return-1}yt.prototype.add=function(a,b,t,e,n){var r=a.toString();(a=this.a[r])||(a=this.a[r]=[],this.b++);var o=mt(a,b,e,n);return-1<o?(b=a[o],t||(b.Z=!1)):((b=new pt(b,this.src,r,!!e,n)).Z=t,a.push(b)),b};var wt="closure_lm_"+(1e6*Math.random()|0),bt={};function _t(a,b,t,e,n){if(e&&e.once)return function t(a,b,e,n,r){if(Array.isArray(b)){for(var o=0;o<b.length;o++)t(a,b[o],e,n,r);return null}return e=Dt(e),a&&a[ft]?a.wa(b,e,y(n)?!!n.capture:!!n,r):It(a,b,e,!0,n,r)}(a,b,t,e,n);if(Array.isArray(b)){for(var r=0;r<b.length;r++)_t(a,b[r],t,e,n);return null}return t=Dt(t),a&&a[ft]?a.va(b,t,y(e)?!!e.capture:!!e,n):It(a,b,t,!1,e,n)}function It(a,b,t,e,n,r){if(!b)throw Error("Invalid event type");var o=y(n)?!!n.capture:!!n;if(o&&!ot)return null;var c=St(a);if(c||(a[wt]=c=new yt(a)),(t=c.add(b,t,e,o,r)).proxy)return t;if(e=function(){var a=At,b=ot?function(t){return a.call(b.src,b.listener,t)}:function(t){if(!(t=a.call(b.src,b.listener,t)))return t};return b}(),t.proxy=e,e.src=a,e.listener=t,a.addEventListener)ut||(n=o),void 0===n&&(n=!1),a.addEventListener(b.toString(),e,n);else if(a.attachEvent)a.attachEvent(Tt(b.toString()),e);else{if(!a.addListener||!a.removeListener)throw Error("addEventListener and attachEvent are unavailable.");a.addListener(e)}return t}function Et(a){if("number"!=typeof a&&a&&!a.Y){var b=a.src;if(b&&b[ft])gt(b.c,a);else{var t=a.type,e=a.proxy;b.removeEventListener?b.removeEventListener(t,e,a.capture):b.detachEvent?b.detachEvent(Tt(t),e):b.addListener&&b.removeListener&&b.removeListener(e),(t=St(b))?(gt(t,a),0==t.b&&(t.src=null,b[wt]=null)):vt(a)}}}function Tt(a){return a in bt?bt[a]:bt[a]="on"+a}function Nt(a,b){var t=a.listener,e=a.ca||a.src;return a.Z&&Et(a),t.call(e,b)}function At(a,b){if(a.Y)return!0;if(!ot){if(!b)t:{b=["window","event"];for(var t=f,e=0;e<b.length;e++)if(null==(t=t[b[e]])){b=null;break t}b=t}return Nt(a,b=new ct(b,this))}return Nt(a,new ct(b,this))}function St(a){return(a=a[wt])instanceof yt?a:null}var xt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Dt(a){return"function"==d(a)?a:(a[xt]||(a[xt]=function(b){return a.handleEvent(b)}),a[xt])}function kt(){u.call(this),this.c=new yt(this),this.J=this,this.C=null}function Ot(a,b,t,e){if(!(b=a.c.a[String(b)]))return!0;b=b.concat();for(var n=!0,r=0;r<b.length;++r){var o=b[r];if(o&&!o.Y&&o.capture==t){var c=o.listener,h=o.ca||o.src;o.Z&&gt(a.c,o),n=!1!==c.call(h,e)&&n}}return n&&!e.defaultPrevented}T(kt,u),kt.prototype[ft]=!0,(g=kt.prototype).addEventListener=function(a,b,t,e){_t(this,a,b,t,e)},g.removeEventListener=function(a,b,t,e){!function t(a,b,e,n,r){if(Array.isArray(b))for(var o=0;o<b.length;o++)t(a,b[o],e,n,r);else n=y(n)?!!n.capture:!!n,e=Dt(e),a&&a[ft]?(a=a.c,(b=String(b).toString())in a.a&&(-1<(e=mt(o=a.a[b],e,n,r))&&(vt(o[e]),Array.prototype.splice.call(o,e,1),0==o.length&&(delete a.a[b],a.b--)))):a&&(a=St(a))&&(b=a.a[b.toString()],a=-1,b&&(a=mt(b,e,n,r)),(e=-1<a?b[a]:null)&&Et(e))}(this,a,b,t,e)},g.dispatchEvent=function(a){var b,t=this.C;if(t)for(b=[];t;t=t.C)b.push(t);t=this.J;var e=a.type||a;if("string"==typeof a)a=new at(a,t);else if(a instanceof at)a.target=a.target||t;else{var n=a;j(a=new at(e,t),n)}if(n=!0,b)for(var r=b.length-1;0<=r;r--){var o=a.a=b[r];n=Ot(o,e,!0,a)&&n}if(n=Ot(o=a.a=t,e,!0,a)&&n,n=Ot(o,e,!1,a)&&n,b)for(r=0;r<b.length;r++)n=Ot(o=a.a=b[r],e,!1,a)&&n;return n},g.G=function(){if(kt.S.G.call(this),this.c){var t,a=this.c;for(t in a.a){for(var e=a.a[t],n=0;n<e.length;n++)vt(e[n]);delete a.a[t],a.b--}}this.C=null},g.va=function(a,b,t,e){return this.c.add(String(a),b,!1,t,e)},g.wa=function(a,b,t,e){return this.c.add(String(a),b,!0,t,e)};var Rt=f.JSON.stringify;function Lt(){this.b=this.a=null}var Ct,Pt=new(function(){function t(a,b,t){this.f=t,this.c=a,this.g=b,this.b=0,this.a=null}return t.prototype.get=function(){var a;return 0<this.b?(this.b--,a=this.a,this.a=a.next,a.next=null):a=this.c(),a},t}())((function(){return new Ut}),(function(a){a.reset()}),100);function Vt(){var a=qt,b=null;return a.a&&(b=a.a,a.a=a.a.next,a.a||(a.b=null),b.next=null),b}function Ut(){this.next=this.b=this.a=null}function Mt(a){f.setTimeout((function(){throw a}),0)}function jt(a,b){Ct||function(){var a=f.Promise.resolve(void 0);Ct=function(){a.then(Bt)}}(),Ft||(Ct(),Ft=!0),qt.add(a,b)}Lt.prototype.add=function(a,b){var t=Pt.get();t.set(a,b),this.b?this.b.next=t:this.a=t,this.b=t},Ut.prototype.set=function(a,b){this.a=a,this.b=b,this.next=null},Ut.prototype.reset=function(){this.next=this.b=this.a=null};var Ft=!1,qt=new Lt;function Bt(){for(var a;a=Vt();){try{a.a.call(a.b)}catch(t){Mt(t)}var b=Pt;b.g(a),b.b<b.f&&(b.b++,a.next=b.a,b.a=a)}Ft=!1}function Gt(a,b){kt.call(this),this.b=a||1,this.a=b||f,this.f=p(this.Ya,this),this.g=q()}function zt(a){a.aa=!1,a.M&&(a.a.clearTimeout(a.M),a.M=null)}function Wt(a,b,t){if("function"==d(a))t&&(a=p(a,t));else{if(!a||"function"!=typeof a.handleEvent)throw Error("Invalid listener argument");a=p(a.handleEvent,a)}return 2147483647<Number(b)?-1:f.setTimeout(a,b||0)}function Kt(a){a.a=Wt((function(){a.a=null,a.c&&(a.c=!1,Kt(a))}),a.h);var b=a.b;a.b=null,a.g.apply(null,b)}T(Gt,kt),(g=Gt.prototype).aa=!1,g.M=null,g.Ya=function(){if(this.aa){var a=q()-this.g;0<a&&a<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-a):(this.M&&(this.a.clearTimeout(this.M),this.M=null),this.dispatchEvent("tick"),this.aa&&(zt(this),this.start()))}},g.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=q())},g.G=function(){Gt.S.G.call(this),zt(this),delete this.a};var Qt=function(t){function e(a,b,e){var n=t.call(this)||this;return n.g=null!=e?a.bind(e):a,n.h=b,n.b=null,n.c=!1,n.a=null,n}return function(t,b){function e(){this.constructor=t}r(t,b),t.prototype=null===b?Object.create(b):(e.prototype=b.prototype,new e)}(e,t),e.prototype.f=function(a){this.b=arguments,this.a?this.c=!0:Kt(this)},e.prototype.G=function(){t.prototype.G.call(this),this.a&&(f.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},e}(u);function Ht(a){u.call(this),this.b=a,this.a={}}T(Ht,u);var Xt=[];function Yt(a,b,t,e){Array.isArray(t)||(t&&(Xt[0]=t.toString()),t=Xt);for(var n=0;n<t.length;n++){var r=_t(b,t[n],e||a.handleEvent,!1,a.b||a);if(!r)break;a.a[r.key]=r}}function $t(a){V(a.a,(function(b,t){this.a.hasOwnProperty(t)&&Et(b)}),a),a.a={}}function Jt(){this.a=!0}function Zt(a,b,t,e){a.info((function(){return"XMLHTTP TEXT ("+b+"): "+function(a,b){if(!a.a)return b;if(!b)return null;try{var t=JSON.parse(b);if(t)for(a=0;a<t.length;a++)if(Array.isArray(t[a])){var e=t[a];if(!(2>e.length)){var n=e[1];if(Array.isArray(n)&&!(1>n.length)){var r=n[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<n.length;o++)n[o]=""}}}return Rt(t)}catch(t){return b}}(a,t)+(e?" "+e:"")}))}Ht.prototype.G=function(){Ht.S.G.call(this),$t(this)},Ht.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Jt.prototype.info=function(){};var te=null;function ee(){return te=te||new kt}function ne(a){at.call(this,"serverreachability",a)}function re(a){var b=ee();b.dispatchEvent(new ne(b,a))}function ie(a){at.call(this,"statevent",a)}function oe(a){var b=ee();b.dispatchEvent(new ie(b,a))}function se(a){at.call(this,"timingevent",a)}function ue(a,b){if("function"!=d(a))throw Error("Fn must not be null and must be a function");return f.setTimeout((function(){a()}),b)}T(ne,at),T(ie,at),T(se,at);var ae={NO_ERROR:0,Za:1,gb:2,fb:3,bb:4,eb:5,hb:6,Da:7,TIMEOUT:8,kb:9},ce={ab:"complete",ob:"success",Ea:"error",Da:"abort",mb:"ready",nb:"readystatechange",TIMEOUT:"timeout",ib:"incrementaldata",lb:"progress",cb:"downloadprogress",pb:"uploadprogress"};function he(){}function fe(a){var b;return(b=a.a)||(b=a.a={}),b}function le(){}he.prototype.a=null;var pe,de={OPEN:"a",$a:"b",Ea:"c",jb:"d"};function ve(){at.call(this,"d")}function ye(){at.call(this,"c")}function ge(){}function me(a,b,t,e){this.g=a,this.c=b,this.f=t,this.T=e||1,this.J=new Ht(this),this.P=we,a=K?125:void 0,this.R=new Gt(a),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.U=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.W=this.C=this.V=this.I=!1}T(ve,at),T(ye,at),T(ge,he),pe=new ge;var we=45e3,be={},_e={};function Ie(a,b,t){a.H=1,a.i=ze(Me(b)),a.j=t,a.I=!0,Ee(a,null)}function Ee(a,b){a.u=q(),Ae(a),a.l=Me(a.i);var t=a.l,e=a.T;Array.isArray(e)||(e=[String(e)]),nn(t.b,"t",e),a.D=0,a.a=Yn(a.g,a.g.C?b:null),0<a.O&&(a.F=new Qt(p(a.Ca,a,a.a),a.O)),Yt(a.J,a.a,"readystatechange",a.Wa),b=a.B?U(a.B):{},a.j?(a.m||(a.m="POST"),b["Content-Type"]="application/x-www-form-urlencoded",a.a.ba(a.l,a.m,a.j,b)):(a.m="GET",a.a.ba(a.l,a.m,null,b)),re(1),function(a,b,t,e,n,r){a.info((function(){if(a.a)if(r)for(var o="",c=r.split("&"),h=0;h<c.length;h++){var f=c[h].split("=");if(1<f.length){var l=f[0];f=f[1];var d=l.split("_");o=2<=d.length&&"type"==d[1]?o+(l+"=")+f+"&":o+(l+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+e+") [attempt "+n+"]: "+b+"\n"+t+"\n"+o}))}(a.c,a.m,a.l,a.f,a.T,a.j)}function Te(a,b,t){for(var e=!0;!a.A&&a.D<t.length;){var n=Ne(a,t);if(n==_e){4==b&&(a.h=4,oe(14),e=!1),Zt(a.c,a.f,null,"[Incomplete Response]");break}if(n==be){a.h=4,oe(15),Zt(a.c,a.f,t,"[Invalid Chunk]"),e=!1;break}Zt(a.c,a.f,n,null),Oe(a,n)}4==b&&0==t.length&&(a.h=1,oe(16),e=!1),a.b=a.b&&e,e?0<t.length&&!a.W&&(a.W=!0,(b=a.g).a==a&&b.V&&!b.F&&(b.c.info("Great, no buffering proxy detected. Bytes received: "+t.length),Bn(b),b.F=!0)):(Zt(a.c,a.f,t,"[Invalid Chunked Response]"),ke(a),De(a))}function Ne(a,b){var t=a.D,e=b.indexOf("\n",t);return-1==e?_e:(t=Number(b.substring(t,e)),isNaN(t)?be:(e+=1)+t>b.length?_e:(b=b.substr(e,t),a.D=e+t,b))}function Ae(a){a.U=q()+a.P,Se(a,a.P)}function Se(a,b){if(null!=a.o)throw Error("WatchDog timer not null");a.o=ue(p(a.Ua,a),b)}function xe(a){a.o&&(f.clearTimeout(a.o),a.o=null)}function De(a){0==a.g.v||a.A||Wn(a.g,a)}function ke(a){xe(a);var b=a.F;b&&"function"==typeof b.ja&&b.ja(),a.F=null,zt(a.R),$t(a.J),a.a&&(b=a.a,a.a=null,b.abort(),b.ja())}function Oe(a,b){try{var t=a.g;if(0!=t.v&&(t.a==a||hn(t.b,a)))if(t.I=a.N,!a.C&&hn(t.b,a)&&3==t.v){try{var e=t.ka.a.parse(b)}catch(t){e=null}if(Array.isArray(e)&&3==e.length){var n=e;if(0==n[0]){t:if(!t.j){if(t.a){if(!(t.a.u+3e3<a.u))break t;zn(t),Ln(t)}qn(t),oe(18)}}else t.oa=n[1],0<t.oa-t.P&&37500>n[2]&&t.H&&0==t.o&&!t.m&&(t.m=ue(p(t.Ra,t),6e3));if(1>=cn(t.b)&&t.ea){try{t.ea()}catch(t){}t.ea=void 0}}else Qn(t,11)}else if((a.C||t.a==a)&&zn(t),!D(b))for(b=e=t.ka.a.parse(b),e=0;e<b.length;e++)if(n=b[e],t.P=n[0],n=n[1],2==t.v)if("c"==n[0]){t.J=n[1],t.ga=n[2];var r=n[3];null!=r&&(t.ha=r,t.c.info("VER="+t.ha));var o=n[4];null!=o&&(t.pa=o,t.c.info("SVER="+t.pa));var c=n[5];if(null!=c&&"number"==typeof c&&0<c){var h=1.5*c;t.D=h,t.c.info("backChannelRequestTimeoutMs_="+h)}h=t;var f=a.a;if(f){var l=f.a?f.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(l){var d=h.b;!d.a&&(R(l,"spdy")||R(l,"quic")||R(l,"h2"))&&(d.f=d.g,d.a=new Set,d.b&&(fn(d,d.b),d.b=null))}if(h.A){var v=f.a?f.a.getResponseHeader("X-HTTP-Session-Id"):null;v&&(h.na=v,Ge(h.B,h.A,v))}}t.v=3,t.f&&t.f.ta(),t.V&&(t.N=q()-a.u,t.c.info("Handshake RTT: "+t.N+"ms"));var y=a;if((h=t).la=Xn(h,h.C?h.ga:null,h.fa),y.C){ln(h.b,y);var m=y,w=h.D;w&&m.setTimeout(w),m.o&&(xe(m),Ae(m)),h.a=y}else Fn(h);0<t.g.length&&Vn(t)}else"stop"!=n[0]&&"close"!=n[0]||Qn(t,7);else 3==t.v&&("stop"==n[0]||"close"==n[0]?"stop"==n[0]?Qn(t,7):Rn(t):"noop"!=n[0]&&t.f&&t.f.sa(n),t.o=0);re(4)}catch(t){}}function Re(a,b){if(a.forEach&&"function"==typeof a.forEach)a.forEach(b,void 0);else if(v(a)||"string"==typeof a)A(a,b,void 0);else{if(a.L&&"function"==typeof a.L)var t=a.L();else if(a.K&&"function"==typeof a.K)t=void 0;else if(v(a)||"string"==typeof a){t=[];for(var e=a.length,n=0;n<e;n++)t.push(n)}else for(n in t=[],e=0,a)t[e++]=n;n=(e=function(a){if(a.K&&"function"==typeof a.K)return a.K();if("string"==typeof a)return a.split("");if(v(a)){for(var b=[],t=a.length,e=0;e<t;e++)b.push(a[e]);return b}for(e in b=[],t=0,a)b[t++]=a[e];return b}(a)).length;for(var r=0;r<n;r++)b.call(void 0,e[r],t&&t[r],a)}}function Le(a,b){this.b={},this.a=[],this.c=0;var t=arguments.length;if(1<t){if(t%2)throw Error("Uneven number of arguments");for(var e=0;e<t;e+=2)this.set(arguments[e],arguments[e+1])}else if(a)if(a instanceof Le)for(t=a.L(),e=0;e<t.length;e++)this.set(t[e],a.get(t[e]));else for(e in a)this.set(e,a[e])}function Ce(a){if(a.c!=a.a.length){for(var b=0,t=0;b<a.a.length;){var e=a.a[b];Pe(a.b,e)&&(a.a[t++]=e),b++}a.a.length=t}if(a.c!=a.a.length){var n={};for(t=b=0;b<a.a.length;)Pe(n,e=a.a[b])||(a.a[t++]=e,n[e]=1),b++;a.a.length=t}}function Pe(a,b){return Object.prototype.hasOwnProperty.call(a,b)}(g=me.prototype).setTimeout=function(a){this.P=a},g.Wa=function(a){a=a.target;var b=this.F;b&&3==xn(a)?b.f():this.Ca(a)},g.Ca=function(a){try{if(a==this.a)t:{var b=xn(this.a),t=this.a.ua(),e=this.a.X();if(!(3>b||3==b&&!K&&!this.a.$())){this.A||4!=b||7==t||re(8==t||0>=e?3:2),xe(this);var n=this.a.X();this.N=n;var r=this.a.$();if(this.b=200==n,function(a,b,t,e,n,r,o){a.info((function(){return"XMLHTTP RESP ("+e+") [ attempt "+n+"]: "+b+"\n"+t+"\n"+r+" "+o}))}(this.c,this.m,this.l,this.f,this.T,b,n),this.b){if(this.V&&!this.C){e:{if(this.a){var o,c=this.a;if((o=c.a?c.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!D(o)){var h=o;break e}}h=null}if(!h){this.b=!1,this.h=3,oe(12),ke(this),De(this);break t}Zt(this.c,this.f,h,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Oe(this,h)}this.I?(Te(this,b,r),K&&this.b&&3==b&&(Yt(this.J,this.R,"tick",this.Va),this.R.start())):(Zt(this.c,this.f,r,null),Oe(this,r)),4==b&&ke(this),this.b&&!this.A&&(4==b?Wn(this.g,this):(this.b=!1,Ae(this)))}else 400==n&&0<r.indexOf("Unknown SID")?(this.h=3,oe(12)):(this.h=0,oe(13)),ke(this),De(this)}}}catch(t){}},g.Va=function(){if(this.a){var a=xn(this.a),b=this.a.$();this.D<b.length&&(xe(this),Te(this,a,b),this.b&&4!=a&&Ae(this))}},g.cancel=function(){this.A=!0,ke(this)},g.Ua=function(){this.o=null;var a=q();0<=a-this.U?(function(a,b){a.info((function(){return"TIMEOUT: "+b}))}(this.c,this.l),2!=this.H&&(re(3),oe(17)),ke(this),this.h=2,De(this)):Se(this,this.U-a)},(g=Le.prototype).K=function(){Ce(this);for(var a=[],b=0;b<this.a.length;b++)a.push(this.b[this.a[b]]);return a},g.L=function(){return Ce(this),this.a.concat()},g.get=function(a,b){return Pe(this.b,a)?this.b[a]:b},g.set=function(a,b){Pe(this.b,a)||(this.c++,this.a.push(a)),this.b[a]=b},g.forEach=function(a,b){for(var t=this.L(),e=0;e<t.length;e++){var n=t[e],r=this.get(n);a.call(b,r,n,this)}};var Ve=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ue(a,b){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,a instanceof Ue){this.a=void 0!==b?b:a.a,je(this,a.f),this.j=a.j,Fe(this,a.c),qe(this,a.h),this.g=a.g,b=a.b;var t=new Ze;t.c=b.c,b.a&&(t.a=new Le(b.a),t.b=b.b),Be(this,t),this.i=a.i}else a&&(t=String(a).match(Ve))?(this.a=!!b,je(this,t[1]||"",!0),this.j=We(t[2]||""),Fe(this,t[3]||"",!0),qe(this,t[4]),this.g=We(t[5]||"",!0),Be(this,t[6]||"",!0),this.i=We(t[7]||"")):(this.a=!!b,this.b=new Ze(null,this.a))}function Me(a){return new Ue(a)}function je(a,b,t){a.f=t?We(b,!0):b,a.f&&(a.f=a.f.replace(/:$/,""))}function Fe(a,b,t){a.c=t?We(b,!0):b}function qe(a,b){if(b){if(b=Number(b),isNaN(b)||0>b)throw Error("Bad port number "+b);a.h=b}else a.h=null}function Be(a,b,t){b instanceof Ze?(a.b=b,function(a,b){b&&!a.f&&(tn(a),a.c=null,a.a.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(dd(this,e),nn(this,n,t))}),a)),a.f=b}(a.b,a.a)):(t||(b=Ke(b,$e)),a.b=new Ze(b,a.a))}function Ge(a,b,t){a.b.set(b,t)}function ze(a){return Ge(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^q()).toString(36)),a}function We(a,b){return a?b?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function Ke(a,b,t){return"string"==typeof a?(a=encodeURI(a).replace(b,Qe),t&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function Qe(a){return"%"+((a=a.charCodeAt(0))>>4&15).toString(16)+(15&a).toString(16)}Ue.prototype.toString=function(){var a=[],b=this.f;b&&a.push(Ke(b,He,!0),":");var t=this.c;return(t||"file"==b)&&(a.push("//"),(b=this.j)&&a.push(Ke(b,He,!0),"@"),a.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.h)&&a.push(":",String(t))),(t=this.g)&&(this.c&&"/"!=t.charAt(0)&&a.push("/"),a.push(Ke(t,"/"==t.charAt(0)?Ye:Xe,!0))),(t=this.b.toString())&&a.push("?",t),(t=this.i)&&a.push("#",Ke(t,Je)),a.join("")};var He=/[#\/\?@]/g,Xe=/[#\?:]/g,Ye=/[#\?]/g,$e=/[#\?@]/g,Je=/#/g;function Ze(a,b){this.b=this.a=null,this.c=a||null,this.f=!!b}function tn(a){a.a||(a.a=new Le,a.b=0,a.c&&function(a,b){if(a){a=a.split("&");for(var t=0;t<a.length;t++){var e=a[t].indexOf("="),n=null;if(0<=e){var r=a[t].substring(0,e);n=a[t].substring(e+1)}else r=a[t];b(r,n?decodeURIComponent(n.replace(/\+/g," ")):"")}}}(a.c,(function(b,t){a.add(decodeURIComponent(b.replace(/\+/g," ")),t)})))}function dd(a,b){tn(a),b=rn(a,b),Pe(a.a.b,b)&&(a.c=null,a.b-=a.a.get(b).length,Pe((a=a.a).b,b)&&(delete a.b[b],a.c--,a.a.length>2*a.c&&Ce(a)))}function en(a,b){return tn(a),b=rn(a,b),Pe(a.a.b,b)}function nn(a,b,t){dd(a,b),0<t.length&&(a.c=null,a.a.set(rn(a,b),x(t)),a.b+=t.length)}function rn(a,b){return b=String(b),a.f&&(b=b.toLowerCase()),b}function on(a,b){this.b=a,this.a=b}function sn(a){this.g=a||un,f.PerformanceNavigationTiming?a=0<(a=f.performance.getEntriesByType("navigation")).length&&("hq"==a[0].nextHopProtocol||"h2"==a[0].nextHopProtocol):a=!!(f.ia&&f.ia.ya&&f.ia.ya()&&f.ia.ya().qb),this.f=a?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}(g=Ze.prototype).add=function(a,b){tn(this),this.c=null,a=rn(this,a);var t=this.a.get(a);return t||this.a.set(a,t=[]),t.push(b),this.b+=1,this},g.forEach=function(a,b){tn(this),this.a.forEach((function(t,e){A(t,(function(t){a.call(b,t,e,this)}),this)}),this)},g.L=function(){tn(this);for(var a=this.a.K(),b=this.a.L(),t=[],e=0;e<b.length;e++)for(var n=a[e],r=0;r<n.length;r++)t.push(b[e]);return t},g.K=function(a){tn(this);var b=[];if("string"==typeof a)en(this,a)&&(b=S(b,this.a.get(rn(this,a))));else{a=this.a.K();for(var t=0;t<a.length;t++)b=S(b,a[t])}return b},g.set=function(a,b){return tn(this),this.c=null,en(this,a=rn(this,a))&&(this.b-=this.a.get(a).length),this.a.set(a,[b]),this.b+=1,this},g.get=function(a,b){return a&&0<(a=this.K(a)).length?String(a[0]):b},g.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var a=[],b=this.a.L(),t=0;t<b.length;t++){var e=b[t],n=encodeURIComponent(String(e));e=this.K(e);for(var r=0;r<e.length;r++){var o=n;""!==e[r]&&(o+="="+encodeURIComponent(String(e[r]))),a.push(o)}}return this.c=a.join("&")};var un=10;function an(a){return!!a.b||!!a.a&&a.a.size>=a.f}function cn(a){return a.b?1:a.a?a.a.size:0}function hn(a,b){return a.b?a.b==b:!!a.a&&a.a.has(b)}function fn(a,b){a.a?a.a.add(b):a.b=b}function ln(a,b){a.b&&a.b==b?a.b=null:a.a&&a.a.has(b)&&a.a.delete(b)}function pn(a){var t,e;if(null!=a.b)return a.c.concat(a.b.s);if(null!=a.a&&0!==a.a.size){var b=a.c;try{for(var n=o(a.a.values()),r=n.next();!r.done;r=n.next()){var c=r.value;b=b.concat(c.s)}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}return b}return x(a.c)}function dn(){}function vn(){this.a=new dn}function yn(a,b,t){var e=t||"";try{Re(a,(function(t,n){var r=t;y(t)&&(r=Rt(t)),b.push(e+n+"="+encodeURIComponent(r))}))}catch(t){throw b.push(e+"type="+encodeURIComponent("_badmap")),t}}function gn(a,b,t,e,n){try{b.onload=null,b.onerror=null,b.onabort=null,b.ontimeout=null,n(e)}catch(t){}}sn.prototype.cancel=function(){var t,e;if(this.c=pn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=o(this.a.values()),r=n.next();!r.done;r=n.next()){r.value.cancel()}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},dn.prototype.stringify=function(a){return f.JSON.stringify(a,void 0)},dn.prototype.parse=function(a){return f.JSON.parse(a,void 0)};var mn=f.JSON.parse;function wn(a){kt.call(this),this.headers=new Le,this.H=a||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=bn,this.D=this.F=!1}T(wn,kt);var bn="",_n=/^https?$/i,In=["POST","PUT"];function En(a){return"content-type"==a.toLowerCase()}function td(a,b){a.b=!1,a.a&&(a.g=!0,a.a.abort(),a.g=!1),a.f=b,a.h=5,Tn(a),An(a)}function Tn(a){a.u||(a.u=!0,a.dispatchEvent("complete"),a.dispatchEvent("error"))}function Nn(a){if(a.b&&void 0!==h&&(!a.s[1]||4!=xn(a)||2!=a.X()))if(a.l&&4==xn(a))Wt(a.za,0,a);else if(a.dispatchEvent("readystatechange"),4==xn(a)){a.b=!1;try{var t,b=a.X();t:switch(b){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}if(!(t=e)){var n;if(n=0===b){var r=String(a.B).match(Ve)[1]||null;if(!r&&f.self&&f.self.location){var o=f.self.location.protocol;r=o.substr(0,o.length-1)}n=!_n.test(r?r.toLowerCase():"")}t=n}if(t)a.dispatchEvent("complete"),a.dispatchEvent("success");else{a.h=6;try{var c=2<xn(a)?a.a.statusText:""}catch(t){c=""}a.f=c+" ["+a.X()+"]",Tn(a)}}finally{An(a)}}}function An(a,b){if(a.a){Sn(a);var t=a.a,e=a.s[0]?l:null;a.a=null,a.s=null,b||a.dispatchEvent("ready");try{t.onreadystatechange=e}catch(t){}}}function Sn(a){a.a&&a.D&&(a.a.ontimeout=null),a.m&&(f.clearTimeout(a.m),a.m=null)}function xn(a){return a.a?a.a.readyState:0}function Dn(a,b,t){t:{for(e in t){var e=!1;break t}e=!0}e||(t=function(a){var b="";return V(a,(function(t,e){b+=e,b+=":",b+=t,b+="\r\n"})),b}(t),"string"==typeof a?null!=t&&encodeURIComponent(String(t)):Ge(a,b,t))}function kn(a,b,t){return t&&t.internalChannelParams&&t.internalChannelParams[a]||b}function On(a){this.pa=0,this.g=[],this.c=new Jt,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.W=this.i=this.O=this.l=null,this.La=this.R=0,this.Ia=kn("failFast",!1,a),this.H=this.m=this.j=this.h=this.f=null,this.T=!0,this.I=this.oa=this.P=-1,this.U=this.o=this.u=0,this.Fa=kn("baseRetryDelayMs",5e3,a),this.Ma=kn("retryDelaySeedMs",1e4,a),this.Ja=kn("forwardChannelMaxRetries",2,a),this.ma=kn("forwardChannelRequestTimeoutMs",2e4,a),this.Ka=a&&a.g||void 0,this.D=void 0,this.C=a&&a.supportsCrossDomainXhr||!1,this.J="",this.b=new sn(a&&a.concurrentRequestLimit),this.ka=new vn,this.da=a&&a.fastHandshake||!1,this.Ga=a&&a.b||!1,a&&a.f&&(this.c.a=!1),a&&a.forceLongPolling&&(this.T=!1),this.V=!this.da&&this.T&&a&&a.c||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null}function Rn(a){if(Cn(a),3==a.v){var b=a.R++,t=Me(a.B);Ge(t,"SID",a.J),Ge(t,"RID",b),Ge(t,"TYPE","terminate"),Mn(a,t),(b=new me(a,a.c,b,void 0)).H=2,b.i=ze(Me(t)),t=!1,f.navigator&&f.navigator.sendBeacon&&(t=f.navigator.sendBeacon(b.i.toString(),"")),!t&&f.Image&&((new Image).src=b.i,t=!0),t||(b.a=Yn(b.g,null),b.a.ba(b.i)),b.u=q(),Ae(b)}Hn(a)}function Ln(a){a.a&&(Bn(a),a.a.cancel(),a.a=null)}function Cn(a){Ln(a),a.j&&(f.clearTimeout(a.j),a.j=null),zn(a),a.b.cancel(),a.h&&("number"==typeof a.h&&f.clearTimeout(a.h),a.h=null)}function Pn(a,b){a.g.push(new on(a.La++,b)),3==a.v&&Vn(a)}function Vn(a){an(a.b)||a.h||(a.h=!0,jt(a.Ba,a),a.u=0)}function Un(a,b){var t;t=b?b.f:a.R++;var e=Me(a.B);Ge(e,"SID",a.J),Ge(e,"RID",t),Ge(e,"AID",a.P),Mn(a,e),a.i&&a.l&&Dn(e,a.i,a.l),t=new me(a,a.c,t,a.u+1),null===a.i&&(t.B=a.l),b&&(a.g=b.s.concat(a.g)),b=jn(a,t,1e3),t.setTimeout(Math.round(.5*a.ma)+Math.round(.5*a.ma*Math.random())),fn(a.b,t),Ie(t,e,b)}function Mn(a,b){a.f&&Re({},(function(t,e){Ge(b,e,t)}))}function jn(a,b,t){t=Math.min(a.g.length,t);var e=a.f?p(a.f.Ha,a.f,a):null;t:for(var n=a.g,r=-1;;){var o=["count="+t];-1==r?0<t?(r=n[0].b,o.push("ofs="+r)):r=0:o.push("ofs="+r);for(var c=!0,h=0;h<t;h++){var f=n[h].b,l=n[h].a;if(0>(f-=r))r=Math.max(0,n[h].b-100),c=!1;else try{yn(l,o,"req"+f+"_")}catch(t){e&&e(l)}}if(c){e=o.join("&");break t}}return a=a.g.splice(0,t),b.s=a,e}function Fn(a){a.a||a.j||(a.U=1,jt(a.Aa,a),a.o=0)}function qn(a){return!(a.a||a.j||3<=a.o)&&(a.U++,a.j=ue(p(a.Aa,a),Kn(a,a.o)),a.o++,!0)}function Bn(a){null!=a.s&&(f.clearTimeout(a.s),a.s=null)}function Gn(a){a.a=new me(a,a.c,"rpc",a.U),null===a.i&&(a.a.B=a.l),a.a.O=0;var b=Me(a.la);Ge(b,"RID","rpc"),Ge(b,"SID",a.J),Ge(b,"CI",a.H?"0":"1"),Ge(b,"AID",a.P),Mn(a,b),Ge(b,"TYPE","xmlhttp"),a.i&&a.l&&Dn(b,a.i,a.l),a.D&&a.a.setTimeout(a.D);var t=a.a;a=a.ga,t.H=1,t.i=ze(Me(b)),t.j=null,t.I=!0,Ee(t,a)}function zn(a){null!=a.m&&(f.clearTimeout(a.m),a.m=null)}function Wn(a,b){var t=null;if(a.a==b){zn(a),Bn(a),a.a=null;var e=2}else{if(!hn(a.b,b))return;t=b.s,ln(a.b,b),e=1}if(a.I=b.N,0!=a.v)if(b.b)if(1==e){t=b.j?b.j.length:0,b=q()-b.u;var n=a.u;(e=ee()).dispatchEvent(new se(e,t,b,n)),Vn(a)}else Fn(a);else if(3==(n=b.h)||0==n&&0<a.I||!(1==e&&function(a,b){return!(cn(a.b)>=a.b.f-(a.h?1:0))&&(a.h?(a.g=b.s.concat(a.g),!0):!(1==a.v||2==a.v||a.u>=(a.Ia?0:a.Ja))&&(a.h=ue(p(a.Ba,a,b),Kn(a,a.u)),a.u++,!0))}(a,b)||2==e&&qn(a)))switch(t&&0<t.length&&(b=a.b,b.c=b.c.concat(t)),n){case 1:Qn(a,5);break;case 4:Qn(a,10);break;case 3:Qn(a,6);break;default:Qn(a,2)}}function Kn(a,b){var t=a.Fa+Math.floor(Math.random()*a.Ma);return a.f||(t*=2),t*b}function Qn(a,b){if(a.c.info("Error code "+b),2==b){var t=null;a.f&&(t=null);var e=p(a.Xa,a);t||(t=new Ue("//www.google.com/images/cleardot.gif"),f.location&&"http"==f.location.protocol||je(t,"https"),ze(t)),function(a,b){var t=new Jt;if(f.Image){var e=new Image;e.onload=E(gn,t,e,"TestLoadImage: loaded",!0,b),e.onerror=E(gn,t,e,"TestLoadImage: error",!1,b),e.onabort=E(gn,t,e,"TestLoadImage: abort",!1,b),e.ontimeout=E(gn,t,e,"TestLoadImage: timeout",!1,b),f.setTimeout((function(){e.ontimeout&&e.ontimeout()}),1e4),e.src=a}else b(!1)}(t.toString(),e)}else oe(2);a.v=0,a.f&&a.f.ra(b),Hn(a),Cn(a)}function Hn(a){a.v=0,a.I=-1,a.f&&(0==pn(a.b).length&&0==a.g.length||(a.b.c.length=0,x(a.g),a.g.length=0),a.f.qa())}function Xn(a,b,t){var e=function(a){return a instanceof Ue?Me(a):new Ue(a,void 0)}(t);if(""!=e.c)b&&Fe(e,b+"."+e.c),qe(e,e.h);else{var n=f.location;e=function(a,b,t,e){var n=new Ue(null,void 0);return a&&je(n,a),b&&Fe(n,b),t&&qe(n,t),e&&(n.g=e),n}(n.protocol,b?b+"."+n.hostname:n.hostname,+n.port,t)}return a.W&&V(a.W,(function(t,n){Ge(e,n,t)})),b=a.A,t=a.na,b&&t&&Ge(e,b,t),Ge(e,"VER",a.ha),Mn(a,e),e}function Yn(a,b){if(b&&!a.C)throw Error("Can't create secondary domain capable XhrIo object.");return(b=new wn(a.Ka)).F=a.C,b}function $n(){}function Jn(){if(z&&!(10<=Number(it)))throw Error("Environmental error: no available transport.")}function Zn(a,b){kt.call(this),this.a=new On(b),this.l=a,this.b=b&&b.messageUrlParams||null,a=b&&b.messageHeaders||null,b&&b.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.a.l=a,a=b&&b.initMessageHeaders||null,b&&b.messageContentType&&(a?a["X-WebChannel-Content-Type"]=b.messageContentType:a={"X-WebChannel-Content-Type":b.messageContentType}),b&&b.a&&(a?a["X-WebChannel-Client-Profile"]=b.a:a={"X-WebChannel-Client-Profile":b.a}),this.a.O=a,(a=b&&b.httpHeadersOverwriteParam)&&!D(a)&&(this.a.i=a),this.h=b&&b.supportsCrossDomainXhr||!1,this.g=b&&b.sendRawJson||!1,(b=b&&b.httpSessionIdParam)&&!D(b)&&(this.a.A=b,null!==(a=this.b)&&b in a&&(b in(a=this.b)&&delete a[b])),this.f=new rr(this)}function er(a){ve.call(this);var b=a.__sm__;if(b){t:{for(var t in b){a=t;break t}a=void 0}(this.c=a)?(a=this.c,this.data=null!==b&&a in b?b[a]:void 0):this.data=b}else this.data=a}function nr(){ye.call(this),this.status=1}function rr(a){this.a=a}(g=wn.prototype).ba=function(a,b,t,e){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+a);b=b?b.toUpperCase():"GET",this.B=a,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?fe(this.H):fe(pe),this.a.onreadystatechange=p(this.za,this);try{this.A=!0,this.a.open(b,String(a),!0),this.A=!1}catch(t){return void td(this,t)}a=t||"";var n=new Le(this.headers);e&&Re(e,(function(t,e){n.set(e,t)})),e=function(a){t:{for(var b=En,t=a.length,e="string"==typeof a?a.split(""):a,n=0;n<t;n++)if(n in e&&b.call(void 0,e[n],n,a)){b=n;break t}b=-1}return 0>b?null:"string"==typeof a?a.charAt(b):a[b]}(n.L()),t=f.FormData&&a instanceof f.FormData,!(0<=N(In,b))||e||t||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),n.forEach((function(t,e){this.a.setRequestHeader(e,t)}),this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Sn(this),0<this.o&&((this.D=function(a){return z&&et(9)&&"number"==typeof a.timeout&&void 0!==a.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=p(this.xa,this)):this.m=Wt(this.xa,this.o,this)),this.l=!0,this.a.send(a),this.l=!1}catch(t){td(this,t)}},g.xa=function(){void 0!==h&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},g.abort=function(a){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=a||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),An(this))},g.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),An(this,!0)),wn.S.G.call(this)},g.za=function(){this.j||(this.A||this.l||this.g?Nn(this):this.Ta())},g.Ta=function(){Nn(this)},g.X=function(){try{return 2<xn(this)?this.a.status:-1}catch(t){return-1}},g.$=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},g.Na=function(a){if(this.a){var b=this.a.responseText;return a&&0==b.indexOf(a)&&(b=b.substring(a.length)),mn(b)}},g.ua=function(){return this.h},g.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(g=On.prototype).ha=8,g.v=1,g.Ba=function(a){if(this.h)if(this.h=null,1==this.v){if(!a){this.R=Math.floor(1e5*Math.random()),a=this.R++;var t,b=new me(this,this.c,a,void 0),e=this.l;if(this.O&&(e?j(e=U(e),this.O):e=this.O),null===this.i&&(b.B=e),this.da)t:{for(var n=t=0;n<this.g.length;n++){var r=this.g[n];if(void 0===(r="__data__"in r.a&&"string"==typeof(r=r.a.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break t}if(4096===t||n===this.g.length-1){t=n+1;break t}}t=1e3}else t=1e3;t=jn(this,b,t),Ge(n=Me(this.B),"RID",a),Ge(n,"CVER",22),this.A&&Ge(n,"X-HTTP-Session-Id",this.A),Mn(this,n),this.i&&e&&Dn(n,this.i,e),fn(this.b,b),this.Ga&&Ge(n,"TYPE","init"),this.da?(Ge(n,"$req",t),Ge(n,"SID","null"),b.V=!0,Ie(b,n,null)):Ie(b,n,t),this.v=2}}else 3==this.v&&(a?Un(this,a):0==this.g.length||an(this.b)||Un(this))},g.Aa=function(){if(this.j=null,Gn(this),this.V&&!(this.F||null==this.a||0>=this.N)){var a=2*this.N;this.c.info("BP detection timer enabled: "+a),this.s=ue(p(this.Sa,this),a)}},g.Sa=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,Ln(this),Gn(this))},g.Ra=function(){null!=this.m&&(this.m=null,Ln(this),qn(this),oe(19))},g.Xa=function(a){a?(this.c.info("Successfully pinged google.com"),oe(2)):(this.c.info("Failed to ping google.com"),oe(1))},(g=$n.prototype).ta=function(){},g.sa=function(){},g.ra=function(){},g.qa=function(){},g.Ha=function(){},Jn.prototype.a=function(a,b){return new Zn(a,b)},T(Zn,kt),(g=Zn.prototype).addEventListener=function(a,b,t,e){Zn.S.addEventListener.call(this,a,b,t,e)},g.removeEventListener=function(a,b,t,e){Zn.S.removeEventListener.call(this,a,b,t,e)},g.Oa=function(){this.a.f=this.f,this.h&&(this.a.C=!0);var a=this.a,b=this.l,t=this.b||void 0;oe(0),a.fa=b,a.W=t||{},a.H=a.T,a.B=Xn(a,null,a.fa),Vn(a)},g.close=function(){Rn(this.a)},g.Pa=function(a){if("string"==typeof a){var b={};b.__data__=a,Pn(this.a,b)}else this.g?((b={}).__data__=Rt(a),Pn(this.a,b)):Pn(this.a,a)},g.G=function(){this.a.f=null,delete this.f,Rn(this.a),delete this.a,Zn.S.G.call(this)},T(er,ve),T(nr,ye),T(rr,$n),rr.prototype.ta=function(){this.a.dispatchEvent("a")},rr.prototype.sa=function(a){this.a.dispatchEvent(new er(a))},rr.prototype.ra=function(a){this.a.dispatchEvent(new nr(a))},rr.prototype.qa=function(){this.a.dispatchEvent("b")},Jn.prototype.createWebChannel=Jn.prototype.a,Zn.prototype.send=Zn.prototype.Pa,Zn.prototype.open=Zn.prototype.Oa,Zn.prototype.close=Zn.prototype.close,ae.NO_ERROR=0,ae.TIMEOUT=8,ae.HTTP_ERROR=6,ce.COMPLETE="complete",le.EventType=de,de.OPEN="a",de.CLOSE="b",de.ERROR="c",de.MESSAGE="d",kt.prototype.listen=kt.prototype.va,wn.prototype.listenOnce=wn.prototype.wa,wn.prototype.getLastError=wn.prototype.Qa,wn.prototype.getLastErrorCode=wn.prototype.ua,wn.prototype.getStatus=wn.prototype.X,wn.prototype.getResponseJson=wn.prototype.Na,wn.prototype.getResponseText=wn.prototype.$,wn.prototype.send=wn.prototype.ba;var ir={createWebChannelTransport:function(){return new Jn},ErrorCode:ae,EventType:ce,WebChannel:le,XhrIo:wn},or=ir.createWebChannelTransport,sr=ir.ErrorCode,ur=ir.EventType,ar=ir.WebChannel,cr=ir.XhrIo;e.default=ir}.call(this,n(22))},257:function(t,e,n){"use strict";n.r(e);n(254)}}]);